import{b as h,q as l}from"./chunk-S5MKYZQE.js";import{a as g}from"./chunk-7QS2YA2B.js";import{X as R,a as o,aa as f,b as a,ra as c}from"./chunk-DAZPDLGM.js";var m=class r{foodsService=f(h);recipes=c([]);expandedRecipeId=c("");constructor(){this.loadRecipes(),this.loadExpandedRecipeId()}loadRecipes(){let e=localStorage.getItem("recipes");e?this.recipes.set(JSON.parse(e)):this.recipes.set([])}loadExpandedRecipeId(){let e=localStorage.getItem("expandedRecipeId");e?this.expandedRecipeId.set(JSON.parse(e)):this.expandedRecipeId.set("")}saveRecipes(){localStorage.setItem("recipes",JSON.stringify(this.recipes()))}setRecipes(e){localStorage.setItem("recipes",JSON.stringify(e)),this.loadRecipes()}downloadRecipes(){let e=JSON.stringify(this.recipes()),i=new Blob([e],{type:"application/json"}),s=URL.createObjectURL(i),t=document.createElement("a");t.href=s,t.download="recipes.json",t.click(),URL.revokeObjectURL(s)}addRecipe(){return this.recipes.update(e=>[new l(g(),"Empty recipe"),...e]),this.saveRecipes(),this.recipes()[0].id}updateRecipeName(e,i){this.recipes.update(s=>s.map(t=>t.id===e?a(o({},t),{name:i}):t)),this.saveRecipes()}updateRecipeNote(e,i){this.recipes.update(s=>s.map(t=>t.id===e?a(o({},t),{note:i}):t)),this.saveRecipes()}addFood(e,i){this.recipes.update(s=>s.map(t=>{if(t.id===e){let d=this.foodsService.getFoodById(i);if(d)return a(o({},t),{foods:[...t.foods,o({},d)]})}return t})),this.saveRecipes()}updateFoodWeight(e,i,s){this.recipes.update(t=>t.map(d=>d.id===e?a(o({},d),{foods:d.foods.map((p,n)=>n===i?a(o({},p),{weight:+s}):p)}):d)),this.saveRecipes()}updateRecipePortions(e,i){this.recipes.update(s=>s.map(t=>t.id===e?a(o({},t),{portions:+i}):t)),this.saveRecipes()}removeFood(e,i){this.recipes.update(s=>s.map(t=>t.id===e?a(o({},t),{foods:t.foods.filter((d,p)=>p!==i)}):t)),this.recipes().find(s=>s.id===e&&s.foods.length===0)&&this.recipes.update(s=>s.filter(t=>t.id!==e)),this.saveRecipes()}changeFoodOrder(e,i,s){this.recipes.update(t=>t.map(d=>d.id===e?a(o({},d),{foods:d.foods.map((p,n)=>n===i?d.foods[s]:n===s?d.foods[i]:d.foods[n])}):d)),this.saveRecipes()}getRecipeById(e){return this.recipes().find(i=>i.id===e)}setExpandedRecipeId(e){this.expandedRecipeId.set(e),localStorage.setItem("expandedRecipeId",JSON.stringify(this.expandedRecipeId()))}toggleExpandedRecipeId(e){e===this.expandedRecipeId()?this.expandedRecipeId.set(""):this.expandedRecipeId.set(e),localStorage.setItem("expandedRecipeId",JSON.stringify(this.expandedRecipeId()))}static \u0275fac=function(i){return new(i||r)};static \u0275prov=R({token:r,factory:r.\u0275fac,providedIn:"root"})};export{m as a};

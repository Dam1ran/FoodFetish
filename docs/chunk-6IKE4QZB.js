import{a as Fe,b as I}from"./chunk-MRA27XET.js";import"./chunk-B2YBVACZ.js";import{b as be,c as Se,d as Q}from"./chunk-M5BJVPW4.js";import{l as ye,m as ge,n as fe,p as ve}from"./chunk-ZBIQLWB4.js";import{a as De,f as k,h as N,o as we}from"./chunk-7CSXQSLL.js";import{a as he}from"./chunk-7QS2YA2B.js";import{b as ue,i as _e,k as xe,s as X}from"./chunk-AXIU5WEJ.js";import{Ab as m,Ea as n,Hb as oe,Ib as ne,Kb as ae,Lb as T,Nb as C,Ob as l,Pb as re,Qb as p,Rb as L,Sb as $,Tb as z,Ub as de,Va as D,Vb as se,Wb as B,X as Y,_a as ee,_b as A,aa as x,ac as le,db as O,dc as ce,fa as u,ga as y,gc as j,hb as te,ib as ie,jb as b,jc as R,kc as _,lb as w,lc as pe,mb as S,mc as q,nb as f,ob as a,pb as d,pc as me,qa as E,qb as h,ra as Z,rb as F,sb as M,ub as v,yb as g}from"./chunk-CKWOGJJW.js";var Ie=(r,i)=>({"opacity-25":r,"opacity-5":i}),W=class r{food=_.required();isOdd=_(!1);removeFood=R();updateFoodWeight=R();noRemove=_(!1,{transform:me});static \u0275fac=function(e){return new(e||r)};static \u0275cmp=D({type:r,selectors:[["food-row"]],inputs:{food:[1,"food"],isOdd:[1,"isOdd"],noRemove:[1,"noRemove"]},outputs:{removeFood:"removeFood",updateFoodWeight:"updateFoodWeight"},decls:17,vars:16,consts:[[1,"d-flex"],["iconSize","16px",1,"btn","btn-outline-warning","mx-1","align-self-center",3,"click","disabled","buttonIcon"],[1,"d-flex","align-items-center","ps-1",2,"min-width","100px","width","20%","font-size","12px"],[1,"row","g-0","fw-light","fst-italic","flex-grow-1","align-self-stretch",2,"font-size","12px"],[1,"col","col-2","align-self-stretch","text-center","align-content-center","m-0"],[1,"col","col-2","align-self-stretch","text-center","align-content-center"],["type","number","inputmode","numeric",1,"form-control","form-control-sm","text-center","p-0","border","border-success-subtle","bg-body","shadow-none",2,"border-radius","4px",3,"input","value"]],template:function(e,t){if(e&1){let o=v();a(0,"div",0)(1,"button",1),g("click",function(){return u(o),y(!t.noRemove()&&t.removeFood.emit())}),d(),a(2,"div",2),l(3),d(),a(4,"div",3)(5,"div",4),l(6),d(),a(7,"div",5),l(8),d(),a(9,"div",5),l(10),d(),a(11,"div",5),l(12),d(),a(13,"div",5),l(14),d(),a(15,"div",5)(16,"input",6),g("input",function(c){return u(o),y(t.updateFoodWeight.emit(c.target.value))}),d()()()()}if(e&2){T("bg-body-tertiary",t.isOdd()),n(),C(A(13,Ie,!t.noRemove(),t.noRemove())),f("disabled",t.noRemove())("buttonIcon",t.noRemove()?"":"iconoir:trash"),n(2),p(" ",t.food().name," ");let o=t.food().weight*.01;n(3),p(" ",(t.food().protein*o).toFixed(1)," "),n(2),p(" ",(t.food().carbs*o).toFixed(1)," "),n(2),p(" ",(t.food().fats*o).toFixed(1)," "),n(2),p(" ",(t.food().fiber*o).toFixed(1)," "),n(2),p(" ",(t.food().calories*o).toFixed(1)," "),n(2),f("value",t.food().weight)}},dependencies:[k],encapsulation:2})};var V=class r{stats=_.required();fixedDecimals=_(1);static \u0275fac=function(e){return new(e||r)};static \u0275cmp=D({type:r,selectors:[["total-row"]],inputs:{stats:[1,"stats"],fixedDecimals:[1,"fixedDecimals"]},decls:16,vars:6,consts:[[1,"d-flex","border-bottom","border-2"],[1,"fw-bold","text-muted","opacity-75","fst-italic",2,"width","130px"],[1,"row","g-0","flex-grow-1","fw-bold","text-muted","fst-italic","opacity-75",2,"font-size","12px"],[1,"col","col-2","text-center","align-content-center","bg-body-secondary"],[1,"col","col-2","text-center","align-content-center"]],template:function(e,t){e&1&&(F(0,"div",0)(1,"div",1),l(2,"Total"),M(),F(3,"div",2)(4,"div",3),l(5),M(),F(6,"div",4),l(7),M(),F(8,"div",3),l(9),M(),F(10,"div",4),l(11),M(),F(12,"div",3),l(13),M(),F(14,"div",4),l(15),M()()()),e&2&&(n(5),p(" ",t.stats().proteins.toFixed(t.fixedDecimals())," "),n(2),p(" ",t.stats().carbs.toFixed(t.fixedDecimals())," "),n(2),p(" ",t.stats().fats.toFixed(t.fixedDecimals())," "),n(2),p(" ",t.stats().fiber.toFixed(t.fixedDecimals())," "),n(2),p(" ",t.stats().calories.toFixed(t.fixedDecimals())," "),n(2),p(" ",t.stats().weight.toFixed(t.fixedDecimals())," "))},encapsulation:2})};function Ee(r,i){if(r&1){let e=v();a(0,"food-row",14),g("updateFoodWeight",function(o){let s=u(e).$index,c=m();return y(c.updateFoodWeight.emit({foodIndex:s,newWeight:+o}))}),d()}if(r&2){let e=i.$implicit,t=i.$index;f("food",e)("isOdd",t%2!==0)}}var G=class r{id=E(he());recipe=_.required();updateFoodWeight=R();removeRecipe=R();recipeStats(){return we(this.recipe())}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=D({type:r,selectors:[["diary-recipe"]],inputs:{recipe:[1,"recipe"]},outputs:{updateFoodWeight:"updateFoodWeight",removeRecipe:"removeRecipe"},decls:17,vars:8,consts:[["collapsible",""],[1,"accordion","accordion-flush",2,"--bs-accordion-active-bg","rgba(7, 60, 130, 0.5)",3,"id"],[1,"accordion-item"],[1,"accordion-header","d-flex","align-items-center"],["buttonIcon","iconoir:trash","iconSize","16px",1,"btn","btn-outline-warning","btn-sm","opacity-25","mx-1",3,"click"],["type","button","data-bs-toggle","collapse",1,"accordion-button","collapsed","p-1","shadow-none"],[1,"opacity-75","w-100","d-flex"],[1,"mx-auto","text-center","text-primary-emphasis","text-truncate"],[1,"d-flex","align-items-center","gap-1","justify-content-center",2,"width","34px"],["icon","icon-park-outline:chart-proportion","size","16px",1,"text-success"],[1,"text-muted",2,"font-size","10px"],[1,"accordion-collapse","collapse","bg-body-secondary",3,"id"],["noRemove","",3,"food","isOdd"],[3,"stats","fixedDecimals"],["noRemove","",3,"updateFoodWeight","food","isOdd"]],template:function(e,t){if(e&1){let o=v();a(0,"div",1)(1,"div",2)(2,"h2",3)(3,"button",4),g("click",function(){return u(o),y(t.removeRecipe.emit())}),d(),a(4,"button",5)(5,"div",6)(6,"div",7),l(7),d()()(),a(8,"div",8),h(9,"iconify",9),a(10,"div",10),l(11),d()()(),a(12,"div",11,0),w(14,Ee,1,2,"food-row",12,b),h(16,"total-row",13),d()()()}e&2&&(f("id","accordionFlushRecipe-"+t.id()),n(4),O("data-bs-target","#flush-collapse-"+t.id()),n(3),p(" ",t.recipe().name," "),n(4),re(t.recipe().portions),n(),f("id","flush-collapse-"+t.id()),O("data-bs-parent","#accordionFlushRecipe-"+t.id()),n(2),S(t.recipe().foods),n(2),f("stats",t.recipeStats())("fixedDecimals",0))},dependencies:[W,V,De,k],encapsulation:2})};var Te=(r,i,e,t,o)=>({"border-warning":r,"text-primary":i,"fw-bold":e,"fst-normal":t,"bg-body-secondary":o});function Ce(r,i){if(r&1){let e=v();a(0,"div",4),g("click",function(){let o=u(e).$implicit,s=m();return y(s.selectWeekDay(o))}),a(1,"div",5),l(2),d(),h(3,"div",6),d()}if(r&2){let e=i.$implicit,t=i.$index,o=m();C(le(5,Te,o.isDaySelected(e),o.isTodayLbl(e),o.isTodayLbl(e),o.isTodayLbl(e),t===5||t===6)),n(2),p("",e,"."),n(),ae("background-color",o.hasFood(e)?"rgba(60, 120, 70)":"rgba(80, 80, 80)")}}var K=class r{weekdays=["Mo","Tu","We","Th","Fr","Sa","Su"];calendar=x(fe);selectedDate=q();selectedDayJs=j(()=>I.fromNgbDateStruct(this.selectedDate()));ngOnInit(){this.selectedDate.set(this.calendar.getToday())}isDaySelected(i){let e=I.getStartOfToday();return i===this.weekdays[this.selectedDayJs().day()===0?6:this.selectedDayJs().day()-1]&&e.isoWeek()===this.selectedDayJs().isoWeek()}isTodayLbl(i){let e=I.getStartOfToday();return i===this.weekdays[e.day()===0?6:e.day()-1]}selectWeekDay(i){let e=this.weekdays.indexOf(i);if(I.getStartOfToday().isoWeek()!==this.selectedDayJs().isoWeek())return;let o=this.selectedDayJs().isoWeekday(e+1);this.selectedDate.set({day:o.date(),month:o.month()+1,year:o.year()})}diaryLogService=x(Q);hasFood(i){return this.diaryLogService.hasFoodOnDate(this.selectedDayJs().isoWeekday(this.weekdays.indexOf(i)+1).toISOString())}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=D({type:r,selectors:[["weekdays"]],inputs:{selectedDate:[1,"selectedDate"]},outputs:{selectedDate:"selectedDateChange"},decls:5,vars:1,consts:[[1,"bg-secondary-subtle","p-1","user-select-none"],[1,"d-flex","justify-content-between"],[1,"weekday","bg-body","cursor-pointer",3,"class"],[3,"selectedDateChange","selectedDate"],[1,"weekday","bg-body","cursor-pointer",3,"click"],[1,"text-center"],[1,"rounded","m-auto",2,"width","6px","height","6px"]],template:function(e,t){e&1&&(a(0,"div",0)(1,"div",1),w(2,Ce,4,11,"div",2,b),a(4,"date-picker",3),z("selectedDateChange",function(s){return $(t.selectedDate,s)||(t.selectedDate=s),s}),d()()()),e&2&&(n(2),S(t.weekdays),n(2),L("selectedDate",t.selectedDate))},dependencies:[Fe],styles:[".weekday[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;font-size:14px;border:2px solid transparent;transition:border .3s;font-style:italic}"]})};var U=class r{dayTemplate=E(void 0);constructor(){this.setTemplate(),this.loadDayTemplate()}setTemplate(){if(!localStorage.getItem("dayTemplate")){let e=new Se;e.entries.push({position:1,meal:new N("","Meal I"),recipes:[]}),e.entries.push({position:2,meal:new N("","Meal II"),recipes:[]}),e.entries.push({position:3,meal:new N("","Meal III"),recipes:[]}),e.entries.push({position:4,meal:new N("","Meal IV"),recipes:[]}),e.entries.push({position:5,meal:new N("","Snacks"),recipes:[]}),localStorage.setItem("dayTemplate",JSON.stringify(e))}}loadDayTemplate(){this.dayTemplate.set(JSON.parse(localStorage.getItem("dayTemplate")))}getDayTemplate(){return this.dayTemplate()}static \u0275fac=function(e){return new(e||r)};static \u0275prov=Y({token:r,factory:r.\u0275fac,providedIn:"root"})};var Re=["editMealNoteDialog"],ke=(r,i)=>({"bg-body-secondary":r,"bg-dark-subtle":i});function Ne(r,i){if(r&1){let e=v();a(0,"div",17)(1,"button",23),g("click",function(){u(e),m();let o=B(0),s=m();return y(s.toggleEditMealNoteDialog(o.id,o.note))}),d(),a(2,"input",24),g("input",function(o){u(e);let s=m().$implicit,c=m();return y(c.updateMealName(s.position,o.target.value))}),d()()}if(r&2){m();let e=B(0);n(),T("btn-outline-success",e.note),n(),f("value",e.name)}}function We(r,i){if(r&1){let e=v();a(0,"diary-recipe",25),g("updateFoodWeight",function(o){let s=u(e).$index,c=m().$implicit,P=m();return y(P.updateRecipeFoodWeight(c.position,s,o.foodIndex,o.newWeight))})("removeRecipe",function(){let o=u(e).$index,s=m().$implicit,c=m();return y(c.removeRecipeFromPosition(s.position,o))}),d()}if(r&2){let e=i.$implicit;f("recipe",e)}}function Ve(r,i){if(r&1){let e=v();a(0,"food-row",26),g("removeFood",function(){let o=u(e).$index,s=m().$implicit,c=B(0),P=m();return y(P.removeFood(s.position,o,c))})("updateFoodWeight",function(o){let s=u(e).$index,c=m().$implicit,P=m();return y(P.updateFoodWeight(c.position,s,o))}),d()}if(r&2){let e=i.$implicit,t=i.$index;f("food",e)("isOdd",t%2!==0)}}function Pe(r,i){if(r&1){let e=v();de(0),a(1,"div",10)(2,"h2",12)(3,"button",13),g("click",function(){let o=u(e).$implicit,s=m();return y(s.toggleExpandedMeal(o.position))}),l(4),d(),a(5,"div",14)(6,"div",15)(7,"div",8),l(8),d(),a(9,"div",8),l(10),d(),a(11,"div",8),l(12),d(),a(13,"div",8),l(14),d(),a(15,"div",8),l(16),d(),a(17,"div",8),l(18),d()()()(),a(19,"div",16,1),te(21,Ne,3,3,"div",17),w(22,We,1,1,"diary-recipe",18,b),a(24,"div",19)(25,"button",20),g("click",function(o){let s=u(e).$implicit,c=m();return o.stopPropagation(),y(c.addRecipe(s.position))}),l(26," Add recipe "),d()(),w(27,Ve,1,2,"food-row",21,b),a(29,"div",19)(30,"button",22),g("click",function(o){let s=u(e).$implicit,c=m();return o.stopPropagation(),y(c.addFood(s.position))}),l(31," Add food "),d()()()()}if(r&2){let e=i.$implicit,t=i.$index,o=m(),s=se(o.getRespectiveMeal(e.position));n(3),T("collapsed",!o.isMealExpanded(e.position)),O("data-bs-target","#flush-collapse"+t),n(),p(" ",o.mealPositionMap[e.position]," "),n(2),C(A(17,ke,!o.isMealExpanded(e.position),o.isMealExpanded(e.position)));let c=o.getPositionStats(e.position);n(2),p(" ",c.proteins.toFixed()," "),n(2),p(" ",c.carbs.toFixed()," "),n(2),p(" ",c.fats.toFixed()," "),n(2),p(" ",c.fiber.toFixed()," "),n(2),p(" ",c.calories.toFixed()," "),n(2),p(" ",c.weight.toFixed()," "),n(),T("show",o.isMealExpanded(e.position)),f("id","flush-collapse"+t),n(2),ie(s?21:-1),n(),S(o.getRespectiveRecipes(e.position)),n(5),S(s==null?null:s.foods)}}function Oe(r,i){if(r&1){let e=v();a(0,"textarea",27),g("input",function(o){u(e);let s=m();return y(s.updateMealNote(s.editNoteMealId(),o.target.value))}),d()}if(r&2){let e=m();f("value",e.editNoteMeal())}}var Me=class r{diaryDate=_("");selectedDate=q(void 0);selectedDayJs=j(()=>I.fromNgbDateStruct(this.selectedDate()));ngAfterViewInit(){this.diaryDate()&&this.selectedDate.set(I.toNgbDateStruct(this.diaryDate()))}location=x(ue);activatedRoute=x(_e);constructor(){Z(()=>{if(!this.selectedDate())return;let i=this.selectedDayJs();if(i){let e=this.router.createUrlTree([],{relativeTo:this.activatedRoute,queryParams:{diaryDate:i.toISOString()}}).toString();this.location.go(e)}})}dayTemplateService=x(U);router=x(xe);addFood(i){this.router.navigate([X.myFoods],{queryParams:{diaryDate:this.selectedDayJs().toISOString(),mealPosition:i}})}addRecipe(i){this.router.navigate([X.recipes],{queryParams:{diaryDate:this.selectedDayJs().toISOString(),mealPosition:i}})}diaryLogService=x(Q);mealPositionMap=be;getRespectiveMeal(i){return this.diaryLogService.getRespectiveMeal(this.selectedDayJs().toISOString(),i)}getRespectiveRecipes(i){return this.diaryLogService.getRespectiveRecipes(this.selectedDayJs().toISOString(),i)}updateMealName(i,e){this.diaryLogService.updateMealName(this.selectedDayJs().toISOString(),i,e)}removeFood(i,e,t){this.diaryLogService.removeFood(this.selectedDayJs().toISOString(),i,e),t.foods.length||this.diaryLogService.clearMeal(this.selectedDayJs().toISOString(),i)}updateFoodWeight(i,e,t){this.diaryLogService.updateFoodWeight(this.selectedDayJs().toISOString(),i,e,+t)}getPositionStats(i){return this.diaryLogService.getPositionStats(this.selectedDayJs().toISOString(),i)}getDayStats(){return this.diaryLogService.getDayStats(this.selectedDayJs().toISOString())}toggleExpandedMeal(i){this.diaryLogService.toggleExpandedMeal(this.selectedDayJs().toISOString(),i)}isMealExpanded(i){let e=this.diaryLogService.getExpandedMeal();return e?.isoDate===this.selectedDayJs().toISOString()&&e?.mealPosition===i}modalService=x(ve);editMealNoteDialogRef=pe("editMealNoteDialog");editNoteMealId=E("");editNoteMeal=E("");toggleEditMealNoteDialog(i,e){this.editNoteMealId.set(i),this.editNoteMeal.set(e),this.modalService.open(this.editMealNoteDialogRef(),{size:"sm",centered:!0}).result.catch(()=>{this.editNoteMealId.set(""),this.editNoteMeal.set("")})}updateMealNote(i,e){this.diaryLogService.updateMealNote(this.selectedDayJs().toISOString(),i,e)}updateRecipeFoodWeight(i,e,t,o){this.diaryLogService.updateRecipeFoodWeight(this.selectedDayJs().toISOString(),i,e,t,o)}removeRecipeFromPosition(i,e){this.diaryLogService.removeRecipeFromPosition(this.selectedDayJs().toISOString(),i,e)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=D({type:r,selectors:[["diary"]],viewQuery:function(e,t){e&1&&oe(t.editMealNoteDialogRef,Re,5),e&2&&ne()},inputs:{diaryDate:[1,"diaryDate"],selectedDate:[1,"selectedDate"]},outputs:{selectedDate:"selectedDateChange"},decls:25,vars:3,consts:[["editMealNoteDialog",""],["collapsible",""],[1,"content-wrapper"],[3,"selectedDateChange","selectedDate"],[1,"border-bottom"],[1,"d-flex"],[2,"width","130px"],[1,"row","g-0","flex-grow-1","fw-bold","text-muted","fst-italic","opacity-25","bg-body-secondary",2,"font-size","12px"],[1,"col","col-2","align-self-center","text-center"],["id","accordionFlush",1,"accordion","accordion-flush"],[1,"accordion-item"],[3,"stats","fixedDecimals"],[1,"accordion-header","d-flex","align-items-center"],["type","button","data-bs-toggle","collapse",1,"accordion-button","p-1","text-truncate","text-muted","fw-bold","opacity-75","shadow-none",2,"width","130px",3,"click"],[1,"flex-grow-1","align-self-stretch"],[1,"row","g-0","h-100","fw-light","fst-italic",2,"font-size","12px","transition","background-color 0.3s"],["data-bs-parent","#accordionFlush",1,"accordion-collapse","collapse","bg-body-secondary","rounded",3,"id"],[1,"d-flex","align-items-center","p-1","gap-1","bg-body-tertiary"],[3,"recipe"],[1,"p-1","bg-body-tertiary"],["buttonIcon","pajamas:recipe","iconSize","24px",1,"btn","btn-outline-primary","btn-sm","w-100","opacity-60",3,"click"],[3,"food","isOdd"],["buttonIcon","iconoir:lens-plus","iconSize","24px",1,"btn","btn-outline-success","btn-sm","w-100","opacity-80",3,"click"],["buttonIcon","iconoir:notes","iconSize","16px",1,"btn","btn-outline-secondary",3,"click"],["type","text",1,"form-control","form-control-sm","shadow-none","text-center","bg-dark-subtle",3,"input","value"],[3,"updateFoodWeight","removeRecipe","recipe"],[3,"removeFood","updateFoodWeight","food","isOdd"],["rows","3","placeholder","Meal note",1,"form-control","form-control-sm","meal-name-input","text-center",3,"input","value"]],template:function(e,t){if(e&1){let o=v();a(0,"div",2)(1,"weekdays",3),z("selectedDateChange",function(c){return u(o),$(t.selectedDate,c)||(t.selectedDate=c),y(c)}),d(),h(2,"div",4),a(3,"div",5),h(4,"div",6),a(5,"div",7)(6,"div",8),l(7,"P"),d(),a(8,"div",8),l(9,"C"),d(),a(10,"div",8),l(11,"Fa"),d(),a(12,"div",8),l(13,"Fi"),d(),a(14,"div",8),l(15,"KCal"),d(),a(16,"div",8),l(17,"G"),d()()(),h(18,"div",4),a(19,"div",9),w(20,Pe,32,20,"div",10,b),d(),h(22,"total-row",11),d(),ee(23,Oe,1,1,"ng-template",null,0,ce)}e&2&&(n(),L("selectedDate",t.selectedDate),n(19),S(t.dayTemplateService.getDayTemplate().entries),n(2),f("stats",t.getDayStats())("fixedDecimals",0))},dependencies:[k,ge,ye,W,G,V,K],encapsulation:2})};export{Me as Diary};

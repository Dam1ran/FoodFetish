import{b as E}from"./chunk-ET3JPIE6.js";import{P as j}from"./chunk-PXXMBKHJ.js";import{a as F}from"./chunk-TTUD5ZDE.js";import{Ea as x,Ga as C,Hb as w,Tb as S,Xa as D,aa as c,fc as T,jb as U,kb as I,pb as M,qb as d,qc as L,ra as v,rb as m,rc as u,sa as y,sb as g,vc as R,xc as _}from"./chunk-HXGKTDM5.js";var H=(a,t)=>({filter:a,opacity:t});function W(a,t){if(a&1&&(d(0,"div",0),g(1,"img",2),m()),a&2){let e=w();C(),S(T(5,H,e.stretched()?"blur(4px) grayscale(25%)":"unset",e.stretched()?.2:1)),M("width",e.stretched()?320:160)("height",(e.stretched(),160))("src",e.imageDataUrl(),x)}}function q(a,t){a&1&&(d(0,"div",1),g(1,"iconify",3),m())}var N=class a{imageId=u.required();stretched=u(!1,{transform:_});imageStoreService=c(E);imageDataUrl=v(null);diaryLogService=c(j);deleteChange=L();cdr=c(R);constructor(){y(()=>{let t=this.imageId();t?this.imageStoreService.get(t).then(e=>{this.imageDataUrl.set(e),e||(this.deleteChange.emit(t),this.cdr.detectChanges())}):this.imageDataUrl.set(null)})}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=D({type:a,selectors:[["meal-thumb"]],inputs:{imageId:[1,"imageId"],stretched:[1,"stretched"]},outputs:{deleteChange:"deleteChange"},decls:2,vars:1,consts:[[1,"d-flex","justify-content-center"],[1,"d-flex","justify-content-center","align-items-center",2,"width","160px","height","160px"],["alt","meal thumb",2,"object-fit","cover",3,"width","height","src"],["icon","streamline:broken-link-2",1,"opacity-50"]],template:function(e,i){e&1&&U(0,W,2,8,"div",0)(1,q,2,0,"div",1),e&2&&I(i.imageDataUrl()?0:i.stretched()?-1:1)},dependencies:[F],encapsulation:2})};function Z(a,t=320,e=320,i=.25){return new Promise((k,s)=>{let l=URL.createObjectURL(a),n=new Image;n.onload=()=>{let h=Math.max(t/n.naturalWidth,e/n.naturalHeight),p=n.naturalWidth*h,f=n.naturalHeight*h,O=(t-p)/2,P=(e-f)/2,r=document.createElement("canvas");r.width=t,r.height=e,r.getContext("2d").drawImage(n,O,P,p,f),r.toBlob(b=>{if(URL.revokeObjectURL(l),!b){s(new Error("Failed to create blob from canvas"));return}let o=new FileReader;o.onloadend=()=>{let A=o.result;k(A.split(",")[1])},o.onerror=()=>s(new Error("Failed to read blob as base64")),o.readAsDataURL(b)},"image/jpeg",i)},n.onerror=()=>{URL.revokeObjectURL(l),s(new Error("Failed to load image"))},n.src=l})}export{N as a,Z as b};

import{X as H,a as h,aa as ye,b as I,c as Ie,e as Oe,ra as A}from"./chunk-HXGKTDM5.js";var ge=Ie((ae,oe)=>{(function(s,e){typeof ae=="object"&&typeof oe<"u"?oe.exports=e():typeof define=="function"&&define.amd?define(e):(s=typeof globalThis<"u"?globalThis:s||self).dayjs=e()})(ae,function(){"use strict";var s=1e3,e=6e4,t=36e5,i="millisecond",r="second",a="minute",o="hour",n="day",d="week",m="month",b="quarter",S="year",O="date",pe="Invalid Date",Se=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,$e=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,Le={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(f){var p=["th","st","nd","rd"],c=f%100;return"["+f+(p[(c-20)%10]||p[c]||p[0])+"]"}},ne=function(f,p,c){var l=String(f);return!l||l.length>=p?f:""+Array(p+1-l.length).join(c)+f},Re={s:ne,z:function(f){var p=-f.utcOffset(),c=Math.abs(p),l=Math.floor(c/60),u=c%60;return(p<=0?"+":"-")+ne(l,2,"0")+":"+ne(u,2,"0")},m:function f(p,c){if(p.date()<c.date())return-f(c,p);var l=12*(c.year()-p.year())+(c.month()-p.month()),u=p.clone().add(l,m),y=c-u<0,g=p.clone().add(l+(y?-1:1),m);return+(-(l+(c-u)/(y?u-g:g-u))||0)},a:function(f){return f<0?Math.ceil(f)||0:Math.floor(f)},p:function(f){return{M:m,y:S,w:d,d:n,D:O,h:o,m:a,s:r,ms:i,Q:b}[f]||String(f||"").toLowerCase().replace(/s$/,"")},u:function(f){return f===void 0}},P="en",J={};J[P]=Le;var le="$isDayjsObject",se=function(f){return f instanceof Q||!(!f||!f[le])},z=function f(p,c,l){var u;if(!p)return P;if(typeof p=="string"){var y=p.toLowerCase();J[y]&&(u=y),c&&(J[y]=c,u=y);var g=p.split("-");if(!u&&g.length>1)return f(g[0])}else{var D=p.name;J[D]=p,u=D}return!l&&u&&(P=u),u||!l&&P},M=function(f,p){if(se(f))return f.clone();var c=typeof p=="object"?p:{};return c.date=f,c.args=arguments,new Q(c)},v=Re;v.l=z,v.i=se,v.w=function(f,p){return M(f,{locale:p.$L,utc:p.$u,x:p.$x,$offset:p.$offset})};var Q=(function(){function f(c){this.$L=z(c.locale,null,!0),this.parse(c),this.$x=this.$x||c.x||{},this[le]=!0}var p=f.prototype;return p.parse=function(c){this.$d=(function(l){var u=l.date,y=l.utc;if(u===null)return new Date(NaN);if(v.u(u))return new Date;if(u instanceof Date)return new Date(u);if(typeof u=="string"&&!/Z$/i.test(u)){var g=u.match(Se);if(g){var D=g[2]-1||0,w=(g[7]||"0").substring(0,3);return y?new Date(Date.UTC(g[1],D,g[3]||1,g[4]||0,g[5]||0,g[6]||0,w)):new Date(g[1],D,g[3]||1,g[4]||0,g[5]||0,g[6]||0,w)}}return new Date(u)})(c),this.init()},p.init=function(){var c=this.$d;this.$y=c.getFullYear(),this.$M=c.getMonth(),this.$D=c.getDate(),this.$W=c.getDay(),this.$H=c.getHours(),this.$m=c.getMinutes(),this.$s=c.getSeconds(),this.$ms=c.getMilliseconds()},p.$utils=function(){return v},p.isValid=function(){return this.$d.toString()!==pe},p.isSame=function(c,l){var u=M(c);return this.startOf(l)<=u&&u<=this.endOf(l)},p.isAfter=function(c,l){return M(c)<this.startOf(l)},p.isBefore=function(c,l){return this.endOf(l)<M(c)},p.$g=function(c,l,u){return v.u(c)?this[l]:this.set(u,c)},p.unix=function(){return Math.floor(this.valueOf()/1e3)},p.valueOf=function(){return this.$d.getTime()},p.startOf=function(c,l){var u=this,y=!!v.u(l)||l,g=v.p(c),D=function(_,R){var W=v.w(u.$u?Date.UTC(u.$y,R,_):new Date(u.$y,R,_),u);return y?W:W.endOf(n)},w=function(_,R){return v.w(u.toDate()[_].apply(u.toDate("s"),(y?[0,0,0,0]:[23,59,59,999]).slice(R)),u)},x=this.$W,L=this.$M,T=this.$D,j="set"+(this.$u?"UTC":"");switch(g){case S:return y?D(1,0):D(31,11);case m:return y?D(1,L):D(0,L+1);case d:var U=this.$locale().weekStart||0,B=(x<U?x+7:x)-U;return D(y?T-B:T+(6-B),L);case n:case O:return w(j+"Hours",0);case o:return w(j+"Minutes",1);case a:return w(j+"Seconds",2);case r:return w(j+"Milliseconds",3);default:return this.clone()}},p.endOf=function(c){return this.startOf(c,!1)},p.$set=function(c,l){var u,y=v.p(c),g="set"+(this.$u?"UTC":""),D=(u={},u[n]=g+"Date",u[O]=g+"Date",u[m]=g+"Month",u[S]=g+"FullYear",u[o]=g+"Hours",u[a]=g+"Minutes",u[r]=g+"Seconds",u[i]=g+"Milliseconds",u)[y],w=y===n?this.$D+(l-this.$W):l;if(y===m||y===S){var x=this.clone().set(O,1);x.$d[D](w),x.init(),this.$d=x.set(O,Math.min(this.$D,x.daysInMonth())).$d}else D&&this.$d[D](w);return this.init(),this},p.set=function(c,l){return this.clone().$set(c,l)},p.get=function(c){return this[v.p(c)]()},p.add=function(c,l){var u,y=this;c=Number(c);var g=v.p(l),D=function(L){var T=M(y);return v.w(T.date(T.date()+Math.round(L*c)),y)};if(g===m)return this.set(m,this.$M+c);if(g===S)return this.set(S,this.$y+c);if(g===n)return D(1);if(g===d)return D(7);var w=(u={},u[a]=e,u[o]=t,u[r]=s,u)[g]||1,x=this.$d.getTime()+c*w;return v.w(x,this)},p.subtract=function(c,l){return this.add(-1*c,l)},p.format=function(c){var l=this,u=this.$locale();if(!this.isValid())return u.invalidDate||pe;var y=c||"YYYY-MM-DDTHH:mm:ssZ",g=v.z(this),D=this.$H,w=this.$m,x=this.$M,L=u.weekdays,T=u.months,j=u.meridiem,U=function(R,W,Z,X){return R&&(R[W]||R(l,y))||Z[W].slice(0,X)},B=function(R){return v.s(D%12||12,R,"0")},_=j||function(R,W,Z){var X=R<12?"AM":"PM";return Z?X.toLowerCase():X};return y.replace($e,function(R,W){return W||(function(Z){switch(Z){case"YY":return String(l.$y).slice(-2);case"YYYY":return v.s(l.$y,4,"0");case"M":return x+1;case"MM":return v.s(x+1,2,"0");case"MMM":return U(u.monthsShort,x,T,3);case"MMMM":return U(T,x);case"D":return l.$D;case"DD":return v.s(l.$D,2,"0");case"d":return String(l.$W);case"dd":return U(u.weekdaysMin,l.$W,L,2);case"ddd":return U(u.weekdaysShort,l.$W,L,3);case"dddd":return L[l.$W];case"H":return String(D);case"HH":return v.s(D,2,"0");case"h":return B(1);case"hh":return B(2);case"a":return _(D,w,!0);case"A":return _(D,w,!1);case"m":return String(w);case"mm":return v.s(w,2,"0");case"s":return String(l.$s);case"ss":return v.s(l.$s,2,"0");case"SSS":return v.s(l.$ms,3,"0");case"Z":return g}return null})(R)||g.replace(":","")})},p.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},p.diff=function(c,l,u){var y,g=this,D=v.p(l),w=M(c),x=(w.utcOffset()-this.utcOffset())*e,L=this-w,T=function(){return v.m(g,w)};switch(D){case S:y=T()/12;break;case m:y=T();break;case b:y=T()/3;break;case d:y=(L-x)/6048e5;break;case n:y=(L-x)/864e5;break;case o:y=L/t;break;case a:y=L/e;break;case r:y=L/s;break;default:y=L}return u?y:v.a(y)},p.daysInMonth=function(){return this.endOf(m).$D},p.$locale=function(){return J[this.$L]},p.locale=function(c,l){if(!c)return this.$L;var u=this.clone(),y=z(c,l,!0);return y&&(u.$L=y),u},p.clone=function(){return v.w(this.$d,this)},p.toDate=function(){return new Date(this.valueOf())},p.toJSON=function(){return this.isValid()?this.toISOString():null},p.toISOString=function(){return this.$d.toISOString()},p.toString=function(){return this.$d.toUTCString()},f})(),fe=Q.prototype;return M.prototype=fe,[["$ms",i],["$s",r],["$m",a],["$H",o],["$W",n],["$M",m],["$y",S],["$D",O]].forEach(function(f){fe[f[1]]=function(p){return this.$g(p,f[0],f[1])}}),M.extend=function(f,p){return f.$i||(f(p,Q,M),f.$i=!0),M},M.locale=z,M.isDayjs=se,M.unix=function(f){return M(1e3*f)},M.en=J[P],M.Ls=J,M.p={},M})});var de,Te=new Uint8Array(16);function G(){if(!de){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");de=crypto.getRandomValues.bind(crypto)}return de(Te)}var $=[];for(let s=0;s<256;++s)$.push((s+256).toString(16).slice(1));function he(s,e=0){return($[s[e+0]]+$[s[e+1]]+$[s[e+2]]+$[s[e+3]]+"-"+$[s[e+4]]+$[s[e+5]]+"-"+$[s[e+6]]+$[s[e+7]]+"-"+$[s[e+8]]+$[s[e+9]]+"-"+$[s[e+10]]+$[s[e+11]]+$[s[e+12]]+$[s[e+13]]+$[s[e+14]]+$[s[e+15]]).toLowerCase()}var ce={};function Ne(s,e,t){let i;if(s)i=me(s.random??s.rng?.()??G(),s.msecs,s.seq,e,t);else{let r=Date.now(),a=G();Fe(ce,r,a),i=me(a,ce.msecs,ce.seq,e,t)}return e??he(i)}function Fe(s,e,t){return s.msecs??=-1/0,s.seq??=0,e>s.msecs?(s.seq=t[6]<<23|t[7]<<16|t[8]<<8|t[9],s.msecs=e):(s.seq=s.seq+1|0,s.seq===0&&s.msecs++),s}function me(s,e,t,i,r=0){if(s.length<16)throw new Error("Random bytes length must be >= 16");if(!i)i=new Uint8Array(16),r=0;else if(r<0||r+16>i.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);return e??=Date.now(),t??=s[6]*127<<24|s[7]<<16|s[8]<<8|s[9],i[r++]=e/1099511627776&255,i[r++]=e/4294967296&255,i[r++]=e/16777216&255,i[r++]=e/65536&255,i[r++]=e/256&255,i[r++]=e&255,i[r++]=112|t>>>28&15,i[r++]=t>>>20&255,i[r++]=128|t>>>14&63,i[r++]=t>>>6&255,i[r++]=t<<2&255|s[10]&3,i[r++]=s[11],i[r++]=s[12],i[r++]=s[13],i[r++]=s[14],i[r++]=s[15],i}var C=Ne;var K=class s{foods=A([]);constructor(){this.loadFoods()}loadFoods(){let e=localStorage.getItem("foods");e?this.foods.set(JSON.parse(e)):this.foods.set([])}addEditFood(e){this.foods().find(i=>i.id===e.id)?this.foods.update(i=>i.map(r=>r.id===e.id?e:r)):this.foods.update(i=>[...i,I(h({},e),{id:e.id||C()})]),localStorage.setItem("foods",JSON.stringify(this.foods()))}deleteFood(e){this.foods.update(t=>t.filter(i=>i.id!==e.id)),localStorage.setItem("foods",JSON.stringify(this.foods()))}downloadFoods(){let e=JSON.stringify(this.foods()),t=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(t),r=document.createElement("a");r.href=i,r.download="foods.json",r.click(),URL.revokeObjectURL(i)}setFoods(e){localStorage.setItem("foods",JSON.stringify(e)),this.loadFoods()}getFoodById(e){return this.foods().find(t=>t.id===e)}getFoodByBarcode(e){return this.foods().find(t=>t.barcode===e)}static \u0275fac=function(t){return new(t||s)};static \u0275prov=H({token:s,factory:s.\u0275fac,providedIn:"root"})};var De=(n=>(n[n.None=0]="None",n[n.Carbs=1]="Carbs",n[n.Proteins=2]="Proteins",n[n.Fats=3]="Fats",n[n.Vegetable=4]="Vegetable",n[n.Complex=5]="Complex",n[n.Other=6]="Other",n))(De||{}),Xe={0:{bgColor:"#302010"},1:{bgColor:"#706030"},2:{bgColor:"#305090"},3:{bgColor:"#805040"},4:{bgColor:"#208040"},5:{bgColor:"#654070"},6:{bgColor:"#333355"}};var ee=class{constructor(e="",t="",i=0,r=0,a=0,o=0,n=0,d=0,m=100,b="",S=""){this.id=e;this.name=t;this.macroCategory=i;this.protein=r;this.carbs=a;this.fats=o;this.fiber=n;this.calories=d;this.weight=m;this.barcode=b;this.note=S}};function be(s){return s&&typeof s=="object"&&typeof s.id=="string"&&typeof s.name=="string"&&typeof s.macroCategory=="number"&&typeof s.protein=="number"&&typeof s.carbs=="number"&&typeof s.fats=="number"&&typeof s.fiber=="number"&&typeof s.calories=="number"&&typeof s.weight=="number"&&(!s.barcode||typeof s.barcode=="string")&&typeof s.note=="string"}var te=(d=>(d[d.None=0]="None",d[d.MealOne=1]="MealOne",d[d.MealTwo=2]="MealTwo",d[d.MealThree=3]="MealThree",d[d.MealFour=4]="MealFour",d[d.MealFive=5]="MealFive",d[d.MealSix=6]="MealSix",d[d.Snacks=7]="Snacks",d))(te||{}),ue={0:"None",1:"Meal I",2:"Meal II",3:"Meal III",4:"Meal IV",5:"Meal V",6:"Meal VI",7:"Snacks"};var V=class{constructor(e=0,t=0,i=0,r=0,a=0,o=0){this.proteins=e;this.carbs=t;this.fats=i;this.fiber=r;this.calories=a;this.weight=o}};var k=class{constructor(e="",t="",i=[],r="",a,o=""){this.id=e;this.name=t;this.foods=i;this.note=r;this.time=a;this.imageId=o}};function Ce(s){return s?.foods?.length?s.foods.reduce((e,t)=>e+t.protein*t.weight*.01,0):0}function ke(s){return s?.foods?.length?s.foods.reduce((e,t)=>e+t.carbs*t.weight*.01,0):0}function Ee(s){return s?.foods?.length?s.foods.reduce((e,t)=>e+t.fats*t.weight*.01,0):0}function We(s){return s?.foods?.length?s.foods.reduce((e,t)=>e+t.fiber*t.weight*.01,0):0}function Je(s){return s?.foods?.length?s.foods.reduce((e,t)=>e+t.calories*t.weight*.01,0):0}function Ue(s){return s?.foods?.length?s.foods.reduce((e,t)=>e+t.weight,0):0}function nt(s){return new V(Ce(s),ke(s),Ee(s),We(s),Je(s),Ue(s))}var Y=class extends k{constructor(t="",i="",r=[],a=1,o="",n=""){super(t,i,r,o,void 0,n);this.portions=a}};function ct(s){return s&&typeof s=="object"&&typeof s.id=="string"&&typeof s.name=="string"&&typeof s.portions=="number"&&typeof s.note=="string"&&Array.isArray(s.foods)&&s.foods.every(e=>be(e))}var F=Oe(ge());var re=class{diaryDays=[]};var N=class{entries=[];weight;note;waterMl;activities=[]},q=class{constructor(e=0,t=new k,i=[]){this.position=e;this.meal=t;this.recipes=i}};var E=class{constructor(e,t=new N){this.date=e;this.dayTemplate=t}};var ie=class{constructor(e,t=0,i=15,r){this.time=e;this.type=t;this.durationMinutes=i;this.note=r}},we=(n=>(n[n.None=0]="None",n[n.Walk=1]="Walk",n[n.Aerobics=2]="Aerobics",n[n.Cardio=3]="Cardio",n[n.Sports=4]="Sports",n[n.Workout=5]="Workout",n[n.Other=6]="Other",n))(we||{}),mt={0:{icon:"fluent:border-none-24-filled"},1:{icon:"fa-solid:walking"},2:{icon:"icon-park-solid:sport"},3:{icon:"tabler:run"},4:{icon:"icon-park-solid:sporting"},5:{icon:"streamline-plump:dumbell-solid"},6:{icon:"hugeicons:activity-01"}};var Me=class s{diaryLog=A(void 0);constructor(){this.setDiaryLog(),this.loadDiaryLog()}setDiaryLog(){if(!localStorage.getItem("diaryLog")){let t=new re;localStorage.setItem("diaryLog",JSON.stringify(t))}}loadDiaryLog(){this.diaryLog.set(JSON.parse(localStorage.getItem("diaryLog")))}getRespectiveDayTemplate(e){return this.diaryLog()?.diaryDays.find(t=>t.date===e)?.dayTemplate}getRespectiveMeal(e,t){return this.getRespectiveDayTemplate(e)?.entries.find(i=>i.position===t)?.meal}updateMealTime(e,t){t=Number(t),this.diaryLog.update(i=>{let r=h({},i),a=r.diaryDays.find(d=>d.date===e);if(!a)return i;let o=a.dayTemplate.entries.find(d=>d.position===t);if(!o)return i;let n=(0,F.default)();return o.meal.time={hour:n.hour(),minute:n.minute(),second:0},r}),this.saveDiaryLog()}getRespectiveRecipes(e,t){return this.diaryLog()?.diaryDays.find(i=>i.date===e)?.dayTemplate.entries.find(i=>i.position===t)?.recipes}addFood(e,t,i){i=h({},i),t=Number(t),this.diaryLog.update(r=>{let a=h({},r),o=a.diaryDays.find(d=>d.date===e);if(!o){let d=new E(e,new N);a.diaryDays.push(d),o=d}let n=o.dayTemplate.entries.find(d=>d.position===t);return n?n.meal.foods.push(i):(n=new q(t,new k(C(),ue[t],[i]),[]),o.dayTemplate.entries.push(n)),a}),this.saveDiaryLog()}saveDiaryLog(){localStorage.setItem("diaryLog",JSON.stringify(this.diaryLog(),(e,t)=>e==="position"&&typeof t=="string"?te[t]:t))}updateMealName(e,t,i){this.diaryLog.update(r=>{let a=h({},r),o=a.diaryDays.find(d=>d.date===e);if(!o)return r;let n=o.dayTemplate.entries.find(d=>d.position===t);return n?(n.meal.name=i,a):r}),this.saveDiaryLog()}removeFood(e,t,i){this.diaryLog.update(r=>{let a=h({},r),o=a.diaryDays.find(d=>d.date===e);if(!o)return r;let n=o.dayTemplate.entries.find(d=>d.position===t);return n?(n.meal.foods=n.meal.foods.filter((d,m)=>m!==i),a):r}),this.saveDiaryLog()}removeRecipeFromPosition(e,t,i){this.diaryLog.update(r=>{let a=h({},r),o=a.diaryDays.find(d=>d.date===e);if(!o)return r;let n=o.dayTemplate.entries.find(d=>d.position===t);return n?(n.recipes=n.recipes.filter((d,m)=>m!==i),a):r}),this.saveDiaryLog()}updateRecipeFoodWeight(e,t,i,r,a){this.diaryLog.update(o=>{let n=h({},o),d=n.diaryDays.find(O=>O.date===e);if(!d)return o;let m=d.dayTemplate.entries.find(O=>O.position===t);if(!m)return o;let b=m.recipes?.[i];if(!b)return o;let S=b.foods?.[r];return S?(S.weight=Number(a),n):o}),this.saveDiaryLog()}removeFoodFromRecipe(e,t,i,r){this.diaryLog.update(a=>{let o=h({},a),n=o.diaryDays.find(S=>S.date===e);if(!n)return a;let d=n.dayTemplate.entries.find(S=>S.position===t);if(!d)return a;let m=d.recipes?.[i];return!m||!m.foods?.[r]?a:(m.foods=m.foods.filter((S,O)=>O!==r),o)}),this.saveDiaryLog()}clearMeal(e,t){this.diaryLog.update(i=>{let r=h({},i),a=r.diaryDays.find(n=>n.date===e);return!a||!a.dayTemplate.entries.find(n=>n.position===t)?i:(a.dayTemplate.entries=a.dayTemplate.entries.filter(n=>n.position!==t),r)}),this.saveDiaryLog()}updateFoodWeight(e,t,i,r){this.diaryLog.update(a=>{let o=h({},a),n=o.diaryDays.find(m=>m.date===e);if(!n)return a;let d=n.dayTemplate.entries.find(m=>m.position===t);return d?(d.meal.foods[i].weight=Number(r),o):a}),this.saveDiaryLog()}getDayStats(e){let t=this.diaryLog()?.diaryDays.find(r=>r.date===e),i=new V;if(!t)return i;for(let r of t.dayTemplate.entries){let a=[...r.meal.foods,...r.recipes.flatMap(o=>o.foods)];i.proteins+=a.reduce((o,n)=>o+n.protein*n.weight*.01,0),i.carbs+=a.reduce((o,n)=>o+n.carbs*n.weight*.01,0),i.fats+=a.reduce((o,n)=>o+n.fats*n.weight*.01,0),i.fiber+=a.reduce((o,n)=>o+n.fiber*n.weight*.01,0),i.calories+=a.reduce((o,n)=>o+n.calories*n.weight*.01,0),i.weight+=a.reduce((o,n)=>o+n.weight,0)}return i}getDayNote(e){return this.diaryLog()?.diaryDays?.find(t=>t.date===e)?.dayTemplate?.note??null}updateDayNote(e,t){this.diaryLog.update(i=>{let r=h({},i),a=r.diaryDays.find(o=>o.date===e);if(!a){let o=new E(e,new N);r.diaryDays.push(o),a=o}return a.dayTemplate.note=t,r}),this.saveDiaryLog()}getDayWater(e){return this.diaryLog()?.diaryDays?.find(t=>t.date===e)?.dayTemplate?.waterMl??null}updateDayWater(e,t){this.diaryLog.update(i=>{let r=h({},i),a=r.diaryDays.find(o=>o.date===e);if(!a){let o=new E(e,new N);r.diaryDays.push(o),a=o}return t?a.dayTemplate.waterMl=Number(t):delete a.dayTemplate.waterMl,r}),this.saveDiaryLog()}addDayWater(e,t){this.updateDayWater(e,(this.getDayWater(e)+t).toString())}subtractDayWater(e,t){let i=this.getDayWater(e);i<=t?this.updateDayWater(e,""):this.updateDayWater(e,(i-t).toString())}getPositionStats(e,t){let i=this.diaryLog()?.diaryDays.find(n=>n.date===e),r=new V;if(!i)return r;let a=i.dayTemplate.entries.find(n=>n.position===t);if(!a)return r;let o=[...a.meal.foods,...a.recipes.flatMap(n=>n.foods)];return{proteins:o.reduce((n,d)=>n+d.protein*d.weight*.01,0),carbs:o.reduce((n,d)=>n+d.carbs*d.weight*.01,0),fats:o.reduce((n,d)=>n+d.fats*d.weight*.01,0),fiber:o.reduce((n,d)=>n+d.fiber*d.weight*.01,0),calories:o.reduce((n,d)=>n+d.calories*d.weight*.01,0),weight:o.reduce((n,d)=>n+d.weight,0)}}updateMealNote(e,t,i){this.diaryLog.update(r=>{let a=h({},r),o=a.diaryDays.find(d=>d.date===e);if(!o)return r;let n=o.dayTemplate.entries.find(d=>d.meal.id===t);return n?(n.meal.note=i,a):r}),this.saveDiaryLog()}getExpandedMeal(){let e=localStorage.getItem("expandedMeal");return e?JSON.parse(e):null}toggleExpandedMeal(e,t){let i=this.getExpandedMeal();localStorage.setItem("expandedMeal",JSON.stringify({isoDate:i?.isoDate===e&&i?.mealPosition===t?"":e,mealPosition:i?.isoDate===e&&i?.mealPosition===t?0:t}))}expandMeal(e,t){localStorage.setItem("expandedMeal",JSON.stringify({isoDate:e,mealPosition:t}))}addRecipe(e,t,i,r){this.diaryLog.update(a=>{let o=h({},a),n=o.diaryDays.find(b=>b.date===e);if(!n){let b=new E(e,new N);o.diaryDays.push(b),n=b}let d=n.dayTemplate.entries.find(b=>b.position===t),m=new Y(C(),r.name,r.foods.map(b=>new ee(b.id,b.name,b.macroCategory,b.protein,b.carbs,b.fats,b.fiber,b.calories,b.weight*(i/r.portions),b.note)),i,r.note);return d?(d.recipes.push(m),d.meal.imageId=r.imageId):(d=new q(t,new k(C(),ue[t],[],void 0,void 0,r.imageId),[m]),n.dayTemplate.entries.push(d)),o}),this.saveDiaryLog()}hasFoodOnDate(e){let t=this.diaryLog()?.diaryDays.find(i=>i.date===e);if(!t)return!1;for(let i of t.dayTemplate.entries)if(i.meal.foods.length>0||i.recipes.length>0)return!0;return!1}hasWeightInOnDate(e){return!!this.diaryLog()?.diaryDays.find(t=>t.date===e)?.dayTemplate?.weight}hasWaterOnDate(e){return!!this.diaryLog()?.diaryDays.find(t=>t.date===e)?.dayTemplate?.waterMl}hasActivitiesOnDate(e){return!!this.diaryLog()?.diaryDays.find(t=>t.date===e)?.dayTemplate?.activities?.some(t=>!!t.durationMinutes&&t.type!==0)}getCurrentWeight(e){let t=this.diaryLog()?.diaryDays.find(i=>i.date===e);return t?t.dayTemplate.weight??null:null}updateCurrentWeight(e,t){this.diaryLog.update(i=>{let r=h({},i),a=r.diaryDays.find(o=>o.date===e);if(!a){let o=new E(e,new N);r.diaryDays.push(o),a=o}return t?a.dayTemplate.weight=Number(t):delete a.dayTemplate.weight,r}),this.saveDiaryLog()}getWeightByFormula(e,t){let i=(0,F.default)(e).utc().startOf("day"),r=[];for(let o=0;o<t;o++){let n=i.subtract(o,"day").toISOString(),d=this.getCurrentWeight(n);d&&r.push(d)}if(!r.length)return 0;if(r.sort(),r.length<=3)return r.reduce((o,n)=>o+n,0)/r.length;let a=Math.floor(r.length/2);return r.length%2===0?(r[a-1]+r[a])/2:(r[a-1]+r[a]+r[a+1])/3}getWeights(e,t){let i=F.default.min((0,F.default)(e).utc().startOf("day"),(0,F.default)().utc().startOf("day")),r=[],a=0;for(let o=0;o<t;o++){let n=i.subtract(o,"day").toISOString();a=this.getCurrentWeight(n),a&&r.push(a)}return r.reverse(),r}getCalorie(e){return this.getDayStats(e).calories}getCalories(e,t){let i=F.default.min((0,F.default)(e).utc().startOf("day"),(0,F.default)().utc().startOf("day")),r=[],a=0;for(let o=0;o<t;o++){let n=i.subtract(o,"day").toISOString();a=this.getCalorie(n),a&&r.push(a)}return r.reverse(),r}getActivities(e){return this.diaryLog()?.diaryDays.find(t=>t.date===e)?.dayTemplate.activities??[]}addActivity(e){this.diaryLog.update(t=>{let i=h({},t),r=i.diaryDays.find(d=>d.date===e);if(!r){let d=new E(e,new N);i.diaryDays.push(d),r=d}let a=r.dayTemplate.activities,o=(0,F.default)(),n=new ie({hour:o.hour(),minute:o.minute(),second:0});return a?.length?a.push(n):r.dayTemplate.activities=[n],i}),this.saveDiaryLog()}removeActivity(e,t){this.diaryLog.update(i=>{let r=h({},i),a=r.diaryDays.find(o=>o.date===e);return a?(a.dayTemplate.activities=a.dayTemplate.activities.filter((o,n)=>n!==t),r):i}),this.saveDiaryLog()}setActivityType(e,t,i){this.diaryLog.update(r=>{let a=h({},r),o=a.diaryDays.find(n=>n.date===e);return o?(o.dayTemplate.activities[t].type=i,a):r}),this.saveDiaryLog()}downloadDiary(){let e=JSON.stringify(this.diaryLog()),t=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(t),r=document.createElement("a");r.href=i,r.download="diary.json",r.click(),URL.revokeObjectURL(i)}setDiary(e){localStorage.setItem("diaryLog",JSON.stringify(e)),this.loadDiaryLog()}deleteMealImage(e){this.diaryLog.update(t=>{let i=h({},t);for(let r of i.diaryDays)for(let a of r.dayTemplate.entries)a.meal.imageId===e&&delete a.meal.imageId;return i}),this.saveDiaryLog()}static \u0275fac=function(t){return new(t||s)};static \u0275prov=H({token:s,factory:s.\u0275fac,providedIn:"root"})};var xe=class s{foodsService=ye(K);recipes=A([]);expandedRecipeId=A("");constructor(){this.loadRecipes(),this.loadExpandedRecipeId()}loadRecipes(){let e=localStorage.getItem("recipes");e?this.recipes.set(JSON.parse(e)):this.recipes.set([])}loadExpandedRecipeId(){let e=localStorage.getItem("expandedRecipeId");e?this.expandedRecipeId.set(JSON.parse(e)):this.expandedRecipeId.set("")}saveRecipes(){localStorage.setItem("recipes",JSON.stringify(this.recipes()))}setRecipes(e){localStorage.setItem("recipes",JSON.stringify(e)),this.loadRecipes()}downloadRecipes(){let e=JSON.stringify(this.recipes()),t=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(t),r=document.createElement("a");r.href=i,r.download="recipes.json",r.click(),URL.revokeObjectURL(i)}addRecipe(){return this.recipes.update(e=>[new Y(C(),"Empty recipe"),...e]),this.saveRecipes(),this.recipes()[0].id}updateRecipeName(e,t){this.recipes.update(i=>i.map(r=>r.id===e?I(h({},r),{name:t}):r)),this.saveRecipes()}updateRecipeNote(e,t){this.recipes.update(i=>i.map(r=>r.id===e?I(h({},r),{note:t}):r)),this.saveRecipes()}addFood(e,t){this.recipes.update(i=>i.map(r=>{if(r.id===e){let a=this.foodsService.getFoodById(t);if(a)return I(h({},r),{foods:[...r.foods,h({},a)]})}return r})),this.saveRecipes()}updateFoodWeight(e,t,i){this.recipes.update(r=>r.map(a=>a.id===e?I(h({},a),{foods:a.foods.map((o,n)=>n===t?I(h({},o),{weight:+i}):o)}):a)),this.saveRecipes()}updateRecipePortions(e,t){this.recipes.update(i=>i.map(r=>r.id===e?I(h({},r),{portions:+t}):r)),this.saveRecipes()}removeFood(e,t){this.recipes.update(i=>i.map(r=>r.id===e?I(h({},r),{foods:r.foods.filter((a,o)=>o!==t)}):r)),this.recipes().find(i=>i.id===e&&i.foods.length===0)&&this.recipes.update(i=>i.filter(r=>r.id!==e)),this.saveRecipes()}changeFoodOrder(e,t,i){this.recipes.update(r=>r.map(a=>a.id===e?I(h({},a),{foods:a.foods.map((o,n)=>n===t?a.foods[i]:n===i?a.foods[t]:a.foods[n])}):a)),this.saveRecipes()}getRecipeById(e){return this.recipes().find(t=>t.id===e)}setExpandedRecipeId(e){this.expandedRecipeId.set(e),localStorage.setItem("expandedRecipeId",JSON.stringify(this.expandedRecipeId()))}toggleExpandedRecipeId(e){e===this.expandedRecipeId()?this.expandedRecipeId.set(""):this.expandedRecipeId.set(e),localStorage.setItem("expandedRecipeId",JSON.stringify(this.expandedRecipeId()))}setImage(e,t){this.recipes.update(i=>i.map(r=>r.id===e?I(h({},r),{imageId:t}):r)),this.saveRecipes()}deleteImage(e){this.recipes.update(t=>t.map(i=>i.imageId===e?I(h({},i),{imageId:""}):i)),this.saveRecipes()}anyImage(e){return this.recipes().some(t=>t.imageId===e)}static \u0275fac=function(t){return new(t||s)};static \u0275prov=H({token:s,factory:s.\u0275fac,providedIn:"root"})};export{ge as a,C as b,K as c,De as d,Xe as e,ee as f,be as g,te as h,ue as i,k as j,Ce as k,ke as l,Ee as m,We as n,Je as o,Ue as p,nt as q,N as r,ct as s,we as t,mt as u,Me as v,xe as w};

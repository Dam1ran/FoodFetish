import{d as B,g as q,i as z,l as H,o as G}from"./chunk-QY6R6ZC5.js";import{a as Y}from"./chunk-2KTHP7SW.js";import{f as Q,u as X}from"./chunk-KHSIFIAT.js";import{a as ae}from"./chunk-P7OX43DN.js";import{a as K}from"./chunk-TTUD5ZDE.js";import{Ea as N,Fb as D,Hb as U,Qb as P,Tb as j,Xa as f,Yb as L,Zb as F,_b as O,aa as u,e as ne,fa as g,fc as R,ga as p,jb as k,kb as x,pb as I,qb as c,qc as V,ra as w,rb as l,rc as y,sa as M,sb as b,uc as E,vc as W,xc as A,yb as T}from"./chunk-HXGKTDM5.js";var h=ne(ae()),Z=class r{static getStartOfToday(t=!0){return t?(0,h.default)().utc().startOf("day"):(0,h.default)().startOf("day")}static fromNgbDateStruct(t,e=!0){return r.getStartOfToday(e).set("year",t.year??0).set("month",(t.month??1)-1).set("date",t.day??1)}static toNgbDateStruct(t){let e=typeof t=="string"?(0,h.default)(t):t;return{year:e.year(),month:e.month()+1,day:e.date()}}};var se=(r,t)=>({filter:r,opacity:t});function ce(r,t){if(r&1&&b(0,"img",2),r&2){let e=U();j(R(5,se,e.stretched()?"blur(4px) grayscale(25%)":"unset",e.stretched()?.2:1)),I("width",e.stretched()?320:160)("height",(e.stretched(),160))("src",e.imageDataUrl(),N)}}function le(r,t){r&1&&(c(0,"div",1),b(1,"iconify",3),l())}var J=class r{imageId=y.required();stretched=y(!1,{transform:A});imageStoreService=u(Y);imageDataUrl=w(null);diaryLogService=u(X);deleteChange=V();cdr=u(W);constructor(){M(()=>{let t=this.imageId();t?this.imageStoreService.get(t).then(e=>{this.imageDataUrl.set(e),e||(this.deleteChange.emit(t),this.cdr.detectChanges())}):this.imageDataUrl.set(null)})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=f({type:r,selectors:[["meal-thumb"]],inputs:{imageId:[1,"imageId"],stretched:[1,"stretched"]},outputs:{deleteChange:"deleteChange"},decls:2,vars:1,consts:[["alt","meal thumb",2,"object-fit","cover",3,"width","height","src","style"],[1,"d-flex","justify-content-center","align-items-center",2,"width","160px","height","160px"],["alt","meal thumb",2,"object-fit","cover",3,"width","height","src"],["icon","streamline:broken-link-2",1,"opacity-50"]],template:function(e,a){e&1&&k(0,ce,1,8,"img",0)(1,le,2,0,"div",1),e&2&&x(a.imageDataUrl()?0:1)},dependencies:[K],encapsulation:2})};function ye(r,t=320,e=320,a=.25){return new Promise((s,o)=>{let n=URL.createObjectURL(r),i=new Image;i.onload=()=>{let v=Math.max(t/i.naturalWidth,e/i.naturalHeight),S=i.naturalWidth*v,_=i.naturalHeight*v,ee=(t-S)/2,te=(e-_)/2,d=document.createElement("canvas");d.width=t,d.height=e,d.getContext("2d").drawImage(i,ee,te,S,_),d.toBlob(C=>{if(URL.revokeObjectURL(n),!C){o(new Error("Failed to create blob from canvas"));return}let m=new FileReader;m.onloadend=()=>{let re=m.result;s(re.split(",")[1])},m.onerror=()=>o(new Error("Failed to read blob as base64")),m.readAsDataURL(C)},"image/jpeg",a)},i.onerror=()=>{URL.revokeObjectURL(n),o(new Error("Failed to load image"))},i.src=n})}var $=class r{selectedDate=E();onDateSelected(t){}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=f({type:r,selectors:[["date-picker"]],inputs:{selectedDate:[1,"selectedDate"]},outputs:{selectedDate:"selectedDateChange"},decls:3,vars:1,consts:[["d","ngbDatepicker"],["name","dp","ngbDatepicker","","autofocus","false","tabindex","-1",1,"form-control","p-1",2,"position","absolute","opacity","0","pointer-events","none",3,"ngModelChange","dateSelect","ngModel"],["buttonIcon","fluent:calendar-20-regular",1,"btn","p-0","btn-sm","border-0",3,"click"]],template:function(e,a){if(e&1){let s=T();c(0,"input",1,0),O("ngModelChange",function(n){return g(s),F(a.selectedDate,n)||(a.selectedDate=n),p(n)}),D("dateSelect",function(n){return g(s),p(a.onDateSelected(n))}),l(),c(2,"button",2),D("click",function(){g(s);let n=P(1);return p(n.toggle())}),l()}e&2&&L("ngModel",a.selectedDate)},dependencies:[Q,G,H,B,q,z],styles:["[_nghost-%COMP%]{position:relative}"]})};export{$ as a,Z as b,J as c,ye as d};

import{X as d}from"./chunk-HXGKTDM5.js";var m=class i{dbName="food-fetish-images-db";storeName="images";dbVersion=1;cache=new Map;openDb(){return new Promise((t,r)=>{let e=indexedDB.open(this.dbName,this.dbVersion);e.onupgradeneeded=()=>{let s=e.result;s.objectStoreNames.contains(this.storeName)||s.createObjectStore(this.storeName,{keyPath:"imageId"})},e.onsuccess=()=>t(e.result),e.onerror=()=>r(e.error)})}async put(t,r){let e=await this.openDb();return new Promise((s,o)=>{let a=e.transaction(this.storeName,"readwrite"),n=`data:image/jpeg;base64,${r}`;a.objectStore(this.storeName).put({imageId:t,base64:n}),a.oncomplete=()=>{this.cache.set(t,n),s(n)},a.onerror=()=>o(a.error)})}async get(t){let r=this.cache.get(t);if(r!==void 0)return r;let e=await this.openDb();return new Promise((s,o)=>{let n=e.transaction(this.storeName,"readonly").objectStore(this.storeName).get(t);n.onsuccess=()=>{let c=n.result;c?(this.cache.set(t,c.base64),s(c.base64)):s(null)},n.onerror=()=>o(n.error)})}deleteDatabase(){return this.cache.clear(),new Promise((t,r)=>{let e=indexedDB.deleteDatabase(this.dbName);e.onsuccess=()=>t(),e.onerror=()=>r(e.error)})}async delete(t){let r=await this.openDb();return new Promise((e,s)=>{let o=r.transaction(this.storeName,"readwrite");o.objectStore(this.storeName).delete(t),o.oncomplete=()=>{this.cache.delete(t),e()},o.onerror=()=>s(o.error)})}static \u0275fac=function(r){return new(r||i)};static \u0275prov=d({token:i,factory:i.\u0275fac,providedIn:"root"})};export{m as a};

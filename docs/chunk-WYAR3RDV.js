import{c as C}from"./chunk-LAXI4DWS.js";import{d as I,g as v,h as u,p as x}from"./chunk-ZSUZL2E2.js";import{a as h}from"./chunk-7QS2YA2B.js";import{X as T,a as p,e as N,ra as S}from"./chunk-4ENOABGI.js";var D=(e=>(e[e.None=0]="None",e[e.MealOne=1]="MealOne",e[e.MealTwo=2]="MealTwo",e[e.MealThree=3]="MealThree",e[e.MealFour=4]="MealFour",e[e.Snacks=5]="Snacks",e))(D||{}),b={0:"None",1:"Meal I",2:"Meal II",3:"Meal III",4:"Meal IV",5:"Snacks"};var m=N(C());var w=class{diaryDays=[]};var y=class{entries=[];weight},f=class{constructor(o=0,r=new u,i=[]){this.position=o;this.meal=r;this.recipes=i}};var g=class{constructor(o,r=new y){this.date=o;this.dayTemplate=r}};var E=class l{diaryLog=S(void 0);constructor(){this.setDiaryLog(),this.loadDiaryLog()}setDiaryLog(){if(!localStorage.getItem("diaryLog")){let r=new w;localStorage.setItem("diaryLog",JSON.stringify(r))}}loadDiaryLog(){this.diaryLog.set(JSON.parse(localStorage.getItem("diaryLog")))}getRespectiveMeal(o,r){return this.diaryLog()?.diaryDays.find(i=>i.date===o)?.dayTemplate.entries.find(i=>i.position===r)?.meal}getRespectiveRecipes(o,r){return this.diaryLog()?.diaryDays.find(i=>i.date===o)?.dayTemplate.entries.find(i=>i.position===r)?.recipes}addFood(o,r,i){i=p({},i),r=Number(r),this.diaryLog.update(a=>{let s=p({},a),e=s.diaryDays.find(n=>n.date===o);if(!e){let n=new g(o,new y);s.diaryDays.push(n),e=n}let t=e.dayTemplate.entries.find(n=>n.position===r);return t?t.meal.foods.push(i):(t=new f(r,new u(h(),b[r],[i]),[]),e.dayTemplate.entries.push(t)),s}),this.saveDiaryLog()}saveDiaryLog(){localStorage.setItem("diaryLog",JSON.stringify(this.diaryLog(),(o,r)=>o==="position"&&typeof r=="string"?D[r]:r))}updateMealName(o,r,i){this.diaryLog.update(a=>{let s=p({},a),e=s.diaryDays.find(n=>n.date===o);if(!e)return a;let t=e.dayTemplate.entries.find(n=>n.position===r);return t?(t.meal.name=i,s):a}),this.saveDiaryLog()}removeFood(o,r,i){this.diaryLog.update(a=>{let s=p({},a),e=s.diaryDays.find(n=>n.date===o);if(!e)return a;let t=e.dayTemplate.entries.find(n=>n.position===r);return t?(t.meal.foods=t.meal.foods.filter((n,c)=>c!==i),s):a}),this.saveDiaryLog()}removeRecipeFromPosition(o,r,i){this.diaryLog.update(a=>{let s=p({},a),e=s.diaryDays.find(n=>n.date===o);if(!e)return a;let t=e.dayTemplate.entries.find(n=>n.position===r);return t?(t.recipes=t.recipes.filter((n,c)=>c!==i),s):a}),this.saveDiaryLog()}updateRecipeFoodWeight(o,r,i,a,s){this.diaryLog.update(e=>{let t=p({},e),n=t.diaryDays.find(M=>M.date===o);if(!n)return e;let c=n.dayTemplate.entries.find(M=>M.position===r);if(!c)return e;let d=c.recipes?.[i];if(!d)return e;let L=d.foods?.[a];return L?(L.weight=Number(s),t):e}),this.saveDiaryLog()}clearMeal(o,r){this.diaryLog.update(i=>{let a=p({},i),s=a.diaryDays.find(t=>t.date===o);return!s||!s.dayTemplate.entries.find(t=>t.position===r)?i:(s.dayTemplate.entries=s.dayTemplate.entries.filter(t=>t.position!==r),a)}),this.saveDiaryLog()}updateFoodWeight(o,r,i,a){this.diaryLog.update(s=>{let e=p({},s),t=e.diaryDays.find(c=>c.date===o);if(!t)return s;let n=t.dayTemplate.entries.find(c=>c.position===r);return n?(n.meal.foods[i].weight=Number(a),e):s}),this.saveDiaryLog()}getDayStats(o){let r=this.diaryLog()?.diaryDays.find(a=>a.date===o),i=new v;if(!r)return i;for(let a of r.dayTemplate.entries){let s=[...a.meal.foods,...a.recipes.flatMap(e=>e.foods)];i.proteins+=s.reduce((e,t)=>e+t.protein*t.weight*.01,0),i.carbs+=s.reduce((e,t)=>e+t.carbs*t.weight*.01,0),i.fats+=s.reduce((e,t)=>e+t.fats*t.weight*.01,0),i.fiber+=s.reduce((e,t)=>e+t.fiber*t.weight*.01,0),i.calories+=s.reduce((e,t)=>e+t.calories*t.weight*.01,0),i.weight+=s.reduce((e,t)=>e+t.weight,0)}return i}getPositionStats(o,r){let i=this.diaryLog()?.diaryDays.find(t=>t.date===o),a=new v;if(!i)return a;let s=i.dayTemplate.entries.find(t=>t.position===r);if(!s)return a;let e=[...s.meal.foods,...s.recipes.flatMap(t=>t.foods)];return{proteins:e.reduce((t,n)=>t+n.protein*n.weight*.01,0),carbs:e.reduce((t,n)=>t+n.carbs*n.weight*.01,0),fats:e.reduce((t,n)=>t+n.fats*n.weight*.01,0),fiber:e.reduce((t,n)=>t+n.fiber*n.weight*.01,0),calories:e.reduce((t,n)=>t+n.calories*n.weight*.01,0),weight:e.reduce((t,n)=>t+n.weight,0)}}updateMealNote(o,r,i){this.diaryLog.update(a=>{let s=p({},a),e=s.diaryDays.find(n=>n.date===o);if(!e)return a;let t=e.dayTemplate.entries.find(n=>n.meal.id===r);return t?(t.meal.note=i,s):a}),this.saveDiaryLog()}getExpandedMeal(){let o=localStorage.getItem("expandedMeal");return o?JSON.parse(o):null}toggleExpandedMeal(o,r){let i=this.getExpandedMeal();localStorage.setItem("expandedMeal",JSON.stringify({isoDate:i?.isoDate===o&&i?.mealPosition===r?"":o,mealPosition:i?.isoDate===o&&i?.mealPosition===r?0:r}))}expandMeal(o,r){localStorage.setItem("expandedMeal",JSON.stringify({isoDate:o,mealPosition:r}))}addRecipe(o,r,i,a){this.diaryLog.update(s=>{let e=p({},s),t=e.diaryDays.find(d=>d.date===o);if(!t){let d=new g(o,new y);e.diaryDays.push(d),t=d}let n=t.dayTemplate.entries.find(d=>d.position===r),c=new x(h(),a.name,a.foods.map(d=>new I(d.id,d.name,d.macroCategory,d.protein,d.carbs,d.fats,d.fiber,d.calories,d.weight*(i/a.portions),d.note)),i,a.note);return n?n.recipes.push(c):(n=new f(r,new u(h(),b[r],[]),[c]),t.dayTemplate.entries.push(n)),e}),this.saveDiaryLog()}hasFoodOnDate(o){let r=this.diaryLog()?.diaryDays.find(i=>i.date===o);if(!r)return!1;for(let i of r.dayTemplate.entries)if(i.meal.foods.length>0||i.recipes.length>0)return!0;return!1}getCurrentWeight(o){let r=this.diaryLog()?.diaryDays.find(i=>i.date===o);return r?r.dayTemplate.weight??null:null}updateCurrentWeight(o,r){this.diaryLog.update(i=>{let a=p({},i),s=a.diaryDays.find(e=>e.date===o);if(!s){let e=new g(o,new y);a.diaryDays.push(e),s=e}return r?s.dayTemplate.weight=Number(r):delete s.dayTemplate.weight,a}),this.saveDiaryLog()}getWeightByFormula(o,r){let i=(0,m.default)(o).utc(),a=[];for(let e=0;e<r;e++){let t=i.subtract(e,"day").toISOString(),n=this.getCurrentWeight(t);n&&a.push(n)}if(!a.length)return 0;if(a.sort(),a.length<=3)return a.reduce((e,t)=>e+t,0)/a.length;let s=Math.floor(a.length/2);return a.length%2===0?(a[s-1]+a[s])/2:(a[s-1]+a[s]+a[s+1])/3}getWeights(o,r){let i=m.default.min((0,m.default)(o).utc().startOf("day"),(0,m.default)().utc().startOf("day")),a=[],s=0;for(let e=0;e<r;e++){let t=i.subtract(e,"day").toISOString();s=this.getCurrentWeight(t),s&&a.push(s)}return a.reverse(),a}static \u0275fac=function(r){return new(r||l)};static \u0275prov=T({token:l,factory:l.\u0275fac,providedIn:"root"})};export{D as a,b,y as c,E as d};

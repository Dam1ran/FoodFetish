import{c as E}from"./chunk-LAXI4DWS.js";import{d as I,g as v,h as u,p as N}from"./chunk-ZSUZL2E2.js";import{a as h}from"./chunk-7QS2YA2B.js";import{X as T,a as y,e as x,ra as S}from"./chunk-4ENOABGI.js";var D=(e=>(e[e.None=0]="None",e[e.MealOne=1]="MealOne",e[e.MealTwo=2]="MealTwo",e[e.MealThree=3]="MealThree",e[e.MealFour=4]="MealFour",e[e.Snacks=5]="Snacks",e))(D||{}),L={0:"None",1:"Meal I",2:"Meal II",3:"Meal III",4:"Meal IV",5:"Snacks"};var m=x(E());var w=class{diaryDays=[]};var c=class{entries=[];weight;note;waterMl},f=class{constructor(i=0,t=new u,a=[]){this.position=i;this.meal=t;this.recipes=a}};var g=class{constructor(i,t=new c){this.date=i;this.dayTemplate=t}};var W=class l{diaryLog=S(void 0);constructor(){this.setDiaryLog(),this.loadDiaryLog()}setDiaryLog(){if(!localStorage.getItem("diaryLog")){let t=new w;localStorage.setItem("diaryLog",JSON.stringify(t))}}loadDiaryLog(){this.diaryLog.set(JSON.parse(localStorage.getItem("diaryLog")))}getRespectiveMeal(i,t){return this.diaryLog()?.diaryDays.find(a=>a.date===i)?.dayTemplate.entries.find(a=>a.position===t)?.meal}getRespectiveRecipes(i,t){return this.diaryLog()?.diaryDays.find(a=>a.date===i)?.dayTemplate.entries.find(a=>a.position===t)?.recipes}addFood(i,t,a){a=y({},a),t=Number(t),this.diaryLog.update(n=>{let s=y({},n),e=s.diaryDays.find(o=>o.date===i);if(!e){let o=new g(i,new c);s.diaryDays.push(o),e=o}let r=e.dayTemplate.entries.find(o=>o.position===t);return r?r.meal.foods.push(a):(r=new f(t,new u(h(),L[t],[a]),[]),e.dayTemplate.entries.push(r)),s}),this.saveDiaryLog()}saveDiaryLog(){localStorage.setItem("diaryLog",JSON.stringify(this.diaryLog(),(i,t)=>i==="position"&&typeof t=="string"?D[t]:t))}updateMealName(i,t,a){this.diaryLog.update(n=>{let s=y({},n),e=s.diaryDays.find(o=>o.date===i);if(!e)return n;let r=e.dayTemplate.entries.find(o=>o.position===t);return r?(r.meal.name=a,s):n}),this.saveDiaryLog()}removeFood(i,t,a){this.diaryLog.update(n=>{let s=y({},n),e=s.diaryDays.find(o=>o.date===i);if(!e)return n;let r=e.dayTemplate.entries.find(o=>o.position===t);return r?(r.meal.foods=r.meal.foods.filter((o,p)=>p!==a),s):n}),this.saveDiaryLog()}removeRecipeFromPosition(i,t,a){this.diaryLog.update(n=>{let s=y({},n),e=s.diaryDays.find(o=>o.date===i);if(!e)return n;let r=e.dayTemplate.entries.find(o=>o.position===t);return r?(r.recipes=r.recipes.filter((o,p)=>p!==a),s):n}),this.saveDiaryLog()}updateRecipeFoodWeight(i,t,a,n,s){this.diaryLog.update(e=>{let r=y({},e),o=r.diaryDays.find(M=>M.date===i);if(!o)return e;let p=o.dayTemplate.entries.find(M=>M.position===t);if(!p)return e;let d=p.recipes?.[a];if(!d)return e;let b=d.foods?.[n];return b?(b.weight=Number(s),r):e}),this.saveDiaryLog()}clearMeal(i,t){this.diaryLog.update(a=>{let n=y({},a),s=n.diaryDays.find(r=>r.date===i);return!s||!s.dayTemplate.entries.find(r=>r.position===t)?a:(s.dayTemplate.entries=s.dayTemplate.entries.filter(r=>r.position!==t),n)}),this.saveDiaryLog()}updateFoodWeight(i,t,a,n){this.diaryLog.update(s=>{let e=y({},s),r=e.diaryDays.find(p=>p.date===i);if(!r)return s;let o=r.dayTemplate.entries.find(p=>p.position===t);return o?(o.meal.foods[a].weight=Number(n),e):s}),this.saveDiaryLog()}getDayStats(i){let t=this.diaryLog()?.diaryDays.find(n=>n.date===i),a=new v;if(!t)return a;for(let n of t.dayTemplate.entries){let s=[...n.meal.foods,...n.recipes.flatMap(e=>e.foods)];a.proteins+=s.reduce((e,r)=>e+r.protein*r.weight*.01,0),a.carbs+=s.reduce((e,r)=>e+r.carbs*r.weight*.01,0),a.fats+=s.reduce((e,r)=>e+r.fats*r.weight*.01,0),a.fiber+=s.reduce((e,r)=>e+r.fiber*r.weight*.01,0),a.calories+=s.reduce((e,r)=>e+r.calories*r.weight*.01,0),a.weight+=s.reduce((e,r)=>e+r.weight,0)}return a}getDayNote(i){return this.diaryLog()?.diaryDays?.find(t=>t.date===i)?.dayTemplate?.note??null}updateDayNote(i,t){this.diaryLog.update(a=>{let n=y({},a),s=n.diaryDays.find(e=>e.date===i);if(!s){let e=new g(i,new c);n.diaryDays.push(e),s=e}return s.dayTemplate.note=t,n}),this.saveDiaryLog()}getDayWater(i){return this.diaryLog()?.diaryDays?.find(t=>t.date===i)?.dayTemplate?.waterMl??null}updateDayWater(i,t){this.diaryLog.update(a=>{let n=y({},a),s=n.diaryDays.find(e=>e.date===i);if(!s){let e=new g(i,new c);n.diaryDays.push(e),s=e}return t?s.dayTemplate.waterMl=Number(t):delete s.dayTemplate.waterMl,n}),this.saveDiaryLog()}addDayWater(i,t){this.updateDayWater(i,(this.getDayWater(i)+t).toString())}subtractDayWater(i,t){let a=this.getDayWater(i);a<=t?this.updateDayWater(i,""):this.updateDayWater(i,(a-t).toString())}getPositionStats(i,t){let a=this.diaryLog()?.diaryDays.find(r=>r.date===i),n=new v;if(!a)return n;let s=a.dayTemplate.entries.find(r=>r.position===t);if(!s)return n;let e=[...s.meal.foods,...s.recipes.flatMap(r=>r.foods)];return{proteins:e.reduce((r,o)=>r+o.protein*o.weight*.01,0),carbs:e.reduce((r,o)=>r+o.carbs*o.weight*.01,0),fats:e.reduce((r,o)=>r+o.fats*o.weight*.01,0),fiber:e.reduce((r,o)=>r+o.fiber*o.weight*.01,0),calories:e.reduce((r,o)=>r+o.calories*o.weight*.01,0),weight:e.reduce((r,o)=>r+o.weight,0)}}updateMealNote(i,t,a){this.diaryLog.update(n=>{let s=y({},n),e=s.diaryDays.find(o=>o.date===i);if(!e)return n;let r=e.dayTemplate.entries.find(o=>o.meal.id===t);return r?(r.meal.note=a,s):n}),this.saveDiaryLog()}getExpandedMeal(){let i=localStorage.getItem("expandedMeal");return i?JSON.parse(i):null}toggleExpandedMeal(i,t){let a=this.getExpandedMeal();localStorage.setItem("expandedMeal",JSON.stringify({isoDate:a?.isoDate===i&&a?.mealPosition===t?"":i,mealPosition:a?.isoDate===i&&a?.mealPosition===t?0:t}))}expandMeal(i,t){localStorage.setItem("expandedMeal",JSON.stringify({isoDate:i,mealPosition:t}))}addRecipe(i,t,a,n){this.diaryLog.update(s=>{let e=y({},s),r=e.diaryDays.find(d=>d.date===i);if(!r){let d=new g(i,new c);e.diaryDays.push(d),r=d}let o=r.dayTemplate.entries.find(d=>d.position===t),p=new N(h(),n.name,n.foods.map(d=>new I(d.id,d.name,d.macroCategory,d.protein,d.carbs,d.fats,d.fiber,d.calories,d.weight*(a/n.portions),d.note)),a,n.note);return o?o.recipes.push(p):(o=new f(t,new u(h(),L[t],[]),[p]),r.dayTemplate.entries.push(o)),e}),this.saveDiaryLog()}hasFoodOnDate(i){let t=this.diaryLog()?.diaryDays.find(a=>a.date===i);if(!t)return!1;for(let a of t.dayTemplate.entries)if(a.meal.foods.length>0||a.recipes.length>0)return!0;return!1}hasWeightInOnDate(i){return!!this.diaryLog()?.diaryDays.find(t=>t.date===i)?.dayTemplate?.weight}hasWaterOnDate(i){return!!this.diaryLog()?.diaryDays.find(t=>t.date===i)?.dayTemplate?.waterMl}getCurrentWeight(i){let t=this.diaryLog()?.diaryDays.find(a=>a.date===i);return t?t.dayTemplate.weight??null:null}updateCurrentWeight(i,t){this.diaryLog.update(a=>{let n=y({},a),s=n.diaryDays.find(e=>e.date===i);if(!s){let e=new g(i,new c);n.diaryDays.push(e),s=e}return t?s.dayTemplate.weight=Number(t):delete s.dayTemplate.weight,n}),this.saveDiaryLog()}getWeightByFormula(i,t){let a=(0,m.default)(i).utc(),n=[];for(let e=0;e<t;e++){let r=a.subtract(e,"day").toISOString(),o=this.getCurrentWeight(r);o&&n.push(o)}if(!n.length)return 0;if(n.sort(),n.length<=3)return n.reduce((e,r)=>e+r,0)/n.length;let s=Math.floor(n.length/2);return n.length%2===0?(n[s-1]+n[s])/2:(n[s-1]+n[s]+n[s+1])/3}getWeights(i,t){let a=m.default.min((0,m.default)(i).utc().startOf("day"),(0,m.default)().utc().startOf("day")),n=[],s=0;for(let e=0;e<t;e++){let r=a.subtract(e,"day").toISOString();s=this.getCurrentWeight(r),s&&n.push(s)}return n.reverse(),n}static \u0275fac=function(t){return new(t||l)};static \u0275prov=T({token:l,factory:l.\u0275fac,providedIn:"root"})};export{D as a,L as b,c,W as d};

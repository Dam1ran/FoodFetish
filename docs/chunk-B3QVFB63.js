import{c as C}from"./chunk-LAXI4DWS.js";import{d as I,g as v,h as u,p as x}from"./chunk-ZSUZL2E2.js";import{a as h}from"./chunk-7QS2YA2B.js";import{X as T,a as c,e as N,ra as S}from"./chunk-4ENOABGI.js";var D=(e=>(e[e.None=0]="None",e[e.MealOne=1]="MealOne",e[e.MealTwo=2]="MealTwo",e[e.MealThree=3]="MealThree",e[e.MealFour=4]="MealFour",e[e.Snacks=5]="Snacks",e))(D||{}),L={0:"None",1:"Meal I",2:"Meal II",3:"Meal III",4:"Meal IV",5:"Snacks"};var m=N(C());var w=class{diaryDays=[]};var y=class{entries=[];weight},f=class{constructor(n=0,r=new u,i=[]){this.position=n;this.meal=r;this.recipes=i}};var g=class{constructor(n,r=new y){this.date=n;this.dayTemplate=r}};var E=class l{diaryLog=S(void 0);constructor(){this.setDiaryLog(),this.loadDiaryLog()}setDiaryLog(){if(!localStorage.getItem("diaryLog")){let r=new w;localStorage.setItem("diaryLog",JSON.stringify(r))}}loadDiaryLog(){this.diaryLog.set(JSON.parse(localStorage.getItem("diaryLog")))}getRespectiveMeal(n,r){return this.diaryLog()?.diaryDays.find(i=>i.date===n)?.dayTemplate.entries.find(i=>i.position===r)?.meal}getRespectiveRecipes(n,r){return this.diaryLog()?.diaryDays.find(i=>i.date===n)?.dayTemplate.entries.find(i=>i.position===r)?.recipes}addFood(n,r,i){i=c({},i),r=Number(r),this.diaryLog.update(a=>{let o=c({},a),e=o.diaryDays.find(s=>s.date===n);if(!e){let s=new g(n,new y);o.diaryDays.push(s),e=s}let t=e.dayTemplate.entries.find(s=>s.position===r);return t?t.meal.foods.push(i):(t=new f(r,new u(h(),L[r],[i]),[]),e.dayTemplate.entries.push(t)),o}),this.saveDiaryLog()}saveDiaryLog(){localStorage.setItem("diaryLog",JSON.stringify(this.diaryLog(),(n,r)=>n==="position"&&typeof r=="string"?D[r]:r))}updateMealName(n,r,i){this.diaryLog.update(a=>{let o=c({},a),e=o.diaryDays.find(s=>s.date===n);if(!e)return a;let t=e.dayTemplate.entries.find(s=>s.position===r);return t?(t.meal.name=i,o):a}),this.saveDiaryLog()}removeFood(n,r,i){this.diaryLog.update(a=>{let o=c({},a),e=o.diaryDays.find(s=>s.date===n);if(!e)return a;let t=e.dayTemplate.entries.find(s=>s.position===r);return t?(t.meal.foods=t.meal.foods.filter((s,p)=>p!==i),o):a}),this.saveDiaryLog()}removeRecipeFromPosition(n,r,i){this.diaryLog.update(a=>{let o=c({},a),e=o.diaryDays.find(s=>s.date===n);if(!e)return a;let t=e.dayTemplate.entries.find(s=>s.position===r);return t?(t.recipes=t.recipes.filter((s,p)=>p!==i),o):a}),this.saveDiaryLog()}updateRecipeFoodWeight(n,r,i,a,o){this.diaryLog.update(e=>{let t=c({},e),s=t.diaryDays.find(M=>M.date===n);if(!s)return e;let p=s.dayTemplate.entries.find(M=>M.position===r);if(!p)return e;let d=p.recipes?.[i];if(!d)return e;let b=d.foods?.[a];return b?(b.weight=Number(o),t):e}),this.saveDiaryLog()}clearMeal(n,r){this.diaryLog.update(i=>{let a=c({},i),o=a.diaryDays.find(t=>t.date===n);return!o||!o.dayTemplate.entries.find(t=>t.position===r)?i:(o.dayTemplate.entries=o.dayTemplate.entries.filter(t=>t.position!==r),a)}),this.saveDiaryLog()}updateFoodWeight(n,r,i,a){this.diaryLog.update(o=>{let e=c({},o),t=e.diaryDays.find(p=>p.date===n);if(!t)return o;let s=t.dayTemplate.entries.find(p=>p.position===r);return s?(s.meal.foods[i].weight=Number(a),e):o}),this.saveDiaryLog()}getDayStats(n){let r=this.diaryLog()?.diaryDays.find(a=>a.date===n),i=new v;if(!r)return i;for(let a of r.dayTemplate.entries){let o=[...a.meal.foods,...a.recipes.flatMap(e=>e.foods)];i.proteins+=o.reduce((e,t)=>e+t.protein*t.weight*.01,0),i.carbs+=o.reduce((e,t)=>e+t.carbs*t.weight*.01,0),i.fats+=o.reduce((e,t)=>e+t.fats*t.weight*.01,0),i.fiber+=o.reduce((e,t)=>e+t.fiber*t.weight*.01,0),i.calories+=o.reduce((e,t)=>e+t.calories*t.weight*.01,0),i.weight+=o.reduce((e,t)=>e+t.weight,0)}return i}getPositionStats(n,r){let i=this.diaryLog()?.diaryDays.find(t=>t.date===n),a=new v;if(!i)return a;let o=i.dayTemplate.entries.find(t=>t.position===r);if(!o)return a;let e=[...o.meal.foods,...o.recipes.flatMap(t=>t.foods)];return{proteins:e.reduce((t,s)=>t+s.protein*s.weight*.01,0),carbs:e.reduce((t,s)=>t+s.carbs*s.weight*.01,0),fats:e.reduce((t,s)=>t+s.fats*s.weight*.01,0),fiber:e.reduce((t,s)=>t+s.fiber*s.weight*.01,0),calories:e.reduce((t,s)=>t+s.calories*s.weight*.01,0),weight:e.reduce((t,s)=>t+s.weight,0)}}updateMealNote(n,r,i){this.diaryLog.update(a=>{let o=c({},a),e=o.diaryDays.find(s=>s.date===n);if(!e)return a;let t=e.dayTemplate.entries.find(s=>s.meal.id===r);return t?(t.meal.note=i,o):a}),this.saveDiaryLog()}getExpandedMeal(){let n=localStorage.getItem("expandedMeal");return n?JSON.parse(n):null}toggleExpandedMeal(n,r){let i=this.getExpandedMeal();localStorage.setItem("expandedMeal",JSON.stringify({isoDate:i?.isoDate===n&&i?.mealPosition===r?"":n,mealPosition:i?.isoDate===n&&i?.mealPosition===r?0:r}))}expandMeal(n,r){localStorage.setItem("expandedMeal",JSON.stringify({isoDate:n,mealPosition:r}))}addRecipe(n,r,i,a){this.diaryLog.update(o=>{let e=c({},o),t=e.diaryDays.find(d=>d.date===n);if(!t){let d=new g(n,new y);e.diaryDays.push(d),t=d}let s=t.dayTemplate.entries.find(d=>d.position===r),p=new x(h(),a.name,a.foods.map(d=>new I(d.id,d.name,d.macroCategory,d.protein,d.carbs,d.fats,d.fiber,d.calories,d.weight*(i/a.portions),d.note)),i,a.note);return s?s.recipes.push(p):(s=new f(r,new u(h(),L[r],[]),[p]),t.dayTemplate.entries.push(s)),e}),this.saveDiaryLog()}hasFoodOnDate(n){let r=this.diaryLog()?.diaryDays.find(i=>i.date===n);if(!r)return!1;for(let i of r.dayTemplate.entries)if(i.meal.foods.length>0||i.recipes.length>0)return!0;return!1}hasWeightInOnDate(n){return!!this.diaryLog()?.diaryDays.find(r=>r.date===n)?.dayTemplate?.weight}getCurrentWeight(n){let r=this.diaryLog()?.diaryDays.find(i=>i.date===n);return r?r.dayTemplate.weight??null:null}updateCurrentWeight(n,r){this.diaryLog.update(i=>{let a=c({},i),o=a.diaryDays.find(e=>e.date===n);if(!o){let e=new g(n,new y);a.diaryDays.push(e),o=e}return r?o.dayTemplate.weight=Number(r):delete o.dayTemplate.weight,a}),this.saveDiaryLog()}getWeightByFormula(n,r){let i=(0,m.default)(n).utc(),a=[];for(let e=0;e<r;e++){let t=i.subtract(e,"day").toISOString(),s=this.getCurrentWeight(t);s&&a.push(s)}if(!a.length)return 0;if(a.sort(),a.length<=3)return a.reduce((e,t)=>e+t,0)/a.length;let o=Math.floor(a.length/2);return a.length%2===0?(a[o-1]+a[o])/2:(a[o-1]+a[o]+a[o+1])/3}getWeights(n,r){let i=m.default.min((0,m.default)(n).utc().startOf("day"),(0,m.default)().utc().startOf("day")),a=[],o=0;for(let e=0;e<r;e++){let t=i.subtract(e,"day").toISOString();o=this.getCurrentWeight(t),o&&a.push(o)}return a.reverse(),a}static \u0275fac=function(r){return new(r||l)};static \u0275prov=T({token:l,factory:l.\u0275fac,providedIn:"root"})};export{D as a,L as b,y as c,E as d};

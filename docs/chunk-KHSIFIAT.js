import{a as H,b}from"./chunk-P7OX43DN.js";import{a as U}from"./chunk-TTUD5ZDE.js";import{Pa as J,Ta as E,Ua as P,X as w,Za as A,a as c,aa as R,b as y,e as G,ra as v,rc as S,xa as k}from"./chunk-HXGKTDM5.js";var x=class d{foods=v([]);constructor(){this.loadFoods()}loadFoods(){let e=localStorage.getItem("foods");e?this.foods.set(JSON.parse(e)):this.foods.set([])}addEditFood(e){this.foods().find(r=>r.id===e.id)?this.foods.update(r=>r.map(i=>i.id===e.id?e:i)):this.foods.update(r=>[...r,y(c({},e),{id:e.id||b()})]),localStorage.setItem("foods",JSON.stringify(this.foods()))}deleteFood(e){this.foods.update(t=>t.filter(r=>r.id!==e.id)),localStorage.setItem("foods",JSON.stringify(this.foods()))}downloadFoods(){let e=JSON.stringify(this.foods()),t=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(t),i=document.createElement("a");i.href=r,i.download="foods.json",i.click(),URL.revokeObjectURL(r)}setFoods(e){localStorage.setItem("foods",JSON.stringify(e)),this.loadFoods()}getFoodById(e){return this.foods().find(t=>t.id===e)}getFoodByBarcode(e){return this.foods().find(t=>t.barcode===e)}static \u0275fac=function(t){return new(t||d)};static \u0275prov=w({token:d,factory:d.\u0275fac,providedIn:"root"})};var V=(s=>(s[s.None=0]="None",s[s.Carbs=1]="Carbs",s[s.Proteins=2]="Proteins",s[s.Fats=3]="Fats",s[s.Vegetable=4]="Vegetable",s[s.Complex=5]="Complex",s[s.Other=6]="Other",s))(V||{}),ne={0:{bgColor:"#302010"},1:{bgColor:"#706030"},2:{bgColor:"#305090"},3:{bgColor:"#805040"},4:{bgColor:"#208040"},5:{bgColor:"#654070"},6:{bgColor:"#333355"}};var N=class{constructor(e="",t="",r=0,i=0,n=0,a=0,s=0,o=0,l=100,p="",h=""){this.id=e;this.name=t;this.macroCategory=r;this.protein=i;this.carbs=n;this.fats=a;this.fiber=s;this.calories=o;this.weight=l;this.barcode=p;this.note=h}};function B(d){return d&&typeof d=="object"&&typeof d.id=="string"&&typeof d.name=="string"&&typeof d.macroCategory=="number"&&typeof d.protein=="number"&&typeof d.carbs=="number"&&typeof d.fats=="number"&&typeof d.fiber=="number"&&typeof d.calories=="number"&&typeof d.weight=="number"&&(!d.barcode||typeof d.barcode=="string")&&typeof d.note=="string"}var j=class d{vcr=R(P);renderer=R(J);elementRef=R(k);buttonIcon=S.required();minWidthPx=S(120);iconSize=S("32px");ngAfterViewInit(){this.renderer.setAttribute(this.elementRef.nativeElement,"type","button"),this.renderer.addClass(this.elementRef.nativeElement,"d-flex"),this.renderer.addClass(this.elementRef.nativeElement,"justify-content-between"),this.renderer.addClass(this.elementRef.nativeElement,"align-items-center"),this.renderer.addClass(this.elementRef.nativeElement,"align-content-center"),this.renderer.addClass(this.elementRef.nativeElement,"flex-shrink-0"),this.renderer.addClass(this.elementRef.nativeElement,"gap-2"),this.renderer.setStyle(this.elementRef.nativeElement,"white-space","nowrap"),this.renderer.setStyle(this.elementRef.nativeElement,"padding","0.125rem 0.5rem");let e=this.vcr.createComponent(U,{bindings:[E("icon",this.buttonIcon),E("size",this.iconSize)]});this.elementRef.nativeElement.childNodes?.[0]?.textContent?.trim()?(this.renderer.setStyle(this.elementRef.nativeElement,"min-width",`${this.minWidthPx()}px`),this.renderer.setStyle(this.elementRef.nativeElement,"padding","0.125rem 0.5rem")):this.renderer.setStyle(this.elementRef.nativeElement,"padding","0.125rem"),this.renderer.appendChild(this.elementRef.nativeElement,e.location.nativeElement)}static \u0275fac=function(t){return new(t||d)};static \u0275dir=A({type:d,selectors:[["","buttonIcon",""]],inputs:{buttonIcon:[1,"buttonIcon"],minWidthPx:[1,"minWidthPx"],iconSize:[1,"iconSize"]}})};var C=(o=>(o[o.None=0]="None",o[o.MealOne=1]="MealOne",o[o.MealTwo=2]="MealTwo",o[o.MealThree=3]="MealThree",o[o.MealFour=4]="MealFour",o[o.MealFive=5]="MealFive",o[o.MealSix=6]="MealSix",o[o.Snacks=7]="Snacks",o))(C||{}),W={0:"None",1:"Meal I",2:"Meal II",3:"Meal III",4:"Meal IV",5:"Meal V",6:"Meal VI",7:"Snacks"};var D=class{constructor(e=0,t=0,r=0,i=0,n=0,a=0){this.proteins=e;this.carbs=t;this.fats=r;this.fiber=i;this.calories=n;this.weight=a}};var f=class{constructor(e="",t="",r=[],i="",n,a=""){this.id=e;this.name=t;this.foods=r;this.note=i;this.time=n;this.imageId=a}};function K(d){return d?.foods?.length?d.foods.reduce((e,t)=>e+t.protein*t.weight*.01,0):0}function Q(d){return d?.foods?.length?d.foods.reduce((e,t)=>e+t.carbs*t.weight*.01,0):0}function X(d){return d?.foods?.length?d.foods.reduce((e,t)=>e+t.fats*t.weight*.01,0):0}function Y(d){return d?.foods?.length?d.foods.reduce((e,t)=>e+t.fiber*t.weight*.01,0):0}function Z(d){return d?.foods?.length?d.foods.reduce((e,t)=>e+t.calories*t.weight*.01,0):0}function _(d){return d?.foods?.length?d.foods.reduce((e,t)=>e+t.weight,0):0}function he(d){return new D(K(d),Q(d),X(d),Y(d),Z(d),_(d))}var M=class extends f{constructor(t="",r="",i=[],n=1,a="",s=""){super(t,r,i,a,void 0,s);this.portions=n}};function Re(d){return d&&typeof d=="object"&&typeof d.id=="string"&&typeof d.name=="string"&&typeof d.portions=="number"&&typeof d.note=="string"&&Array.isArray(d.foods)&&d.foods.every(e=>B(e))}var g=G(H());var F=class{diaryDays=[]};var u=class{entries=[];weight;note;waterMl;activities=[]},L=class{constructor(e=0,t=new f,r=[]){this.position=e;this.meal=t;this.recipes=r}};var m=class{constructor(e,t=new u){this.date=e;this.dayTemplate=t}};var T=class{constructor(e,t=0,r=15,i){this.time=e;this.type=t;this.durationMinutes=r;this.note=i}},z=(s=>(s[s.None=0]="None",s[s.Walk=1]="Walk",s[s.Aerobics=2]="Aerobics",s[s.Cardio=3]="Cardio",s[s.Sports=4]="Sports",s[s.Workout=5]="Workout",s[s.Other=6]="Other",s))(z||{}),Fe={0:{icon:"fluent:border-none-24-filled"},1:{icon:"fa-solid:walking"},2:{icon:"icon-park-solid:sport"},3:{icon:"tabler:run"},4:{icon:"icon-park-solid:sporting"},5:{icon:"streamline-plump:dumbell-solid"},6:{icon:"hugeicons:activity-01"}};var q=class d{diaryLog=v(void 0);constructor(){this.setDiaryLog(),this.loadDiaryLog()}setDiaryLog(){if(!localStorage.getItem("diaryLog")){let t=new F;localStorage.setItem("diaryLog",JSON.stringify(t))}}loadDiaryLog(){this.diaryLog.set(JSON.parse(localStorage.getItem("diaryLog")))}getRespectiveDayTemplate(e){return this.diaryLog()?.diaryDays.find(t=>t.date===e)?.dayTemplate}getRespectiveMeal(e,t){return this.getRespectiveDayTemplate(e)?.entries.find(r=>r.position===t)?.meal}updateMealTime(e,t){t=Number(t),this.diaryLog.update(r=>{let i=c({},r),n=i.diaryDays.find(o=>o.date===e);if(!n)return r;let a=n.dayTemplate.entries.find(o=>o.position===t);if(!a)return r;let s=(0,g.default)();return a.meal.time={hour:s.hour(),minute:s.minute(),second:0},i}),this.saveDiaryLog()}getRespectiveRecipes(e,t){return this.diaryLog()?.diaryDays.find(r=>r.date===e)?.dayTemplate.entries.find(r=>r.position===t)?.recipes}addFood(e,t,r){r=c({},r),t=Number(t),this.diaryLog.update(i=>{let n=c({},i),a=n.diaryDays.find(o=>o.date===e);if(!a){let o=new m(e,new u);n.diaryDays.push(o),a=o}let s=a.dayTemplate.entries.find(o=>o.position===t);return s?s.meal.foods.push(r):(s=new L(t,new f(b(),W[t],[r]),[]),a.dayTemplate.entries.push(s)),n}),this.saveDiaryLog()}saveDiaryLog(){localStorage.setItem("diaryLog",JSON.stringify(this.diaryLog(),(e,t)=>e==="position"&&typeof t=="string"?C[t]:t))}updateMealName(e,t,r){this.diaryLog.update(i=>{let n=c({},i),a=n.diaryDays.find(o=>o.date===e);if(!a)return i;let s=a.dayTemplate.entries.find(o=>o.position===t);return s?(s.meal.name=r,n):i}),this.saveDiaryLog()}removeFood(e,t,r){this.diaryLog.update(i=>{let n=c({},i),a=n.diaryDays.find(o=>o.date===e);if(!a)return i;let s=a.dayTemplate.entries.find(o=>o.position===t);return s?(s.meal.foods=s.meal.foods.filter((o,l)=>l!==r),n):i}),this.saveDiaryLog()}removeRecipeFromPosition(e,t,r){this.diaryLog.update(i=>{let n=c({},i),a=n.diaryDays.find(o=>o.date===e);if(!a)return i;let s=a.dayTemplate.entries.find(o=>o.position===t);return s?(s.recipes=s.recipes.filter((o,l)=>l!==r),n):i}),this.saveDiaryLog()}updateRecipeFoodWeight(e,t,r,i,n){this.diaryLog.update(a=>{let s=c({},a),o=s.diaryDays.find(I=>I.date===e);if(!o)return a;let l=o.dayTemplate.entries.find(I=>I.position===t);if(!l)return a;let p=l.recipes?.[r];if(!p)return a;let h=p.foods?.[i];return h?(h.weight=Number(n),s):a}),this.saveDiaryLog()}removeFoodFromRecipe(e,t,r,i){this.diaryLog.update(n=>{let a=c({},n),s=a.diaryDays.find(h=>h.date===e);if(!s)return n;let o=s.dayTemplate.entries.find(h=>h.position===t);if(!o)return n;let l=o.recipes?.[r];return!l||!l.foods?.[i]?n:(l.foods=l.foods.filter((h,I)=>I!==i),a)}),this.saveDiaryLog()}clearMeal(e,t){this.diaryLog.update(r=>{let i=c({},r),n=i.diaryDays.find(s=>s.date===e);return!n||!n.dayTemplate.entries.find(s=>s.position===t)?r:(n.dayTemplate.entries=n.dayTemplate.entries.filter(s=>s.position!==t),i)}),this.saveDiaryLog()}updateFoodWeight(e,t,r,i){this.diaryLog.update(n=>{let a=c({},n),s=a.diaryDays.find(l=>l.date===e);if(!s)return n;let o=s.dayTemplate.entries.find(l=>l.position===t);return o?(o.meal.foods[r].weight=Number(i),a):n}),this.saveDiaryLog()}getDayStats(e){let t=this.diaryLog()?.diaryDays.find(i=>i.date===e),r=new D;if(!t)return r;for(let i of t.dayTemplate.entries){let n=[...i.meal.foods,...i.recipes.flatMap(a=>a.foods)];r.proteins+=n.reduce((a,s)=>a+s.protein*s.weight*.01,0),r.carbs+=n.reduce((a,s)=>a+s.carbs*s.weight*.01,0),r.fats+=n.reduce((a,s)=>a+s.fats*s.weight*.01,0),r.fiber+=n.reduce((a,s)=>a+s.fiber*s.weight*.01,0),r.calories+=n.reduce((a,s)=>a+s.calories*s.weight*.01,0),r.weight+=n.reduce((a,s)=>a+s.weight,0)}return r}getDayNote(e){return this.diaryLog()?.diaryDays?.find(t=>t.date===e)?.dayTemplate?.note??null}updateDayNote(e,t){this.diaryLog.update(r=>{let i=c({},r),n=i.diaryDays.find(a=>a.date===e);if(!n){let a=new m(e,new u);i.diaryDays.push(a),n=a}return n.dayTemplate.note=t,i}),this.saveDiaryLog()}getDayWater(e){return this.diaryLog()?.diaryDays?.find(t=>t.date===e)?.dayTemplate?.waterMl??null}updateDayWater(e,t){this.diaryLog.update(r=>{let i=c({},r),n=i.diaryDays.find(a=>a.date===e);if(!n){let a=new m(e,new u);i.diaryDays.push(a),n=a}return t?n.dayTemplate.waterMl=Number(t):delete n.dayTemplate.waterMl,i}),this.saveDiaryLog()}addDayWater(e,t){this.updateDayWater(e,(this.getDayWater(e)+t).toString())}subtractDayWater(e,t){let r=this.getDayWater(e);r<=t?this.updateDayWater(e,""):this.updateDayWater(e,(r-t).toString())}getPositionStats(e,t){let r=this.diaryLog()?.diaryDays.find(s=>s.date===e),i=new D;if(!r)return i;let n=r.dayTemplate.entries.find(s=>s.position===t);if(!n)return i;let a=[...n.meal.foods,...n.recipes.flatMap(s=>s.foods)];return{proteins:a.reduce((s,o)=>s+o.protein*o.weight*.01,0),carbs:a.reduce((s,o)=>s+o.carbs*o.weight*.01,0),fats:a.reduce((s,o)=>s+o.fats*o.weight*.01,0),fiber:a.reduce((s,o)=>s+o.fiber*o.weight*.01,0),calories:a.reduce((s,o)=>s+o.calories*o.weight*.01,0),weight:a.reduce((s,o)=>s+o.weight,0)}}updateMealNote(e,t,r){this.diaryLog.update(i=>{let n=c({},i),a=n.diaryDays.find(o=>o.date===e);if(!a)return i;let s=a.dayTemplate.entries.find(o=>o.meal.id===t);return s?(s.meal.note=r,n):i}),this.saveDiaryLog()}getExpandedMeal(){let e=localStorage.getItem("expandedMeal");return e?JSON.parse(e):null}toggleExpandedMeal(e,t){let r=this.getExpandedMeal();localStorage.setItem("expandedMeal",JSON.stringify({isoDate:r?.isoDate===e&&r?.mealPosition===t?"":e,mealPosition:r?.isoDate===e&&r?.mealPosition===t?0:t}))}expandMeal(e,t){localStorage.setItem("expandedMeal",JSON.stringify({isoDate:e,mealPosition:t}))}addRecipe(e,t,r,i){this.diaryLog.update(n=>{let a=c({},n),s=a.diaryDays.find(p=>p.date===e);if(!s){let p=new m(e,new u);a.diaryDays.push(p),s=p}let o=s.dayTemplate.entries.find(p=>p.position===t),l=new M(b(),i.name,i.foods.map(p=>new N(p.id,p.name,p.macroCategory,p.protein,p.carbs,p.fats,p.fiber,p.calories,p.weight*(r/i.portions),p.note)),r,i.note);return o?(o.recipes.push(l),o.meal.imageId=i.imageId):(o=new L(t,new f(b(),W[t],[],void 0,void 0,i.imageId),[l]),s.dayTemplate.entries.push(o)),a}),this.saveDiaryLog()}hasFoodOnDate(e){let t=this.diaryLog()?.diaryDays.find(r=>r.date===e);if(!t)return!1;for(let r of t.dayTemplate.entries)if(r.meal.foods.length>0||r.recipes.length>0)return!0;return!1}hasWeightInOnDate(e){return!!this.diaryLog()?.diaryDays.find(t=>t.date===e)?.dayTemplate?.weight}hasWaterOnDate(e){return!!this.diaryLog()?.diaryDays.find(t=>t.date===e)?.dayTemplate?.waterMl}hasActivitiesOnDate(e){return!!this.diaryLog()?.diaryDays.find(t=>t.date===e)?.dayTemplate?.activities?.some(t=>!!t.durationMinutes&&t.type!==0)}getCurrentWeight(e){let t=this.diaryLog()?.diaryDays.find(r=>r.date===e);return t?t.dayTemplate.weight??null:null}updateCurrentWeight(e,t){this.diaryLog.update(r=>{let i=c({},r),n=i.diaryDays.find(a=>a.date===e);if(!n){let a=new m(e,new u);i.diaryDays.push(a),n=a}return t?n.dayTemplate.weight=Number(t):delete n.dayTemplate.weight,i}),this.saveDiaryLog()}getWeightByFormula(e,t){let r=(0,g.default)(e).utc().startOf("day"),i=[];for(let a=0;a<t;a++){let s=r.subtract(a,"day").toISOString(),o=this.getCurrentWeight(s);o&&i.push(o)}if(!i.length)return 0;if(i.sort(),i.length<=3)return i.reduce((a,s)=>a+s,0)/i.length;let n=Math.floor(i.length/2);return i.length%2===0?(i[n-1]+i[n])/2:(i[n-1]+i[n]+i[n+1])/3}getWeights(e,t){let r=g.default.min((0,g.default)(e).utc().startOf("day"),(0,g.default)().utc().startOf("day")),i=[],n=0;for(let a=0;a<t;a++){let s=r.subtract(a,"day").toISOString();n=this.getCurrentWeight(s),n&&i.push(n)}return i.reverse(),i}getCalorie(e){return this.getDayStats(e).calories}getCalories(e,t){let r=g.default.min((0,g.default)(e).utc().startOf("day"),(0,g.default)().utc().startOf("day")),i=[],n=0;for(let a=0;a<t;a++){let s=r.subtract(a,"day").toISOString();n=this.getCalorie(s),n&&i.push(n)}return i.reverse(),i}getActivities(e){return this.diaryLog()?.diaryDays.find(t=>t.date===e)?.dayTemplate.activities??[]}addActivity(e){this.diaryLog.update(t=>{let r=c({},t),i=r.diaryDays.find(o=>o.date===e);if(!i){let o=new m(e,new u);r.diaryDays.push(o),i=o}let n=i.dayTemplate.activities,a=(0,g.default)(),s=new T({hour:a.hour(),minute:a.minute(),second:0});return n?.length?n.push(s):i.dayTemplate.activities=[s],r}),this.saveDiaryLog()}removeActivity(e,t){this.diaryLog.update(r=>{let i=c({},r),n=i.diaryDays.find(a=>a.date===e);return n?(n.dayTemplate.activities=n.dayTemplate.activities.filter((a,s)=>s!==t),i):r}),this.saveDiaryLog()}setActivityType(e,t,r){this.diaryLog.update(i=>{let n=c({},i),a=n.diaryDays.find(s=>s.date===e);return a?(a.dayTemplate.activities[t].type=r,n):i}),this.saveDiaryLog()}downloadDiary(){let e=JSON.stringify(this.diaryLog()),t=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(t),i=document.createElement("a");i.href=r,i.download="diary.json",i.click(),URL.revokeObjectURL(r)}setDiary(e){localStorage.setItem("diaryLog",JSON.stringify(e)),this.loadDiaryLog()}deleteMealImage(e){this.diaryLog.update(t=>{let r=c({},t);for(let i of r.diaryDays)for(let n of i.dayTemplate.entries)n.meal.imageId===e&&delete n.meal.imageId;return r}),this.saveDiaryLog()}static \u0275fac=function(t){return new(t||d)};static \u0275prov=w({token:d,factory:d.\u0275fac,providedIn:"root"})};var $=class d{foodsService=R(x);recipes=v([]);expandedRecipeId=v("");constructor(){this.loadRecipes(),this.loadExpandedRecipeId()}loadRecipes(){let e=localStorage.getItem("recipes");e?this.recipes.set(JSON.parse(e)):this.recipes.set([])}loadExpandedRecipeId(){let e=localStorage.getItem("expandedRecipeId");e?this.expandedRecipeId.set(JSON.parse(e)):this.expandedRecipeId.set("")}saveRecipes(){localStorage.setItem("recipes",JSON.stringify(this.recipes()))}setRecipes(e){localStorage.setItem("recipes",JSON.stringify(e)),this.loadRecipes()}downloadRecipes(){let e=JSON.stringify(this.recipes()),t=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(t),i=document.createElement("a");i.href=r,i.download="recipes.json",i.click(),URL.revokeObjectURL(r)}addRecipe(){return this.recipes.update(e=>[new M(b(),"Empty recipe"),...e]),this.saveRecipes(),this.recipes()[0].id}updateRecipeName(e,t){this.recipes.update(r=>r.map(i=>i.id===e?y(c({},i),{name:t}):i)),this.saveRecipes()}updateRecipeNote(e,t){this.recipes.update(r=>r.map(i=>i.id===e?y(c({},i),{note:t}):i)),this.saveRecipes()}addFood(e,t){this.recipes.update(r=>r.map(i=>{if(i.id===e){let n=this.foodsService.getFoodById(t);if(n)return y(c({},i),{foods:[...i.foods,c({},n)]})}return i})),this.saveRecipes()}updateFoodWeight(e,t,r){this.recipes.update(i=>i.map(n=>n.id===e?y(c({},n),{foods:n.foods.map((a,s)=>s===t?y(c({},a),{weight:+r}):a)}):n)),this.saveRecipes()}updateRecipePortions(e,t){this.recipes.update(r=>r.map(i=>i.id===e?y(c({},i),{portions:+t}):i)),this.saveRecipes()}removeFood(e,t){this.recipes.update(r=>r.map(i=>i.id===e?y(c({},i),{foods:i.foods.filter((n,a)=>a!==t)}):i)),this.recipes().find(r=>r.id===e&&r.foods.length===0)&&this.recipes.update(r=>r.filter(i=>i.id!==e)),this.saveRecipes()}changeFoodOrder(e,t,r){this.recipes.update(i=>i.map(n=>n.id===e?y(c({},n),{foods:n.foods.map((a,s)=>s===t?n.foods[r]:s===r?n.foods[t]:n.foods[s])}):n)),this.saveRecipes()}getRecipeById(e){return this.recipes().find(t=>t.id===e)}setExpandedRecipeId(e){this.expandedRecipeId.set(e),localStorage.setItem("expandedRecipeId",JSON.stringify(this.expandedRecipeId()))}toggleExpandedRecipeId(e){e===this.expandedRecipeId()?this.expandedRecipeId.set(""):this.expandedRecipeId.set(e),localStorage.setItem("expandedRecipeId",JSON.stringify(this.expandedRecipeId()))}setImage(e,t){this.recipes.update(r=>r.map(i=>i.id===e?y(c({},i),{imageId:t}):i)),this.saveRecipes()}deleteImage(e){this.recipes.update(t=>t.map(r=>r.imageId===e?y(c({},r),{imageId:""}):r)),this.saveRecipes()}anyImage(e){return this.recipes().some(t=>t.imageId===e)}static \u0275fac=function(t){return new(t||d)};static \u0275prov=w({token:d,factory:d.\u0275fac,providedIn:"root"})};export{x as a,V as b,ne as c,N as d,B as e,j as f,C as g,W as h,f as i,K as j,Q as k,X as l,Y as m,Z as n,_ as o,he as p,u as q,Re as r,z as s,Fe as t,q as u,$ as v};

import{c as F}from"./chunk-MIYS5TCE.js";import{e as C,h as L,i as h,q as W}from"./chunk-ETA2NHU5.js";import{a as v}from"./chunk-7QS2YA2B.js";import{X as S,a as y,e as I,ra as N}from"./chunk-DAZPDLGM.js";var w=(e=>(e[e.None=0]="None",e[e.MealOne=1]="MealOne",e[e.MealTwo=2]="MealTwo",e[e.MealThree=3]="MealThree",e[e.MealFour=4]="MealFour",e[e.Snacks=5]="Snacks",e))(w||{}),T={0:"None",1:"Meal I",2:"Meal II",3:"Meal III",4:"Meal IV",5:"Snacks"};var f=I(F());var M=class{diaryDays=[]};var p=class{entries=[];weight;note;waterMl;activities=[]},D=class{constructor(r=0,i=new h,a=[]){this.position=r;this.meal=i;this.recipes=a}};var u=class{constructor(r,i=new p){this.date=r;this.dayTemplate=i}};var b=class{constructor(r,i=0,a=15,n){this.time=r;this.type=i;this.durationMinutes=a;this.note=n}},x=(t=>(t[t.None=0]="None",t[t.Walk=1]="Walk",t[t.Aerobics=2]="Aerobics",t[t.Cardio=3]="Cardio",t[t.Sports=4]="Sports",t[t.Workout=5]="Workout",t[t.Other=6]="Other",t))(x||{}),_={0:{icon:"fluent:border-none-24-filled"},1:{icon:"fa-solid:walking"},2:{icon:"icon-park-solid:sport"},3:{icon:"tabler:run"},4:{icon:"icon-park-solid:sporting"},5:{icon:"streamline-plump:dumbell-solid"},6:{icon:"hugeicons:activity-01"}};var E=class l{diaryLog=N(void 0);constructor(){this.setDiaryLog(),this.loadDiaryLog()}setDiaryLog(){if(!localStorage.getItem("diaryLog")){let i=new M;localStorage.setItem("diaryLog",JSON.stringify(i))}}loadDiaryLog(){this.diaryLog.set(JSON.parse(localStorage.getItem("diaryLog")))}getRespectiveMeal(r,i){return this.diaryLog()?.diaryDays.find(a=>a.date===r)?.dayTemplate.entries.find(a=>a.position===i)?.meal}updateMealTime(r,i){i=Number(i),this.diaryLog.update(a=>{let n=y({},a),s=n.diaryDays.find(o=>o.date===r);if(!s)return a;let e=s.dayTemplate.entries.find(o=>o.position===i);if(!e)return a;let t=(0,f.default)();return e.meal.time={hour:t.hour(),minute:t.minute(),second:0},n}),this.saveDiaryLog()}getRespectiveRecipes(r,i){return this.diaryLog()?.diaryDays.find(a=>a.date===r)?.dayTemplate.entries.find(a=>a.position===i)?.recipes}addFood(r,i,a){a=y({},a),i=Number(i),this.diaryLog.update(n=>{let s=y({},n),e=s.diaryDays.find(o=>o.date===r);if(!e){let o=new u(r,new p);s.diaryDays.push(o),e=o}let t=e.dayTemplate.entries.find(o=>o.position===i);return t?t.meal.foods.push(a):(t=new D(i,new h(v(),T[i],[a]),[]),e.dayTemplate.entries.push(t)),s}),this.saveDiaryLog()}saveDiaryLog(){localStorage.setItem("diaryLog",JSON.stringify(this.diaryLog(),(r,i)=>r==="position"&&typeof i=="string"?w[i]:i))}updateMealName(r,i,a){this.diaryLog.update(n=>{let s=y({},n),e=s.diaryDays.find(o=>o.date===r);if(!e)return n;let t=e.dayTemplate.entries.find(o=>o.position===i);return t?(t.meal.name=a,s):n}),this.saveDiaryLog()}removeFood(r,i,a){this.diaryLog.update(n=>{let s=y({},n),e=s.diaryDays.find(o=>o.date===r);if(!e)return n;let t=e.dayTemplate.entries.find(o=>o.position===i);return t?(t.meal.foods=t.meal.foods.filter((o,c)=>c!==a),s):n}),this.saveDiaryLog()}removeRecipeFromPosition(r,i,a){this.diaryLog.update(n=>{let s=y({},n),e=s.diaryDays.find(o=>o.date===r);if(!e)return n;let t=e.dayTemplate.entries.find(o=>o.position===i);return t?(t.recipes=t.recipes.filter((o,c)=>c!==a),s):n}),this.saveDiaryLog()}updateRecipeFoodWeight(r,i,a,n,s){this.diaryLog.update(e=>{let t=y({},e),o=t.diaryDays.find(m=>m.date===r);if(!o)return e;let c=o.dayTemplate.entries.find(m=>m.position===i);if(!c)return e;let d=c.recipes?.[a];if(!d)return e;let g=d.foods?.[n];return g?(g.weight=Number(s),t):e}),this.saveDiaryLog()}removeFoodFromRecipe(r,i,a,n){this.diaryLog.update(s=>{let e=y({},s),t=e.diaryDays.find(g=>g.date===r);if(!t)return s;let o=t.dayTemplate.entries.find(g=>g.position===i);if(!o)return s;let c=o.recipes?.[a];return!c||!c.foods?.[n]?s:(c.foods=c.foods.filter((g,m)=>m!==n),e)}),this.saveDiaryLog()}clearMeal(r,i){this.diaryLog.update(a=>{let n=y({},a),s=n.diaryDays.find(t=>t.date===r);return!s||!s.dayTemplate.entries.find(t=>t.position===i)?a:(s.dayTemplate.entries=s.dayTemplate.entries.filter(t=>t.position!==i),n)}),this.saveDiaryLog()}updateFoodWeight(r,i,a,n){this.diaryLog.update(s=>{let e=y({},s),t=e.diaryDays.find(c=>c.date===r);if(!t)return s;let o=t.dayTemplate.entries.find(c=>c.position===i);return o?(o.meal.foods[a].weight=Number(n),e):s}),this.saveDiaryLog()}getDayStats(r){let i=this.diaryLog()?.diaryDays.find(n=>n.date===r),a=new L;if(!i)return a;for(let n of i.dayTemplate.entries){let s=[...n.meal.foods,...n.recipes.flatMap(e=>e.foods)];a.proteins+=s.reduce((e,t)=>e+t.protein*t.weight*.01,0),a.carbs+=s.reduce((e,t)=>e+t.carbs*t.weight*.01,0),a.fats+=s.reduce((e,t)=>e+t.fats*t.weight*.01,0),a.fiber+=s.reduce((e,t)=>e+t.fiber*t.weight*.01,0),a.calories+=s.reduce((e,t)=>e+t.calories*t.weight*.01,0),a.weight+=s.reduce((e,t)=>e+t.weight,0)}return a}getDayNote(r){return this.diaryLog()?.diaryDays?.find(i=>i.date===r)?.dayTemplate?.note??null}updateDayNote(r,i){this.diaryLog.update(a=>{let n=y({},a),s=n.diaryDays.find(e=>e.date===r);if(!s){let e=new u(r,new p);n.diaryDays.push(e),s=e}return s.dayTemplate.note=i,n}),this.saveDiaryLog()}getDayWater(r){return this.diaryLog()?.diaryDays?.find(i=>i.date===r)?.dayTemplate?.waterMl??null}updateDayWater(r,i){this.diaryLog.update(a=>{let n=y({},a),s=n.diaryDays.find(e=>e.date===r);if(!s){let e=new u(r,new p);n.diaryDays.push(e),s=e}return i?s.dayTemplate.waterMl=Number(i):delete s.dayTemplate.waterMl,n}),this.saveDiaryLog()}addDayWater(r,i){this.updateDayWater(r,(this.getDayWater(r)+i).toString())}subtractDayWater(r,i){let a=this.getDayWater(r);a<=i?this.updateDayWater(r,""):this.updateDayWater(r,(a-i).toString())}getPositionStats(r,i){let a=this.diaryLog()?.diaryDays.find(t=>t.date===r),n=new L;if(!a)return n;let s=a.dayTemplate.entries.find(t=>t.position===i);if(!s)return n;let e=[...s.meal.foods,...s.recipes.flatMap(t=>t.foods)];return{proteins:e.reduce((t,o)=>t+o.protein*o.weight*.01,0),carbs:e.reduce((t,o)=>t+o.carbs*o.weight*.01,0),fats:e.reduce((t,o)=>t+o.fats*o.weight*.01,0),fiber:e.reduce((t,o)=>t+o.fiber*o.weight*.01,0),calories:e.reduce((t,o)=>t+o.calories*o.weight*.01,0),weight:e.reduce((t,o)=>t+o.weight,0)}}updateMealNote(r,i,a){this.diaryLog.update(n=>{let s=y({},n),e=s.diaryDays.find(o=>o.date===r);if(!e)return n;let t=e.dayTemplate.entries.find(o=>o.meal.id===i);return t?(t.meal.note=a,s):n}),this.saveDiaryLog()}getExpandedMeal(){let r=localStorage.getItem("expandedMeal");return r?JSON.parse(r):null}toggleExpandedMeal(r,i){let a=this.getExpandedMeal();localStorage.setItem("expandedMeal",JSON.stringify({isoDate:a?.isoDate===r&&a?.mealPosition===i?"":r,mealPosition:a?.isoDate===r&&a?.mealPosition===i?0:i}))}expandMeal(r,i){localStorage.setItem("expandedMeal",JSON.stringify({isoDate:r,mealPosition:i}))}addRecipe(r,i,a,n){this.diaryLog.update(s=>{let e=y({},s),t=e.diaryDays.find(d=>d.date===r);if(!t){let d=new u(r,new p);e.diaryDays.push(d),t=d}let o=t.dayTemplate.entries.find(d=>d.position===i),c=new W(v(),n.name,n.foods.map(d=>new C(d.id,d.name,d.macroCategory,d.protein,d.carbs,d.fats,d.fiber,d.calories,d.weight*(a/n.portions),d.note)),a,n.note);return o?o.recipes.push(c):(o=new D(i,new h(v(),T[i],[]),[c]),t.dayTemplate.entries.push(o)),e}),this.saveDiaryLog()}hasFoodOnDate(r){let i=this.diaryLog()?.diaryDays.find(a=>a.date===r);if(!i)return!1;for(let a of i.dayTemplate.entries)if(a.meal.foods.length>0||a.recipes.length>0)return!0;return!1}hasWeightInOnDate(r){return!!this.diaryLog()?.diaryDays.find(i=>i.date===r)?.dayTemplate?.weight}hasWaterOnDate(r){return!!this.diaryLog()?.diaryDays.find(i=>i.date===r)?.dayTemplate?.waterMl}hasActivitiesOnDate(r){return!!this.diaryLog()?.diaryDays.find(i=>i.date===r)?.dayTemplate?.activities?.some(i=>!!i.durationMinutes&&i.type!==0)}getCurrentWeight(r){let i=this.diaryLog()?.diaryDays.find(a=>a.date===r);return i?i.dayTemplate.weight??null:null}updateCurrentWeight(r,i){this.diaryLog.update(a=>{let n=y({},a),s=n.diaryDays.find(e=>e.date===r);if(!s){let e=new u(r,new p);n.diaryDays.push(e),s=e}return i?s.dayTemplate.weight=Number(i):delete s.dayTemplate.weight,n}),this.saveDiaryLog()}getWeightByFormula(r,i){let a=(0,f.default)(r).utc().startOf("day"),n=[];for(let e=0;e<i;e++){let t=a.subtract(e,"day").toISOString(),o=this.getCurrentWeight(t);o&&n.push(o)}if(!n.length)return 0;if(n.sort(),n.length<=3)return n.reduce((e,t)=>e+t,0)/n.length;let s=Math.floor(n.length/2);return n.length%2===0?(n[s-1]+n[s])/2:(n[s-1]+n[s]+n[s+1])/3}getWeights(r,i){let a=f.default.min((0,f.default)(r).utc().startOf("day"),(0,f.default)().utc().startOf("day")),n=[],s=0;for(let e=0;e<i;e++){let t=a.subtract(e,"day").toISOString();s=this.getCurrentWeight(t),s&&n.push(s)}return n.reverse(),n}getActivities(r){return this.diaryLog()?.diaryDays.find(i=>i.date===r)?.dayTemplate.activities??[]}addActivity(r){this.diaryLog.update(i=>{let a=y({},i),n=a.diaryDays.find(o=>o.date===r);if(!n){let o=new u(r,new p);a.diaryDays.push(o),n=o}let s=n.dayTemplate.activities,e=(0,f.default)(),t=new b({hour:e.hour(),minute:e.minute(),second:0});return s?.length?s.push(t):n.dayTemplate.activities=[t],a}),this.saveDiaryLog()}removeActivity(r,i){this.diaryLog.update(a=>{let n=y({},a),s=n.diaryDays.find(e=>e.date===r);return s?(s.dayTemplate.activities=s.dayTemplate.activities.filter((e,t)=>t!==i),n):a}),this.saveDiaryLog()}setActivityType(r,i,a){this.diaryLog.update(n=>{let s=y({},n),e=s.diaryDays.find(t=>t.date===r);return e?(e.dayTemplate.activities[i].type=a,s):n}),this.saveDiaryLog()}static \u0275fac=function(i){return new(i||l)};static \u0275prov=S({token:l,factory:l.\u0275fac,providedIn:"root"})};export{w as a,T as b,p as c,x as d,_ as e,E as f};

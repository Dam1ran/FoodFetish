import{c as C}from"./chunk-U6B7DI2V.js";import{d as I,g as v,h as u,p as x}from"./chunk-CNEF6CAU.js";import{a as h}from"./chunk-7QS2YA2B.js";import{X as T,a as p,e as N,sa as S}from"./chunk-EJNIJWGF.js";var D=(e=>(e[e.None=0]="None",e[e.MealOne=1]="MealOne",e[e.MealTwo=2]="MealTwo",e[e.MealThree=3]="MealThree",e[e.MealFour=4]="MealFour",e[e.Snacks=5]="Snacks",e))(D||{}),b={0:"None",1:"Meal I",2:"Meal II",3:"Meal III",4:"Meal IV",5:"Snacks"};var m=N(C());var w=class{diaryDays=[]};var y=class{entries=[];weight},f=class{constructor(s=0,r=new u,i=[]){this.position=s;this.meal=r;this.recipes=i}};var g=class{constructor(s,r=new y){this.date=s;this.dayTemplate=r}};var E=class l{diaryLog=S(void 0);constructor(){this.setDiaryLog(),this.loadDiaryLog()}setDiaryLog(){if(!localStorage.getItem("diaryLog")){let r=new w;localStorage.setItem("diaryLog",JSON.stringify(r))}}loadDiaryLog(){this.diaryLog.set(JSON.parse(localStorage.getItem("diaryLog")))}getRespectiveMeal(s,r){return this.diaryLog()?.diaryDays.find(i=>i.date===s)?.dayTemplate.entries.find(i=>i.position===r)?.meal}getRespectiveRecipes(s,r){return this.diaryLog()?.diaryDays.find(i=>i.date===s)?.dayTemplate.entries.find(i=>i.position===r)?.recipes}addFood(s,r,i){i=p({},i),r=Number(r),this.diaryLog.update(a=>{let o=p({},a),e=o.diaryDays.find(n=>n.date===s);if(!e){let n=new g(s,new y);o.diaryDays.push(n),e=n}let t=e.dayTemplate.entries.find(n=>n.position===r);return t?t.meal.foods.push(i):(t=new f(r,new u(h(),b[r],[i]),[]),e.dayTemplate.entries.push(t)),o}),this.saveDiaryLog()}saveDiaryLog(){localStorage.setItem("diaryLog",JSON.stringify(this.diaryLog(),(s,r)=>s==="position"&&typeof r=="string"?D[r]:r))}updateMealName(s,r,i){this.diaryLog.update(a=>{let o=p({},a),e=o.diaryDays.find(n=>n.date===s);if(!e)return a;let t=e.dayTemplate.entries.find(n=>n.position===r);return t?(t.meal.name=i,o):a}),this.saveDiaryLog()}removeFood(s,r,i){this.diaryLog.update(a=>{let o=p({},a),e=o.diaryDays.find(n=>n.date===s);if(!e)return a;let t=e.dayTemplate.entries.find(n=>n.position===r);return t?(t.meal.foods=t.meal.foods.filter((n,c)=>c!==i),o):a}),this.saveDiaryLog()}removeRecipeFromPosition(s,r,i){this.diaryLog.update(a=>{let o=p({},a),e=o.diaryDays.find(n=>n.date===s);if(!e)return a;let t=e.dayTemplate.entries.find(n=>n.position===r);return t?(t.recipes=t.recipes.filter((n,c)=>c!==i),o):a}),this.saveDiaryLog()}updateRecipeFoodWeight(s,r,i,a,o){this.diaryLog.update(e=>{let t=p({},e),n=t.diaryDays.find(M=>M.date===s);if(!n)return e;let c=n.dayTemplate.entries.find(M=>M.position===r);if(!c)return e;let d=c.recipes?.[i];if(!d)return e;let L=d.foods?.[a];return L?(L.weight=Number(o),t):e}),this.saveDiaryLog()}clearMeal(s,r){this.diaryLog.update(i=>{let a=p({},i),o=a.diaryDays.find(t=>t.date===s);return!o||!o.dayTemplate.entries.find(t=>t.position===r)?i:(o.dayTemplate.entries=o.dayTemplate.entries.filter(t=>t.position!==r),a)}),this.saveDiaryLog()}updateFoodWeight(s,r,i,a){this.diaryLog.update(o=>{let e=p({},o),t=e.diaryDays.find(c=>c.date===s);if(!t)return o;let n=t.dayTemplate.entries.find(c=>c.position===r);return n?(n.meal.foods[i].weight=Number(a),e):o}),this.saveDiaryLog()}getDayStats(s){let r=this.diaryLog()?.diaryDays.find(a=>a.date===s),i=new v;if(!r)return i;for(let a of r.dayTemplate.entries){let o=[...a.meal.foods,...a.recipes.flatMap(e=>e.foods)];i.proteins+=o.reduce((e,t)=>e+t.protein*t.weight*.01,0),i.carbs+=o.reduce((e,t)=>e+t.carbs*t.weight*.01,0),i.fats+=o.reduce((e,t)=>e+t.fats*t.weight*.01,0),i.fiber+=o.reduce((e,t)=>e+t.fiber*t.weight*.01,0),i.calories+=o.reduce((e,t)=>e+t.calories*t.weight*.01,0),i.weight+=o.reduce((e,t)=>e+t.weight,0)}return i}getPositionStats(s,r){let i=this.diaryLog()?.diaryDays.find(t=>t.date===s),a=new v;if(!i)return a;let o=i.dayTemplate.entries.find(t=>t.position===r);if(!o)return a;let e=[...o.meal.foods,...o.recipes.flatMap(t=>t.foods)];return{proteins:e.reduce((t,n)=>t+n.protein*n.weight*.01,0),carbs:e.reduce((t,n)=>t+n.carbs*n.weight*.01,0),fats:e.reduce((t,n)=>t+n.fats*n.weight*.01,0),fiber:e.reduce((t,n)=>t+n.fiber*n.weight*.01,0),calories:e.reduce((t,n)=>t+n.calories*n.weight*.01,0),weight:e.reduce((t,n)=>t+n.weight,0)}}updateMealNote(s,r,i){this.diaryLog.update(a=>{let o=p({},a),e=o.diaryDays.find(n=>n.date===s);if(!e)return a;let t=e.dayTemplate.entries.find(n=>n.meal.id===r);return t?(t.meal.note=i,o):a}),this.saveDiaryLog()}getExpandedMeal(){let s=localStorage.getItem("expandedMeal");return s?JSON.parse(s):null}toggleExpandedMeal(s,r){let i=this.getExpandedMeal();localStorage.setItem("expandedMeal",JSON.stringify({isoDate:i?.isoDate===s&&i?.mealPosition===r?"":s,mealPosition:i?.isoDate===s&&i?.mealPosition===r?0:r}))}expandMeal(s,r){localStorage.setItem("expandedMeal",JSON.stringify({isoDate:s,mealPosition:r}))}addRecipe(s,r,i,a){this.diaryLog.update(o=>{let e=p({},o),t=e.diaryDays.find(d=>d.date===s);if(!t){let d=new g(s,new y);e.diaryDays.push(d),t=d}let n=t.dayTemplate.entries.find(d=>d.position===r),c=new x(h(),a.name,a.foods.map(d=>new I(d.id,d.name,d.macroCategory,d.protein,d.carbs,d.fats,d.fiber,d.calories,d.weight*(i/a.portions),d.note)),i,a.note);return n?n.recipes.push(c):(n=new f(r,new u(h(),b[r],[]),[c]),t.dayTemplate.entries.push(n)),e}),this.saveDiaryLog()}hasFoodOnDate(s){let r=this.diaryLog()?.diaryDays.find(i=>i.date===s);if(!r)return!1;for(let i of r.dayTemplate.entries)if(i.meal.foods.length>0||i.recipes.length>0)return!0;return!1}getCurrentWeight(s){let r=this.diaryLog()?.diaryDays.find(i=>i.date===s);return r?r.dayTemplate.weight??null:null}updateCurrentWeight(s,r){this.diaryLog.update(i=>{let a=p({},i),o=a.diaryDays.find(e=>e.date===s);if(!o){let e=new g(s,new y);a.diaryDays.push(e),o=e}return o.dayTemplate.weight=Number(r),a}),this.saveDiaryLog()}getWeightByFormula(s,r){let i=(0,m.default)(s).utc(),a=[];for(let e=0;e<r;e++){let t=i.subtract(e,"day").toISOString(),n=this.getCurrentWeight(t);n&&a.push(n)}if(!a.length)return 0;if(a.sort(),a.length<=3)return a.reduce((e,t)=>e+t,0)/a.length;let o=Math.floor(a.length/2);return a.length%2===0?(a[o-1]+a[o])/2:(a[o-1]+a[o]+a[o+1])/3}getWeights(s,r){let i=m.default.min((0,m.default)(s).utc().startOf("day"),(0,m.default)().utc().startOf("day")),a=[],o=0;for(let e=0;e<r;e++){let t=i.subtract(e,"day").toISOString();o=this.getCurrentWeight(t),o&&a.push(o)}return a.reverse(),a}static \u0275fac=function(r){return new(r||l)};static \u0275prov=T({token:l,factory:l.\u0275fac,providedIn:"root"})};export{D as a,b,y as c,E as d};

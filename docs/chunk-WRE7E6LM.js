import{c as F}from"./chunk-DKM6TLGV.js";import{e as C,h as L,i as h,q as W}from"./chunk-V6FOYY4F.js";import{a as v}from"./chunk-7QS2YA2B.js";import{X as S,a as c,e as E,ra as N}from"./chunk-DAZPDLGM.js";var w=(e=>(e[e.None=0]="None",e[e.MealOne=1]="MealOne",e[e.MealTwo=2]="MealTwo",e[e.MealThree=3]="MealThree",e[e.MealFour=4]="MealFour",e[e.Snacks=5]="Snacks",e))(w||{}),T={0:"None",1:"Meal I",2:"Meal II",3:"Meal III",4:"Meal IV",5:"Snacks"};var f=E(F());var M=class{diaryDays=[]};var p=class{entries=[];weight;note;waterMl;activities=[]},D=class{constructor(r=0,i=new h,n=[]){this.position=r;this.meal=i;this.recipes=n}};var u=class{constructor(r,i=new p){this.date=r;this.dayTemplate=i}};var b=class{constructor(r,i=0,n=15,a){this.time=r;this.type=i;this.durationMinutes=n;this.note=a}},x=(t=>(t[t.None=0]="None",t[t.Walk=1]="Walk",t[t.Aerobics=2]="Aerobics",t[t.Cardio=3]="Cardio",t[t.Sports=4]="Sports",t[t.Workout=5]="Workout",t[t.Other=6]="Other",t))(x||{}),_={0:{icon:"fluent:border-none-24-filled"},1:{icon:"fa-solid:walking"},2:{icon:"icon-park-solid:sport"},3:{icon:"tabler:run"},4:{icon:"icon-park-solid:sporting"},5:{icon:"streamline-plump:dumbell-solid"},6:{icon:"hugeicons:activity-01"}};var I=class l{diaryLog=N(void 0);constructor(){this.setDiaryLog(),this.loadDiaryLog()}setDiaryLog(){if(!localStorage.getItem("diaryLog")){let i=new M;localStorage.setItem("diaryLog",JSON.stringify(i))}}loadDiaryLog(){this.diaryLog.set(JSON.parse(localStorage.getItem("diaryLog")))}getRespectiveMeal(r,i){return this.diaryLog()?.diaryDays.find(n=>n.date===r)?.dayTemplate.entries.find(n=>n.position===i)?.meal}getRespectiveRecipes(r,i){return this.diaryLog()?.diaryDays.find(n=>n.date===r)?.dayTemplate.entries.find(n=>n.position===i)?.recipes}addFood(r,i,n){n=c({},n),i=Number(i),this.diaryLog.update(a=>{let s=c({},a),e=s.diaryDays.find(o=>o.date===r);if(!e){let o=new u(r,new p);s.diaryDays.push(o),e=o}let t=e.dayTemplate.entries.find(o=>o.position===i);return t?t.meal.foods.push(n):(t=new D(i,new h(v(),T[i],[n]),[]),e.dayTemplate.entries.push(t)),s}),this.saveDiaryLog()}saveDiaryLog(){localStorage.setItem("diaryLog",JSON.stringify(this.diaryLog(),(r,i)=>r==="position"&&typeof i=="string"?w[i]:i))}updateMealName(r,i,n){this.diaryLog.update(a=>{let s=c({},a),e=s.diaryDays.find(o=>o.date===r);if(!e)return a;let t=e.dayTemplate.entries.find(o=>o.position===i);return t?(t.meal.name=n,s):a}),this.saveDiaryLog()}removeFood(r,i,n){this.diaryLog.update(a=>{let s=c({},a),e=s.diaryDays.find(o=>o.date===r);if(!e)return a;let t=e.dayTemplate.entries.find(o=>o.position===i);return t?(t.meal.foods=t.meal.foods.filter((o,y)=>y!==n),s):a}),this.saveDiaryLog()}removeRecipeFromPosition(r,i,n){this.diaryLog.update(a=>{let s=c({},a),e=s.diaryDays.find(o=>o.date===r);if(!e)return a;let t=e.dayTemplate.entries.find(o=>o.position===i);return t?(t.recipes=t.recipes.filter((o,y)=>y!==n),s):a}),this.saveDiaryLog()}updateRecipeFoodWeight(r,i,n,a,s){this.diaryLog.update(e=>{let t=c({},e),o=t.diaryDays.find(m=>m.date===r);if(!o)return e;let y=o.dayTemplate.entries.find(m=>m.position===i);if(!y)return e;let d=y.recipes?.[n];if(!d)return e;let g=d.foods?.[a];return g?(g.weight=Number(s),t):e}),this.saveDiaryLog()}removeFoodFromRecipe(r,i,n,a){this.diaryLog.update(s=>{let e=c({},s),t=e.diaryDays.find(g=>g.date===r);if(!t)return s;let o=t.dayTemplate.entries.find(g=>g.position===i);if(!o)return s;let y=o.recipes?.[n];return!y||!y.foods?.[a]?s:(y.foods=y.foods.filter((g,m)=>m!==a),e)}),this.saveDiaryLog()}clearMeal(r,i){this.diaryLog.update(n=>{let a=c({},n),s=a.diaryDays.find(t=>t.date===r);return!s||!s.dayTemplate.entries.find(t=>t.position===i)?n:(s.dayTemplate.entries=s.dayTemplate.entries.filter(t=>t.position!==i),a)}),this.saveDiaryLog()}updateFoodWeight(r,i,n,a){this.diaryLog.update(s=>{let e=c({},s),t=e.diaryDays.find(y=>y.date===r);if(!t)return s;let o=t.dayTemplate.entries.find(y=>y.position===i);return o?(o.meal.foods[n].weight=Number(a),e):s}),this.saveDiaryLog()}getDayStats(r){let i=this.diaryLog()?.diaryDays.find(a=>a.date===r),n=new L;if(!i)return n;for(let a of i.dayTemplate.entries){let s=[...a.meal.foods,...a.recipes.flatMap(e=>e.foods)];n.proteins+=s.reduce((e,t)=>e+t.protein*t.weight*.01,0),n.carbs+=s.reduce((e,t)=>e+t.carbs*t.weight*.01,0),n.fats+=s.reduce((e,t)=>e+t.fats*t.weight*.01,0),n.fiber+=s.reduce((e,t)=>e+t.fiber*t.weight*.01,0),n.calories+=s.reduce((e,t)=>e+t.calories*t.weight*.01,0),n.weight+=s.reduce((e,t)=>e+t.weight,0)}return n}getDayNote(r){return this.diaryLog()?.diaryDays?.find(i=>i.date===r)?.dayTemplate?.note??null}updateDayNote(r,i){this.diaryLog.update(n=>{let a=c({},n),s=a.diaryDays.find(e=>e.date===r);if(!s){let e=new u(r,new p);a.diaryDays.push(e),s=e}return s.dayTemplate.note=i,a}),this.saveDiaryLog()}getDayWater(r){return this.diaryLog()?.diaryDays?.find(i=>i.date===r)?.dayTemplate?.waterMl??null}updateDayWater(r,i){this.diaryLog.update(n=>{let a=c({},n),s=a.diaryDays.find(e=>e.date===r);if(!s){let e=new u(r,new p);a.diaryDays.push(e),s=e}return i?s.dayTemplate.waterMl=Number(i):delete s.dayTemplate.waterMl,a}),this.saveDiaryLog()}addDayWater(r,i){this.updateDayWater(r,(this.getDayWater(r)+i).toString())}subtractDayWater(r,i){let n=this.getDayWater(r);n<=i?this.updateDayWater(r,""):this.updateDayWater(r,(n-i).toString())}getPositionStats(r,i){let n=this.diaryLog()?.diaryDays.find(t=>t.date===r),a=new L;if(!n)return a;let s=n.dayTemplate.entries.find(t=>t.position===i);if(!s)return a;let e=[...s.meal.foods,...s.recipes.flatMap(t=>t.foods)];return{proteins:e.reduce((t,o)=>t+o.protein*o.weight*.01,0),carbs:e.reduce((t,o)=>t+o.carbs*o.weight*.01,0),fats:e.reduce((t,o)=>t+o.fats*o.weight*.01,0),fiber:e.reduce((t,o)=>t+o.fiber*o.weight*.01,0),calories:e.reduce((t,o)=>t+o.calories*o.weight*.01,0),weight:e.reduce((t,o)=>t+o.weight,0)}}updateMealNote(r,i,n){this.diaryLog.update(a=>{let s=c({},a),e=s.diaryDays.find(o=>o.date===r);if(!e)return a;let t=e.dayTemplate.entries.find(o=>o.meal.id===i);return t?(t.meal.note=n,s):a}),this.saveDiaryLog()}getExpandedMeal(){let r=localStorage.getItem("expandedMeal");return r?JSON.parse(r):null}toggleExpandedMeal(r,i){let n=this.getExpandedMeal();localStorage.setItem("expandedMeal",JSON.stringify({isoDate:n?.isoDate===r&&n?.mealPosition===i?"":r,mealPosition:n?.isoDate===r&&n?.mealPosition===i?0:i}))}expandMeal(r,i){localStorage.setItem("expandedMeal",JSON.stringify({isoDate:r,mealPosition:i}))}addRecipe(r,i,n,a){this.diaryLog.update(s=>{let e=c({},s),t=e.diaryDays.find(d=>d.date===r);if(!t){let d=new u(r,new p);e.diaryDays.push(d),t=d}let o=t.dayTemplate.entries.find(d=>d.position===i),y=new W(v(),a.name,a.foods.map(d=>new C(d.id,d.name,d.macroCategory,d.protein,d.carbs,d.fats,d.fiber,d.calories,d.weight*(n/a.portions),d.note)),n,a.note);return o?o.recipes.push(y):(o=new D(i,new h(v(),T[i],[]),[y]),t.dayTemplate.entries.push(o)),e}),this.saveDiaryLog()}hasFoodOnDate(r){let i=this.diaryLog()?.diaryDays.find(n=>n.date===r);if(!i)return!1;for(let n of i.dayTemplate.entries)if(n.meal.foods.length>0||n.recipes.length>0)return!0;return!1}hasWeightInOnDate(r){return!!this.diaryLog()?.diaryDays.find(i=>i.date===r)?.dayTemplate?.weight}hasWaterOnDate(r){return!!this.diaryLog()?.diaryDays.find(i=>i.date===r)?.dayTemplate?.waterMl}hasActivitiesOnDate(r){return!!this.diaryLog()?.diaryDays.find(i=>i.date===r)?.dayTemplate?.activities?.some(i=>!!i.durationMinutes&&i.type!==0)}getCurrentWeight(r){let i=this.diaryLog()?.diaryDays.find(n=>n.date===r);return i?i.dayTemplate.weight??null:null}updateCurrentWeight(r,i){this.diaryLog.update(n=>{let a=c({},n),s=a.diaryDays.find(e=>e.date===r);if(!s){let e=new u(r,new p);a.diaryDays.push(e),s=e}return i?s.dayTemplate.weight=Number(i):delete s.dayTemplate.weight,a}),this.saveDiaryLog()}getWeightByFormula(r,i){let n=(0,f.default)(r).utc().startOf("day"),a=[];for(let e=0;e<i;e++){let t=n.subtract(e,"day").toISOString(),o=this.getCurrentWeight(t);o&&a.push(o)}if(!a.length)return 0;if(a.sort(),a.length<=3)return a.reduce((e,t)=>e+t,0)/a.length;let s=Math.floor(a.length/2);return a.length%2===0?(a[s-1]+a[s])/2:(a[s-1]+a[s]+a[s+1])/3}getWeights(r,i){let n=f.default.min((0,f.default)(r).utc().startOf("day"),(0,f.default)().utc().startOf("day")),a=[],s=0;for(let e=0;e<i;e++){let t=n.subtract(e,"day").toISOString();s=this.getCurrentWeight(t),s&&a.push(s)}return a.reverse(),a}getActivities(r){return this.diaryLog()?.diaryDays.find(i=>i.date===r)?.dayTemplate.activities??[]}addActivity(r){this.diaryLog.update(i=>{let n=c({},i),a=n.diaryDays.find(o=>o.date===r);if(!a){let o=new u(r,new p);n.diaryDays.push(o),a=o}let s=a.dayTemplate.activities,e=(0,f.default)(),t=new b({hour:e.hour(),minute:e.minute(),second:0});return s?.length?s.push(t):a.dayTemplate.activities=[t],n}),this.saveDiaryLog()}removeActivity(r,i){this.diaryLog.update(n=>{let a=c({},n),s=a.diaryDays.find(e=>e.date===r);return s?(s.dayTemplate.activities=s.dayTemplate.activities.filter((e,t)=>t!==i),a):n}),this.saveDiaryLog()}setActivityType(r,i,n){this.diaryLog.update(a=>{let s=c({},a),e=s.diaryDays.find(t=>t.date===r);return e?(e.dayTemplate.activities[i].type=n,s):a}),this.saveDiaryLog()}static \u0275fac=function(i){return new(i||l)};static \u0275prov=S({token:l,factory:l.\u0275fac,providedIn:"root"})};export{w as a,T as b,p as c,x as d,_ as e,I as f};

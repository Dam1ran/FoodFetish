import{a as qe,b as Qe,c as He,d as Xe}from"./chunk-6YGXHA7D.js";import{a as et,b as P}from"./chunk-XONAYTCT.js";import{b as Ze,c as Ye,d as be,e as Ke,f as E}from"./chunk-WRE7E6LM.js";import{c as ot,e as ae,h as de,j as se,k as Re,l as Oe,m as B,n as Pe,o as Le,q as $e,r as ce,s as Be}from"./chunk-DKM6TLGV.js";import{a as A,b as je,e as Ge,g as O,i as H,p as Ue}from"./chunk-V6FOYY4F.js";import{a as ze}from"./chunk-7QS2YA2B.js";import{b as Ne,f as Ve,j as Ae,l as Je,t as he}from"./chunk-JNNI6R4E.js";import{$a as De,$b as Fe,Eb as y,Fa as a,Gb as c,Nb as oe,Ob as ne,Pb as Se,Qb as G,Rb as z,Tb as $,Ub as l,Vb as Me,Wa as b,Wb as u,X as ee,Xb as N,Yb as V,Zb as R,_b as Ce,aa as x,ac as ve,e as it,eb as W,ec as q,fa as m,fc as Te,ga as g,gc as Ie,ha as K,hc as Ee,ib as S,ic as We,jb as M,jc as xe,kb as F,mb as T,mc as k,nb as I,ob as f,pb as d,pc as j,qb as s,qc as h,ra as C,rb as _,rc as re,sa as te,sb as D,tb as w,tc as Q,ub as ie,wc as ke,xb as v}from"./chunk-DAZPDLGM.js";var nt=["weightInput"],rt=(n,i)=>({"opacity-25":n,"opacity-5":i}),X=class n{food=h.required();isOdd=h(!1);removeFood=j();updateFoodWeight=j();noRemove=h(!1,{transform:ke});focusWeight=h(!1);weightInput=re("weightInput");ngAfterViewInit(){this.focusWeight()&&this.weightInput().nativeElement.focus()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=b({type:n,selectors:[["food-row"]],viewQuery:function(e,t){e&1&&oe(t.weightInput,nt,5),e&2&&ne()},inputs:{food:[1,"food"],isOdd:[1,"isOdd"],noRemove:[1,"noRemove"],focusWeight:[1,"focusWeight"]},outputs:{removeFood:"removeFood",updateFoodWeight:"updateFoodWeight"},decls:18,vars:16,consts:[["weightInput",""],[1,"d-flex"],["iconSize","16px",1,"btn","btn-outline-warning","mx-1","align-self-center",3,"click","disabled","buttonIcon"],[1,"d-flex","align-items-center","ps-1",2,"min-width","100px","width","20%","font-size","12px"],[1,"row","g-0","fw-light","fst-italic","flex-grow-1","align-self-stretch",2,"font-size","12px"],[1,"col","col-2","align-self-stretch","text-center","align-content-center","m-0"],[1,"col","col-2","align-self-stretch","text-center","align-content-center"],["type","number","inputmode","numeric",1,"form-control","form-control-sm","text-center","p-0","border","border-success-subtle","bg-body","shadow-none",2,"border-radius","4px",3,"blur","value"]],template:function(e,t){if(e&1){let o=v();d(0,"div",1)(1,"button",2),y("click",function(){return m(o),g(!t.noRemove()&&t.removeFood.emit())}),s(),d(2,"div",3),l(3),s(),d(4,"div",4)(5,"div",5),l(6),s(),d(7,"div",6),l(8),s(),d(9,"div",6),l(10),s(),d(11,"div",6),l(12),s(),d(13,"div",6),l(14),s(),d(15,"div",6)(16,"input",7,0),y("blur",function(p){return m(o),g(t.updateFoodWeight.emit(p.target.value))}),s()()()()}if(e&2){z("bg-body-tertiary",t.isOdd()),a(),$(q(13,rt,!t.noRemove(),t.noRemove())),f("disabled",t.noRemove())("buttonIcon",t.noRemove()?"":"iconoir:trash"),a(2),u(" ",t.food().name," ");let o=t.food().weight*.01;a(3),u(" ",(t.food().protein*o).toFixed(1)," "),a(2),u(" ",(t.food().carbs*o).toFixed(1)," "),a(2),u(" ",(t.food().fats*o).toFixed(1)," "),a(2),u(" ",(t.food().fiber*o).toFixed(1)," "),a(2),u(" ",(t.food().calories*o).toFixed(1)," "),a(2),f("value",t.food().weight)}},dependencies:[O],encapsulation:2})};var Z=class n{stats=h.required();fixedDecimals=h(1);static \u0275fac=function(e){return new(e||n)};static \u0275cmp=b({type:n,selectors:[["total-row"]],inputs:{stats:[1,"stats"],fixedDecimals:[1,"fixedDecimals"]},decls:16,vars:6,consts:[[1,"d-flex"],[1,"fw-bold","text-muted","opacity-75","fst-italic",2,"width","130px"],[1,"row","g-0","flex-grow-1","fw-bold","text-muted","fst-italic","opacity-75",2,"font-size","12px"],[1,"col","col-2","text-center","align-content-center","bg-body-secondary"],[1,"col","col-2","text-center","align-content-center"]],template:function(e,t){e&1&&(D(0,"div",0)(1,"div",1),l(2,"Total"),w(),D(3,"div",2)(4,"div",3),l(5),w(),D(6,"div",4),l(7),w(),D(8,"div",3),l(9),w(),D(10,"div",4),l(11),w(),D(12,"div",3),l(13),w(),D(14,"div",4),l(15),w()()()),e&2&&(a(5),u(" ",t.stats().proteins.toFixed(t.fixedDecimals())," "),a(2),u(" ",t.stats().carbs.toFixed(t.fixedDecimals())," "),a(2),u(" ",t.stats().fats.toFixed(t.fixedDecimals())," "),a(2),u(" ",t.stats().fiber.toFixed(t.fixedDecimals())," "),a(2),u(" ",t.stats().calories.toFixed(t.fixedDecimals())," "),a(2),u(" ",t.stats().weight.toFixed(t.fixedDecimals())," "))},encapsulation:2})};function at(n,i){if(n&1){let e=v();d(0,"food-row",15),y("updateFoodWeight",function(o){let r=m(e).$index,p=c();return g(p.updateFoodWeight.emit({foodIndex:r,newWeight:+o}))})("removeFood",function(){let o=m(e).$index,r=c();return g(r.removeFood.emit(o))}),s()}if(n&2){let e,t=i.$implicit,o=i.$index,r=c();f("food",t)("isOdd",o%2!==0)("noRemove",((e=r.recipe().foods)==null?null:e.length)===1)}}var le=class n{id=C(ze());recipe=h.required();updateFoodWeight=j();removeFood=j();removeRecipe=j();recipeStats(){return Ue(this.recipe())}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=b({type:n,selectors:[["diary-recipe"]],inputs:{recipe:[1,"recipe"]},outputs:{updateFoodWeight:"updateFoodWeight",removeFood:"removeFood",removeRecipe:"removeRecipe"},decls:18,vars:8,consts:[["collapsible",""],[1,"accordion","accordion-flush",2,"--bs-accordion-active-bg","rgba(7, 60, 130, 0.5)",3,"id"],[1,"accordion-item"],[1,"accordion-header","d-flex","align-items-center"],["buttonIcon","iconoir:trash","iconSize","16px",1,"btn","btn-outline-warning","btn-sm","opacity-25","mx-1",3,"click"],["type","button","data-bs-toggle","collapse",1,"accordion-button","collapsed","p-1","shadow-none"],[1,"opacity-75","w-100","d-flex"],[1,"mx-auto","text-center","text-primary-emphasis","text-truncate"],[1,"d-flex","align-items-center","gap-1","justify-content-center",2,"width","34px"],["icon","icon-park-outline:chart-proportion","size","16px",1,"text-success"],[1,"text-muted",2,"font-size","10px"],[1,"accordion-collapse","collapse","bg-body-secondary",3,"id"],[3,"food","isOdd","noRemove"],[1,"bg-body"],[3,"stats","fixedDecimals"],[3,"updateFoodWeight","removeFood","food","isOdd","noRemove"]],template:function(e,t){if(e&1){let o=v();d(0,"div",1)(1,"div",2)(2,"h2",3)(3,"button",4),y("click",function(){return m(o),g(t.removeRecipe.emit())}),s(),d(4,"button",5)(5,"div",6)(6,"div",7),l(7),s()()(),d(8,"div",8),_(9,"iconify",9),d(10,"div",10),l(11),s()()(),d(12,"div",11,0),T(14,at,1,3,"food-row",12,F),d(16,"div",13),_(17,"total-row",14),s()()()()}e&2&&(f("id","accordionFlushRecipe-"+t.id()),a(4),W("data-bs-target","#flush-collapse-"+t.id()),a(3),u(" ",t.recipe().name," "),a(4),Me(t.recipe().portions),a(),f("id","flush-collapse-"+t.id()),W("data-bs-parent","#accordionFlushRecipe-"+t.id()),a(2),I(t.recipe().foods),a(3),f("stats",t.recipeStats())("fixedDecimals",0))},dependencies:[X,Z,A,O],encapsulation:2})};var dt=(n,i,e,t,o)=>({"border-warning":n,"text-primary":i,"fw-bold":e,"fst-normal":t,"bg-body-secondary":o});function st(n,i){if(n&1){let e=v();d(0,"div",4),y("click",function(){let o=m(e).$implicit,r=c();return g(r.selectWeekDay(o))}),d(1,"div",5),l(2),s(),_(3,"div",6),s()}if(n&2){let e=i.$implicit,t=i.$index,o=c();$(Ie(5,dt,o.isDaySelected(e),o.isTodayLbl(e),o.isTodayLbl(e),o.isTodayLbl(e),t===5||t===6)),a(2),u("",e,"."),a(),G("background-color",o.getIndicatorStatusColor(e))}}var pe=class n{weekdays=["Mo","Tu","We","Th","Fr","Sa","Su"];calendar=x(Le);selectedDate=Q();selectedDayJs=k(()=>P.fromNgbDateStruct(this.selectedDate()));ngOnInit(){this.selectedDate.set(this.calendar.getToday())}isDaySelected(i){let e=P.getStartOfToday();return i===this.weekdays[this.selectedDayJs().day()===0?6:this.selectedDayJs().day()-1]&&e.isoWeek()===this.selectedDayJs().isoWeek()}isTodayLbl(i){let e=P.getStartOfToday();return i===this.weekdays[e.day()===0?6:e.day()-1]}selectWeekDay(i){let e=this.weekdays.indexOf(i);if(P.getStartOfToday().isoWeek()!==this.selectedDayJs().isoWeek())return;let o=this.selectedDayJs().isoWeekday(e+1);this.selectedDate.set({day:o.date(),month:o.month()+1,year:o.year()})}diaryLogService=x(E);getIndicatorStatusColor(i){let e=this.diaryLogService.hasFoodOnDate(this.selectedDayJs().isoWeekday(this.weekdays.indexOf(i)+1).toISOString()),t=this.diaryLogService.hasWeightInOnDate(this.selectedDayJs().isoWeekday(this.weekdays.indexOf(i)+1).toISOString()),o=this.diaryLogService.hasWaterOnDate(this.selectedDayJs().isoWeekday(this.weekdays.indexOf(i)+1).toISOString()),r=this.diaryLogService.hasActivitiesOnDate(this.selectedDayJs().isoWeekday(this.weekdays.indexOf(i)+1).toISOString());return e&&t&&o&&r?"rgba(60, 140, 70)":e||t||o||r?"rgba(150, 120, 70)":"rgba(90, 90, 90)"}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=b({type:n,selectors:[["weekdays"]],inputs:{selectedDate:[1,"selectedDate"]},outputs:{selectedDate:"selectedDateChange"},decls:5,vars:1,consts:[[1,"bg-secondary-subtle","p-1","user-select-none"],[1,"d-flex","justify-content-between"],[1,"weekday","bg-body","cursor-pointer",3,"class"],[3,"selectedDateChange","selectedDate"],[1,"weekday","bg-body","cursor-pointer",3,"click"],[1,"text-center"],[1,"rounded","m-auto",2,"width","10px","height","10px"]],template:function(e,t){e&1&&(d(0,"div",0)(1,"div",1),T(2,st,4,11,"div",2,F),d(4,"date-picker",3),R("selectedDateChange",function(r){return V(t.selectedDate,r)||(t.selectedDate=r),r}),s()()()),e&2&&(a(2),I(t.weekdays),a(2),N("selectedDate",t.selectedDate))},dependencies:[et],styles:[".weekday[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;font-size:14px;border:2px solid transparent;transition:border .3s;font-style:italic}"]})};var we=it(ot());var me=class{weightFormulaBackDays=7};var U=class n{options=C(new me);constructor(){this.loadOptions()}loadOptions(){let i=localStorage.getItem("options");i&&this.options.set(JSON.parse(i))}saveOptions(){localStorage.setItem("options",JSON.stringify(this.options()))}setOptions(i){this.options.set(i),this.saveOptions()}static \u0275fac=function(e){return new(e||n)};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})};var ct=(n,i)=>({"text-info-emphasis":n,"text-warning-emphasis":i});function lt(n,i){if(n&1&&(K(),_(0,"line",10)),n&2){let e=c(),t=e.$implicit,o=e.$index,r=c(3);W("x1",`${96/(r.weights().length-1)*o+2}%`)("y1",`${r.weightsRange()===0?50:(r.weightsMax()+r.weightsRange()*.1-t)/(r.weightsRange()*1.5)*100}%`)("x2",`${96/(r.weights().length-1)*(o+1)+2}%`)("y2",`${r.weightsRange()===0?50:(r.weightsMax()+r.weightsRange()*.1-r.weights()[o+1])/(r.weightsRange()*1.5)*100}%`)}}function pt(n,i){if(n&1&&(K(),d(0,"text",11),l(1),s()),n&2){let e=c(),t=e.$implicit,o=e.$index,r=c(3);W("x",`${88/r.Math.max(r.weights().length-1,1)*o+6}%`),a(),u(" ",t.toFixed(1)," ")}}function mt(n,i){if(n&1&&(K(),_(0,"circle",9),S(1,lt,1,4,":svg:line",10),S(2,pt,2,2,":svg:text",11)),n&2){let e=i.$implicit,t=i.$index,o=c(3);W("cx",`${96/o.Math.max(o.weights().length-1,1)*t+2}%`)("cy",`${o.weightsRange()===0?50:(o.weightsMax()+o.weightsRange()*.1-e)/(o.weightsRange()*1.5)*100}%`),a(),M(t<o.weights().length-1?1:-1),a(),M(e?2:-1)}}function gt(n,i){if(n&1&&(K(),d(0,"svg",1),T(1,mt,3,4,null,null,F),s()),n&2){let e=c(2);a(),I(e.weights())}}function ut(n,i){if(n&1){let e=v();S(0,gt,3,0,":svg:svg",1),d(1,"div",2)(2,"div",3),_(3,"iconify",4),d(4,"div",5),l(5),s()(),d(6,"div",6),_(7,"iconify",7),d(8,"input",8),y("blur",function(o){m(e);let r=c();return g(r.diaryLogService.updateCurrentWeight(r.isoDate(),o.target.value))}),s()()()}if(n&2){let e=c();M(e.weights().length?0:-1),a(5),u(" ",e.diaryLogService.getWeightByFormula(e.isoDate(),e.optionsService.options().weightFormulaBackDays).toFixed(1)," kg "),a(2),$(q(7,ct,e.diaryLogService.getCurrentWeight(e.isoDate()),!e.diaryLogService.getCurrentWeight(e.isoDate()))),a(),f("placeholder",e.diaryLogService.getCurrentWeight(e.isoDate())?"kg":"?")("disabled",e.weightInputDisabled())("value",e.diaryLogService.getCurrentWeight(e.isoDate()))}}var ge=class n{Math=Math;diaryLogService=x(E);optionsService=x(U);isoDate=h("");weights(){return this.isoDate()?this.diaryLogService.getWeights(this.isoDate(),11):[]}weightsMax=k(()=>Math.max(...this.weights()));weightsMin=k(()=>Math.min(...this.weights()));weightsRange=k(()=>this.weightsMax()-this.weightsMin());weightInputDisabled(){return(0,we.default)().utc().startOf("day").isBefore((0,we.default)(this.isoDate()).utc())}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=b({type:n,selectors:[["weight-in-widget"]],inputs:{isoDate:[1,"isoDate"]},decls:2,vars:1,consts:[[1,"rounded","bg-body-secondary"],[1,"w-100",2,"pointer-events","none","height","64px"],[1,"d-flex"],[1,"flex-grow-1","px-1","d-flex","align-items-center","mt-3"],["icon","ph:tilde-fill",1,"opacity-50"],[1,"ms-1","fw-semibold","opacity-75",2,"font-size","14px"],[1,"position-relative","d-flex","justify-content-center","align-items-center","overflow-hidden","me-1",2,"width","48px","height","48px"],["icon","iconoir:weight","size","3rem",1,"position-absolute","z-0","opacity-55",2,"transform","scaleX(1.25)"],["type","number","inputmode","numeric",1,"form-control","text-center","p-0","shadow-none","z-1","border-0",2,"width","44px","background-color","transparent","margin-top","10px",3,"blur","placeholder","disabled","value"],["r","4","fill","rgba(from var(--bs-info-text-emphasis) r g b / 0.5)"],["stroke","rgba(from var(--bs-info-text-emphasis) r g b / 0.4)","stroke-width","1"],["y","96%","fill","rgba(from var(--bs-info-text-emphasis) r g b / 0.5)","font-size","12px","font-style","italic","text-anchor","middle"]],template:function(e,t){e&1&&(d(0,"div",0),S(1,ut,9,10),s()),e&2&&(a(),M(t.weightInputDisabled()?-1:1))},dependencies:[A],styles:["input[_ngcontent-%COMP%]{color:var(--bs-info-text-emphasis)}[_ngcontent-%COMP%]::placeholder{color:var(--bs-info-text-emphasis);font-style:italic;opacity:.4}"]})};function ft(n,i){if(n&1){let e=v();d(0,"li")(1,"span",25),y("click",function(){m(e);let o=c().$implicit,r=c().$index,p=c();return g(p.diaryLogService.setActivityType(p.isoDate(),r,o.value))}),l(2),s()()}if(n&2){let e=c().$implicit;a(2),u(" ",e.label," ")}}function _t(n,i){if(n&1&&S(0,ft,3,1,"li"),n&2){let e=i.$implicit;M(e.value?0:-1)}}function vt(n,i){if(n&1){let e=v();d(0,"div",6)(1,"h2",7)(2,"button",8),y("click",function(){let o=m(e).$index,r=c();return g(r.diaryLogService.removeActivity(r.isoDate(),o))}),s(),d(3,"button",9),l(4),s(),d(5,"ul",10),T(6,_t,1,1,null,null,F),s(),d(8,"button",11),_(9,"iconify",12),s()(),d(10,"div",13,0)(12,"div",14)(13,"div",15)(14,"span",16),_(15,"iconify",17),s(),d(16,"div",18)(17,"ngb-timepicker",19),R("ngModelChange",function(o){let r=m(e).$implicit;return V(r.time,o)||(r.time=o),g(o)}),y("change",function(){m(e);let o=c();return g(o.diaryLogService.saveDiaryLog())}),s()()(),d(18,"div",15)(19,"span",20),_(20,"iconify",21),s(),d(21,"input",22),R("ngModelChange",function(o){let r=m(e).$implicit;return V(r.durationMinutes,o)||(r.durationMinutes=o),g(o)}),y("blur",function(){m(e);let o=c();return g(o.diaryLogService.saveDiaryLog())}),s()()(),d(22,"div",23)(23,"input",24),R("ngModelChange",function(o){let r=m(e).$implicit;return V(r.note,o)||(r.note=o),g(o)}),y("blur",function(){m(e);let o=c();return g(o.diaryLogService.saveDiaryLog())}),s()()()()}if(n&2){let e=i.$implicit,t=i.$index,o=c();a(4),u(" ",o.activitiesTypes[e.type].label," "),a(2),I(o.activitiesTypes),a(2),W("data-bs-target","#flush-activity-collapse"+t),a(),f("icon",o.activityTypeIconMap[e.type].icon),a(),f("id","flush-activity-collapse"+t),a(7),f("spinners",!1),N("ngModel",e.time),a(4),N("ngModel",e.durationMinutes),a(2),N("ngModel",e.note)}}var ue=class n{diaryLogService=x(E);isoDate=h("");activityTypeIconMap=Ke;activitiesTypes=Object.keys(be).filter(i=>!isNaN(Number(i))).map(i=>({label:be[i],value:+i}));static \u0275fac=function(e){return new(e||n)};static \u0275cmp=b({type:n,selectors:[["activity-widget"]],inputs:{isoDate:[1,"isoDate"]},decls:8,vars:0,consts:[["collapsible",""],[1,"bg-body","rounded","mt-1","rounded","overflow-hidden"],[1,"d-flex","align-items-center","bg-body-secondary"],[1,"text-muted","text-center","flex-grow-1","opacity-50",2,"font-size","12px"],["iconSize","24px","buttonIcon","iconamoon:sign-plus-bold",1,"btn","btn-sm",3,"click"],["id","accordionActivityFlush",1,"d-flex","flex-column","accordion","accordion-flush",2,"gap","1px","padding","1px 0px"],[1,"accordion-item","rounded","overflow-hidden","border-0"],[1,"accordion-header","d-flex","align-items-center","gap-1"],["buttonIcon","iconoir:trash","iconSize","16px",1,"btn","btn-outline-warning","btn-sm","opacity-25","mx-1",3,"click"],["type","button","data-bs-toggle","dropdown",1,"btn","btn-outline-secondary","dropdown-toggle","mx-auto","after-none","opacity-75","my-1",2,"min-width","150px","padding","2px 4px"],[1,"dropdown-menu","p-0","overflow-hidden","shadow-sm",2,"min-width","150px"],["type","button","data-bs-toggle","collapse",1,"accordion-button","p-1","bg-body-tertiary","collapsed","text-truncate","text-muted","fw-bold","shadow-none"],[1,"ms-auto","me-0",3,"icon"],["data-bs-parent","#accordionActivityFlush",1,"accordion-collapse","collapse","bg-body-tertiary",3,"id"],[1,"p-1","d-flex","gap-2","justify-content-between"],[1,"d-flex","align-items-center","gap-1"],[1,"fst-italic","opacity-15",2,"margin","0px 1px"],["icon","mingcute:time-line","size","24px"],[1,"",2,"padding","2px 0"],["size","small",3,"ngModelChange","change","spinners","ngModel"],[1,"fst-italic","opacity-15"],["icon","icon-park-outline:timer","size","24px"],["type","number","inputmode","numeric","step","1","min","0","placeholder","m",1,"form-control","form-control-sm","shadow-none","text-center","border","border-info-subtle","rounded-circle","opacity-75","mx-1",2,"width","30px","padding","0",3,"ngModelChange","blur","ngModel"],[2,"padding","2px"],["type","text","placeholder","Note",1,"form-control","form-control-sm","shadow-none","text-center","border-none","rounded-top-0","opacity-75",3,"ngModelChange","blur","ngModel"],[1,"dropdown-item","cursor-pointer","px-2","text-center",3,"click"]],template:function(e,t){e&1&&(d(0,"div",1)(1,"div",2)(2,"div",3),l(3," Activities "),s(),d(4,"button",4),y("click",function(){return t.diaryLogService.addActivity(t.isoDate())}),s()(),d(5,"div",5),T(6,vt,24,8,"div",6,F),s()()),e&2&&(a(6),I(t.diaryLogService.getActivities(t.isoDate())))},dependencies:[O,Be,B,ae,Re,de,Oe,se,A],encapsulation:2})};function xt(n,i){if(n&1){let e=v();_(0,"div",1),d(1,"div",2)(2,"zxing-scanner",3),y("scanSuccess",function(o){m(e);let r=c();return g(r.onCodeResult(o))}),s(),d(3,"div",4)(4,"div",5),_(5,"div",6),s()()()}if(n&2){let e=c();a(2),f("formats",e.formats)("autofocusEnabled",!0)}}function ht(n,i){if(n&1){let e=v();d(0,"div",0)(1,"button",7),y("click",function(){m(e);let o=c();return o.code.set(""),g(o.isScanning.set(!0))}),l(2," Re-scan "),s()(),d(3,"div",8)(4,"input",9),R("ngModelChange",function(o){m(e);let r=c();return V(r.code,o)||(r.code=o),g(o)}),y("click",function(o){return m(e),g(o.stopPropagation())}),s()()}if(n&2){let e=c();a(),f("disabled",e.isScanning()),a(3),N("ngModel",e.code)}}function bt(n,i){if(n&1){let e=v();d(0,"div",0)(1,"button",10),y("click",function(){m(e);let o=c();return g(o.onAddAsNewFood(o.code()))}),l(2," Add as new food "),s()()}if(n&2){let e=c();a(),f("disabled",e.isScanning())}}var ye=class n{foodsService=x(je);diaryLogService=x(E);modalService=x(ce);activeModal=x($e);formats=[qe.EAN_13];isScanning=C(!0);isoDate=C("");mealPosition=C(0);code=Q("");respectiveFood=k(()=>this.code()&&this.foodsService.getFoodByBarcode(this.code()));constructor(){te(()=>{let i=this.respectiveFood();i&&this.addFoodToDiary(i)})}onCodeResult(i){this.code.set(i),this.isScanning.set(!1)}addFoodToDiary(i){this.diaryLogService.addFood(this.isoDate(),this.mealPosition(),i),this.activeModal.close()}onAddAsNewFood(i){this.modalService.open(Xe).componentInstance.food.set(new Ge(void 0,"new food",0,0,0,0,0,0,100,i,""))}ngOnDestroy(){navigator.mediaDevices&&navigator.mediaDevices.stop&&navigator.mediaDevices.stop()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=b({type:n,selectors:[["ng-component"]],inputs:{code:[1,"code"]},outputs:{code:"codeChange"},decls:3,vars:3,consts:[[1,"d-flex","opacity-50","p-1","gap-1"],[1,"mt-2"],[1,"position-relative"],[3,"scanSuccess","formats","autofocusEnabled"],[1,"position-absolute","d-flex","align-items-center",2,"inset","0","pointer-events","none"],[1,"border-top","border-bottom","border-warning","w-75","m-auto","position-relative",2,"height","60%"],[1,"laser"],[1,"btn","btn-sm","btn-outline-warning","mx-auto","flex-grow-1",3,"click","disabled"],[1,"m-1"],[1,"form-control","form-control-sm","border-warning-subtle","text-center","opacity-75","fs-5",3,"ngModelChange","click","ngModel"],["buttonIcon","mdi:plus",1,"btn","btn-sm","btn-outline-success","mx-auto","flex-grow-1",3,"click","disabled"]],template:function(e,t){e&1&&(S(0,xt,6,2),S(1,ht,5,2),S(2,bt,3,1,"div",0)),e&2&&(M(t.isScanning()&&!t.respectiveFood()?0:-1),a(),M(!t.isScanning()&&!t.respectiveFood()?1:-1),a(),M(t.code()&&!t.respectiveFood()?2:-1))},dependencies:[He,Qe,B,ae,de,se,O],styles:["zxing-scanner[_ngcontent-%COMP%]{margin-top:2rem;max-width:min(60%,300px);margin:auto}.laser[_ngcontent-%COMP%]{position:absolute;width:100%;height:2px;background-color:#f0323280;box-shadow:0 0 8px #f0323280;top:50%;animation:_ngcontent-%COMP%_scan 1s infinite ease-in-out}@keyframes _ngcontent-%COMP%_scan{0%{top:5%}50%{top:95%}to{top:5%}}"]})};var fe=class n{isoDate=h("");stats=h.required();diaryLogService=x(E);optionsService=x(U);getProteinScrollbarBg(i,e){if(!e)return"rgba(120, 120, 120, 0.5)";let t=e*1.5,o=e*2.5,r=e*.8,p=e*3.2;return i>=t&&i<=o?"rgba(70, 170, 100, 0.6)":i>=r&&i<=p?"rgba(180, 150, 50, 0.6)":"rgba(240, 120, 20, 0.5)"}getCarbScrollbarBg(i,e){if(!e)return"rgba(120, 120, 120, 0.5)";let t=e*1.6,o=e*3.2,r=e*.7,p=e*3.7;return i>=t&&i<=o?"rgba(70, 170, 100, 0.6)":i>=r&&i<=p?"rgba(180, 150, 50, 0.6)":"rgba(240, 120, 20, 0.5)"}getFatScrollbarBg(i,e){if(!e)return"rgba(120, 120, 120, 0.5)";let t=e*.6,o=e*1.2,r=e*.4,p=e*1.4;return i>=t&&i<=o?"rgba(70, 170, 100, 0.6)":i>=r&&i<=p?"rgba(180, 150, 50, 0.6)":"rgba(240, 120, 20, 0.5)"}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=b({type:n,selectors:[["macros-widget"]],inputs:{isoDate:[1,"isoDate"],stats:[1,"stats"]},decls:21,vars:9,consts:[[1,"rounded","overflow-hidden"],[1,"row","align-items-center","bg-body-secondary"],[1,"col","text-center","text-muted","opacity-50","fst-italic",2,"font-size","12px"],[1,"d-flex","align-items-center","gap-2","bg-body-tertiary","p-2","overflow-hidden"],[1,"flex-grow-1","position-relative"],[1,"text-center","mx-auto","rounded","fw-bold","position-absolute","start-50","top-50","translate-middle","fst-it",2,"font-size","14px","line-height","14px","width","40%","color","rgb(80, 100, 240)","padding","3px 2px","background-color","rgb(30, 30, 30, 0.7)","border","1px solid rgba(150, 150, 150, 0.5)"],[1,"rounded-pill","overflow-hidden","borsder","border-primarsy-subtle",2,"height","14px"],[1,"text-center","rounded","mx-auto","fw-bold","position-absolute","start-50","top-50","translate-middle","fst-it",2,"font-size","14px","line-height","14px","width","40%","color","rgb(150, 180, 60)","padding","3px 2px","background-color","rgb(30, 30, 30, 0.7)","border","1px solid rgba(150, 150, 150, 0.5)"],[1,"text-center","rounded","mx-auto","fw-bold","position-absolute","start-50","top-50","translate-middle","fst-it",2,"font-size","14px","line-height","14px","width","40%","color","rgb(200, 160, 30)","padding","3px 2px","background-color","rgb(30, 30, 30, 0.7)","border","1px solid rgba(150, 150, 150, 0.5)"]],template:function(e,t){if(e&1&&(D(0,"div",0)(1,"div",1)(2,"div",2),l(3," Proteins "),w(),D(4,"div",2),l(5," Carbs "),w(),D(6,"div",2),l(7,"Fats"),w()(),D(8,"div",3)(9,"div",4)(10,"div",5),l(11),w(),ie(12,"div",6),w(),D(13,"div",4)(14,"div",7),l(15),w(),ie(16,"div",6),w(),D(17,"div",4)(18,"div",8),l(19),w(),ie(20,"div",6),w()()()),e&2){let o,r,p;a(11),u(" ",(o=t.stats().proteins)==null?null:o.toFixed()," "),a(),G("background-color",t.getProteinScrollbarBg(t.stats().proteins,t.diaryLogService.getWeightByFormula(void 0,t.optionsService.options().weightFormulaBackDays))),a(3),u(" ",(r=t.stats().carbs)==null?null:r.toFixed()," "),a(),G("background-color",t.getCarbScrollbarBg(t.stats().carbs,t.diaryLogService.getWeightByFormula(void 0,t.optionsService.options().weightFormulaBackDays))),a(3),u(" ",(p=t.stats().fats)==null?null:p.toFixed()," "),a(),G("background-color",t.getFatScrollbarBg(t.stats().fats,t.diaryLogService.getWeightByFormula(void 0,t.optionsService.options().weightFormulaBackDays)))}},dependencies:[B],encapsulation:2})};var _e=class n{dayTemplate=C(void 0);constructor(){this.setTemplate(),this.loadDayTemplate()}setTemplate(){if(!localStorage.getItem("dayTemplate")){let e=new Ye;e.entries.push({position:1,meal:new H("","Meal I"),recipes:[]}),e.entries.push({position:2,meal:new H("","Meal II"),recipes:[]}),e.entries.push({position:3,meal:new H("","Meal III"),recipes:[]}),e.entries.push({position:4,meal:new H("","Meal IV"),recipes:[]}),e.entries.push({position:5,meal:new H("","Snacks"),recipes:[]}),localStorage.setItem("dayTemplate",JSON.stringify(e))}}loadDayTemplate(){this.dayTemplate.set(JSON.parse(localStorage.getItem("dayTemplate")))}getDayTemplate(){return this.dayTemplate()}static \u0275fac=function(e){return new(e||n)};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})};var wt=["editMealNoteDialog"],Dt=(n,i,e)=>({"fst-italic":n,"fw-semibold":i,"text-muted":e}),St=(n,i)=>({"bg-body-secondary":n,"bg-dark-subtle":i});function Mt(n,i){n&1&&l(0),n&2&&u(" ",(i/1e3).toFixed(1),"L ")}function Ct(n,i){n&1&&l(0," ? ")}function Ft(n,i){if(n&1){let e=v();d(0,"div",30)(1,"button",37),y("click",function(){m(e),c();let o=ve(0),r=c();return g(r.toggleEditMealNoteDialog(o.id,o.note))}),s(),d(2,"input",38),y("input",function(o){m(e);let r=c().$implicit,p=c();return g(p.updateMealName(r.position,o.target.value))}),s()()}if(n&2){c();let e=ve(0);a(),z("btn-outline-success",e.note),a(),f("value",e.name)}}function Tt(n,i){if(n&1){let e=v();d(0,"diary-recipe",39),y("updateFoodWeight",function(o){let r=m(e).$index,p=c().$implicit,Y=c();return g(Y.updateRecipeFoodWeight(p.position,r,o.foodIndex,o.newWeight))})("removeRecipe",function(){let o=m(e).$index,r=c().$implicit,p=c();return g(p.removeRecipeFromPosition(r.position,o))})("removeFood",function(o){let r=m(e).$index,p=c().$implicit,Y=c();return g(Y.removeFoodFromRecipe(p.position,r,o))}),s()}if(n&2){let e=i.$implicit;f("recipe",e)}}function It(n,i){if(n&1){let e=v();d(0,"food-row",40),y("removeFood",function(){let o=m(e).$index,r=c().$implicit,p=c();return g(p.removeFood(r.position,o))})("updateFoodWeight",function(o){let r=m(e).$index,p=c().$implicit,Y=c();return g(Y.updateFoodWeight(p.position,r,o))}),s()}if(n&2){let e=i.$implicit,t=i.$index,o=i.$count,r=c().$implicit,p=c();f("food",e)("isOdd",t%2!==0)("focusWeight",p.isMealExpanded(r.position)&&t===o-1)}}function Et(n,i){if(n&1){let e=v();Ce(0),d(1,"div",20)(2,"h2",25)(3,"button",26),y("click",function(){let o=m(e).$implicit,r=c();return g(r.toggleExpandedMeal(o.position))}),l(4),s(),d(5,"div",27)(6,"div",28)(7,"div",18),l(8),s(),d(9,"div",18),l(10),s(),d(11,"div",18),l(12),s(),d(13,"div",18),l(14),s(),d(15,"div",18),l(16),s(),d(17,"div",18),l(18),s()()()(),d(19,"div",29,2),S(21,Ft,3,3,"div",30),T(22,Tt,1,1,"diary-recipe",31,F),T(24,It,1,3,"food-row",32,F),d(26,"div",33)(27,"button",34),y("click",function(o){let r=m(e).$implicit,p=c();return o.stopPropagation(),g(p.addRecipe(r.position))}),l(28," Recipe "),s(),d(29,"button",35),y("click",function(o){let r=m(e).$implicit,p=c();return o.stopPropagation(),g(p.onScanBarcodeClick(r.position))}),l(30," Barcode "),s(),d(31,"button",36),y("click",function(o){let r=m(e).$implicit,p=c();return o.stopPropagation(),g(p.addFood(r.position))}),l(32," Food "),s()()()()}if(n&2){let e=i.$implicit,t=i.$index,o=c(),r=Fe(o.getRespectiveMeal(e.position));a(3),z("collapsed",!o.isMealExpanded(e.position)),W("data-bs-target","#flush-collapse"+t),a(),u(" ",o.mealPositionMap[e.position]," "),a(2),$(q(20,St,!o.isMealExpanded(e.position),o.isMealExpanded(e.position)));let p=o.getPositionStats(e.position);a(2),u(" ",p.proteins.toFixed()," "),a(2),u(" ",p.carbs.toFixed()," "),a(2),u(" ",p.fats.toFixed()," "),a(2),u(" ",p.fiber.toFixed()," "),a(2),u(" ",p.calories.toFixed()," "),a(2),u(" ",p.weight.toFixed()," "),a(),z("show",o.isMealExpanded(e.position)),f("id","flush-collapse"+t),a(2),M(r?21:-1),a(),I(o.getRespectiveRecipes(e.position)),a(2),I(r==null?null:r.foods),a(3),f("minWidthPx",100),a(2),f("minWidthPx",100),a(2),f("minWidthPx",100)}}function Wt(n,i){if(n&1){let e=v();d(0,"textarea",41),y("input",function(o){m(e);let r=c();return g(r.updateMealNote(r.editNoteMealId(),o.target.value))}),s()}if(n&2){let e=c();f("value",e.editNoteMeal())}}function kt(n,i){if(n&1){let e=v();d(0,"textarea",42),y("input",function(o){m(e);let r=c();return g(r.diaryLogService.updateDayNote(r.selectedDayJs().toISOString(),o.target.value))}),s()}if(n&2){let e=c();f("value",e.diaryLogService.getDayNote(e.selectedDayJs().toISOString()))}}var tt=class n{diaryDate=h("");selectedDate=Q(void 0);selectedDayJs=k(()=>this.selectedDate()&&P.fromNgbDateStruct(this.selectedDate()));isTodaySelected=k(()=>this.selectedDate()&&P.fromNgbDateStruct(this.selectedDate()).isSame(P.getStartOfToday(),"day"));ngAfterViewInit(){this.diaryDate()&&this.selectedDate.set(P.toNgbDateStruct(this.diaryDate()))}location=x(Ne);activatedRoute=x(Ae);constructor(){te(()=>{if(!this.selectedDate())return;let i=this.selectedDayJs();if(i){let e=this.router.createUrlTree([],{relativeTo:this.activatedRoute,queryParams:{diaryDate:i.toISOString()}}).toString();this.location.go(e)}})}dayTemplateService=x(_e);router=x(Je);addFood(i){this.router.navigate([he.myFoods],{queryParams:{diaryDate:this.selectedDayJs().toISOString(),mealPosition:i}})}addRecipe(i){this.router.navigate([he.recipes],{queryParams:{diaryDate:this.selectedDayJs().toISOString(),mealPosition:i}})}diaryLogService=x(E);mealPositionMap=Ze;getRespectiveMeal(i){return this.diaryLogService.getRespectiveMeal(this.selectedDayJs().toISOString(),i)}getRespectiveRecipes(i){return this.diaryLogService.getRespectiveRecipes(this.selectedDayJs().toISOString(),i)}updateMealName(i,e){this.diaryLogService.updateMealName(this.selectedDayJs().toISOString(),i,e)}removeFood(i,e){this.diaryLogService.removeFood(this.selectedDayJs().toISOString(),i,e)}updateFoodWeight(i,e,t){this.diaryLogService.updateFoodWeight(this.selectedDayJs().toISOString(),i,e,+t)}getPositionStats(i){return this.diaryLogService.getPositionStats(this.selectedDayJs().toISOString(),i)}getDayStats(){return this.diaryLogService.getDayStats(this.selectedDayJs().toISOString())}toggleExpandedMeal(i){this.diaryLogService.toggleExpandedMeal(this.selectedDayJs().toISOString(),i)}isMealExpanded(i){let e=this.diaryLogService.getExpandedMeal();return e?.isoDate===this.selectedDayJs().toISOString()&&e?.mealPosition===i}modalService=x(ce);editMealNoteDialogRef=re("editMealNoteDialog");editNoteMealId=C("");editNoteMeal=C("");toggleEditMealNoteDialog(i,e){this.editNoteMealId.set(i),this.editNoteMeal.set(e),this.modalService.open(this.editMealNoteDialogRef(),{size:"sm",centered:!0}).result.catch(()=>{this.editNoteMealId.set(""),this.editNoteMeal.set("")})}updateMealNote(i,e){this.diaryLogService.updateMealNote(this.selectedDayJs().toISOString(),i,e)}updateRecipeFoodWeight(i,e,t,o){this.diaryLogService.updateRecipeFoodWeight(this.selectedDayJs().toISOString(),i,e,t,o)}removeFoodFromRecipe(i,e,t){this.diaryLogService.removeFoodFromRecipe(this.selectedDayJs().toISOString(),i,e,t)}removeRecipeFromPosition(i,e){this.diaryLogService.removeRecipeFromPosition(this.selectedDayJs().toISOString(),i,e)}toggleEditDayNoteDialog(i){this.modalService.open(i,{size:"sm",centered:!0})}onScanBarcodeClick(i){let e=this.modalService.open(ye,{size:"sm",centered:!0});e.componentInstance.isoDate.set(this.selectedDayJs().toISOString()),e.componentInstance.mealPosition.set(i)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=b({type:n,selectors:[["diary"]],viewQuery:function(e,t){e&1&&oe(t.editMealNoteDialogRef,wt,5),e&2&&ne()},inputs:{diaryDate:[1,"diaryDate"],selectedDate:[1,"selectedDate"]},outputs:{selectedDate:"selectedDateChange"},decls:45,vars:19,consts:[["editMealNoteDialog",""],["editDayNoteDialog",""],["collapsible",""],[1,"content-wrapper"],[1,"bg-body-tertiary","text-center","opacity-75",2,"font-size","14px","line-height","16px"],[3,"selectedDateChange","selectedDate"],[1,"border-bottom"],[1,"d-flex"],[1,"d-flex","justify-content-between","align-items-center","p-1",2,"width","130px"],[1,"btn","p-0","opacity-75","d-flex","justify-content-between","rounded",2,"border","1px solid transparent",3,"click"],["icon","iconoir:notes"],[1,"d-flex","align-items-center"],[1,"btn","p-0","d-flex","justify-content-between","position-relative",2,"width","fit-content",3,"click"],["size","16px","icon","iconamoon:sign-minus-bold",1,"position-absolute","z-1","translate-middle","top-50","start-50","text-info-emphasis"],["icon","mdi:glass-outline",1,"z-0","opacity-30"],[1,"text-center","rounded",2,"width","40px"],["size","16px","icon","iconamoon:sign-plus-bold",1,"position-absolute","z-1","translate-middle","top-50","start-50","text-info-emphasis"],[1,"row","g-0","flex-grow-1","fw-bold","text-muted","fst-italic","opacity-25","bg-body-secondary",2,"font-size","12px"],[1,"col","col-2","align-self-center","text-center"],["id","accordionFlush",1,"accordion","accordion-flush"],[1,"accordion-item"],[3,"stats","fixedDecimals"],[1,"mt-1","d-block",3,"isoDate","stats"],[1,"mt-1","d-block",3,"isoDate"],[3,"isoDate"],[1,"accordion-header","d-flex","align-items-center"],["type","button","data-bs-toggle","collapse",1,"accordion-button","p-1","text-truncate","text-muted","fw-bold","opacity-75","shadow-none",2,"width","130px",3,"click"],[1,"flex-grow-1","align-self-stretch"],[1,"row","g-0","h-100","fw-light","fst-italic",2,"font-size","12px","transition","background-color 0.3s"],["data-bs-parent","#accordionFlush",1,"accordion-collapse","collapse","bg-body-secondary","rounded",3,"id"],[1,"d-flex","align-items-center","p-1","gap-1","bg-body-tertiary"],[3,"recipe"],[3,"food","isOdd","focusWeight"],[1,"p-1","bg-body-tertiary","d-flex","gap-1"],["buttonIcon","pajamas:recipe","iconSize","24px",1,"btn","btn-outline-primary","btn-sm","opacity-60","flex-grow-1",3,"click","minWidthPx"],["buttonIcon","si:barcode-fill","iconSize","24px",1,"btn","btn-outline-success","btn-sm","opacity-50","flex-grow-1",3,"click","minWidthPx"],["buttonIcon","iconoir:lens-plus","iconSize","24px",1,"btn","btn-outline-success","btn-sm","opacity-80","flex-grow-1",3,"click","minWidthPx"],["buttonIcon","iconoir:notes","iconSize","16px",1,"btn","btn-outline-secondary",3,"click"],["type","text",1,"form-control","form-control-sm","shadow-none","text-center","bg-dark-subtle",3,"input","value"],[3,"updateFoodWeight","removeRecipe","removeFood","recipe"],[3,"removeFood","updateFoodWeight","food","isOdd","focusWeight"],["rows","3","placeholder","Meal note",1,"form-control","form-control-sm","text-center",3,"input","value"],["rows","3","placeholder","Day note",1,"form-control","form-control-sm","text-center",3,"input","value"]],template:function(e,t){if(e&1){let o=v();d(0,"div",3)(1,"div",4),l(2),Ee(3,"date"),s(),d(4,"weekdays",5),R("selectedDateChange",function(p){return m(o),V(t.selectedDate,p)||(t.selectedDate=p),g(p)}),s(),_(5,"div",6),d(6,"div",7)(7,"div",8)(8,"button",9),y("click",function(){m(o);let p=Se(44);return g(t.toggleEditDayNoteDialog(p))}),_(9,"iconify",10),s(),d(10,"div",11)(11,"button",12),y("click",function(){return m(o),g(t.diaryLogService.subtractDayWater(t.selectedDayJs().toISOString(),100))}),_(12,"iconify",13)(13,"iconify",14),s(),d(14,"div",15),S(15,Mt,1,1)(16,Ct,1,0),s(),d(17,"button",12),y("click",function(){return m(o),g(t.diaryLogService.addDayWater(t.selectedDayJs().toISOString(),100))}),_(18,"iconify",16)(19,"iconify",14),s()()(),d(20,"div",17)(21,"div",18),l(22,"P"),s(),d(23,"div",18),l(24,"C"),s(),d(25,"div",18),l(26,"Fa"),s(),d(27,"div",18),l(28,"Fi"),s(),d(29,"div",18),l(30,"KCal"),s(),d(31,"div",18),l(32,"G"),s()()(),_(33,"div",6),d(34,"div",19),T(35,Et,33,23,"div",20,F),s(),_(37,"total-row",21)(38,"macros-widget",22)(39,"weight-in-widget",23)(40,"activity-widget",24),s(),De(41,Wt,1,1,"ng-template",null,0,xe)(43,kt,1,1,"ng-template",null,1,xe)}if(e&2){let o,r;a(),$(Te(15,Dt,!t.isTodaySelected(),t.isTodaySelected(),!t.isTodaySelected())),a(),u(" ",We(3,13,(o=t.selectedDayJs())==null?null:o.toISOString())," "),a(2),N("selectedDate",t.selectedDate),a(4),z("btn-outline-info",t.diaryLogService.getDayNote(t.selectedDayJs().toISOString())),a(7),M((r=t.diaryLogService.getDayWater(t.selectedDayJs().toISOString()))?15:16,r),a(20),I(t.dayTemplateService.getDayTemplate().entries),a(2),f("stats",t.getDayStats())("fixedDecimals",0),a(),f("isoDate",t.selectedDayJs().toISOString())("stats",t.getDayStats()),a(),f("isoDate",t.selectedDayJs().toISOString()),a(),f("isoDate",t.selectedDayJs().toISOString())}},dependencies:[O,Pe,B,X,le,Z,pe,ge,A,ue,fe,Ve],encapsulation:2})};export{tt as Diary};

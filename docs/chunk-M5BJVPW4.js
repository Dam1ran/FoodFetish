import{d as S,g as v,h as g,p as x}from"./chunk-7CSXQSLL.js";import{a as m}from"./chunk-7QS2YA2B.js";import{X as b,a as c,qa as T}from"./chunk-CKWOGJJW.js";var h=(t=>(t[t.None=0]="None",t[t.MealOne=1]="MealOne",t[t.MealTwo=2]="MealTwo",t[t.MealThree=3]="MealThree",t[t.MealFour=4]="MealFour",t[t.Snacks=5]="Snacks",t))(h||{}),w={0:"None",1:"Meal I",2:"Meal II",3:"Meal III",4:"Meal IV",5:"Snacks"};var D=class{diaryDays=[]};var l=class{entries=[]},u=class{constructor(s=0,i=new g,r=[]){this.position=s;this.meal=i;this.recipes=r}};var f=class{constructor(s,i=new l){this.date=s;this.dayTemplate=i}};var E=class y{diaryLog=T(void 0);constructor(){this.setDiaryLog(),this.loadDiaryLog()}setDiaryLog(){if(!localStorage.getItem("diaryLog")){let i=new D;localStorage.setItem("diaryLog",JSON.stringify(i))}}loadDiaryLog(){this.diaryLog.set(JSON.parse(localStorage.getItem("diaryLog")))}getRespectiveMeal(s,i){return this.diaryLog()?.diaryDays.find(r=>r.date===s)?.dayTemplate.entries.find(r=>r.position===i)?.meal}getRespectiveRecipes(s,i){return this.diaryLog()?.diaryDays.find(r=>r.date===s)?.dayTemplate.entries.find(r=>r.position===i)?.recipes}addFood(s,i,r){r=c({},r),i=Number(i),this.diaryLog.update(o=>{let n=c({},o),t=n.diaryDays.find(a=>a.date===s);if(!t){let a=new f(s,new l);n.diaryDays.push(a),t=a}let e=t.dayTemplate.entries.find(a=>a.position===i);return e?e.meal.foods.push(r):(e=new u(i,new g(m(),w[i],[r]),[]),t.dayTemplate.entries.push(e)),n}),this.saveDiaryLog()}saveDiaryLog(){localStorage.setItem("diaryLog",JSON.stringify(this.diaryLog(),(s,i)=>s==="position"&&typeof i=="string"?h[i]:i))}updateMealName(s,i,r){this.diaryLog.update(o=>{let n=c({},o),t=n.diaryDays.find(a=>a.date===s);if(!t)return o;let e=t.dayTemplate.entries.find(a=>a.position===i);return e?(e.meal.name=r,n):o}),this.saveDiaryLog()}removeFood(s,i,r){this.diaryLog.update(o=>{let n=c({},o),t=n.diaryDays.find(a=>a.date===s);if(!t)return o;let e=t.dayTemplate.entries.find(a=>a.position===i);return e?(e.meal.foods=e.meal.foods.filter((a,d)=>d!==r),n):o}),this.saveDiaryLog()}removeRecipeFromPosition(s,i,r){this.diaryLog.update(o=>{let n=c({},o),t=n.diaryDays.find(a=>a.date===s);if(!t)return o;let e=t.dayTemplate.entries.find(a=>a.position===i);return e?(e.recipes=e.recipes.filter((a,d)=>d!==r),n):o}),this.saveDiaryLog()}updateRecipeFoodWeight(s,i,r,o,n){this.diaryLog.update(t=>{let e=c({},t),a=e.diaryDays.find(M=>M.date===s);if(!a)return t;let d=a.dayTemplate.entries.find(M=>M.position===i);if(!d)return t;let p=d.recipes?.[r];if(!p)return t;let L=p.foods?.[o];return L?(L.weight=Number(n),e):t}),this.saveDiaryLog()}clearMeal(s,i){this.diaryLog.update(r=>{let o=c({},r),n=o.diaryDays.find(e=>e.date===s);return!n||!n.dayTemplate.entries.find(e=>e.position===i)?r:(n.dayTemplate.entries=n.dayTemplate.entries.filter(e=>e.position!==i),o)}),this.saveDiaryLog()}updateFoodWeight(s,i,r,o){this.diaryLog.update(n=>{let t=c({},n),e=t.diaryDays.find(d=>d.date===s);if(!e)return n;let a=e.dayTemplate.entries.find(d=>d.position===i);return a?(a.meal.foods[r].weight=Number(o),t):n}),this.saveDiaryLog()}getDayStats(s){let i=this.diaryLog()?.diaryDays.find(o=>o.date===s),r=new v;if(!i)return r;for(let o of i.dayTemplate.entries){let n=[...o.meal.foods,...o.recipes.flatMap(t=>t.foods)];r.proteins+=n.reduce((t,e)=>t+e.protein*e.weight*.01,0),r.carbs+=n.reduce((t,e)=>t+e.carbs*e.weight*.01,0),r.fats+=n.reduce((t,e)=>t+e.fats*e.weight*.01,0),r.fiber+=n.reduce((t,e)=>t+e.fiber*e.weight*.01,0),r.calories+=n.reduce((t,e)=>t+e.calories*e.weight*.01,0),r.weight+=n.reduce((t,e)=>t+e.weight,0)}return r}getPositionStats(s,i){let r=this.diaryLog()?.diaryDays.find(e=>e.date===s),o=new v;if(!r)return o;let n=r.dayTemplate.entries.find(e=>e.position===i);if(!n)return o;let t=[...n.meal.foods,...n.recipes.flatMap(e=>e.foods)];return{proteins:t.reduce((e,a)=>e+a.protein*a.weight*.01,0),carbs:t.reduce((e,a)=>e+a.carbs*a.weight*.01,0),fats:t.reduce((e,a)=>e+a.fats*a.weight*.01,0),fiber:t.reduce((e,a)=>e+a.fiber*a.weight*.01,0),calories:t.reduce((e,a)=>e+a.calories*a.weight*.01,0),weight:t.reduce((e,a)=>e+a.weight,0)}}updateMealNote(s,i,r){this.diaryLog.update(o=>{let n=c({},o),t=n.diaryDays.find(a=>a.date===s);if(!t)return o;let e=t.dayTemplate.entries.find(a=>a.meal.id===i);return e?(e.meal.note=r,n):o}),this.saveDiaryLog()}getExpandedMeal(){let s=localStorage.getItem("expandedMeal");return s?JSON.parse(s):null}toggleExpandedMeal(s,i){let r=this.getExpandedMeal();localStorage.setItem("expandedMeal",JSON.stringify({isoDate:r?.isoDate===s&&r?.mealPosition===i?"":s,mealPosition:r?.isoDate===s&&r?.mealPosition===i?0:i}))}expandMeal(s,i){localStorage.setItem("expandedMeal",JSON.stringify({isoDate:s,mealPosition:i}))}addRecipe(s,i,r,o){this.diaryLog.update(n=>{let t=c({},n),e=t.diaryDays.find(p=>p.date===s);if(!e){let p=new f(s,new l);t.diaryDays.push(p),e=p}let a=e.dayTemplate.entries.find(p=>p.position===i),d=new x(m(),o.name,o.foods.map(p=>new S(p.id,p.name,p.macroCategory,p.protein,p.carbs,p.fats,p.fiber,p.calories,p.weight*(r/o.portions),p.note)),r,o.note);return a?a.recipes.push(d):(a=new u(i,new g(m(),w[i],[]),[d]),e.dayTemplate.entries.push(a)),t}),this.saveDiaryLog()}hasFoodOnDate(s){let i=this.diaryLog()?.diaryDays.find(r=>r.date===s);if(!i)return!1;for(let r of i.dayTemplate.entries)if(r.meal.foods.length>0||r.recipes.length>0)return!0;return!1}static \u0275fac=function(i){return new(i||y)};static \u0275prov=b({token:y,factory:y.\u0275fac,providedIn:"root"})};export{h as a,w as b,l as c,E as d};

import{d as E,g as W,i as B,l as A,o as q}from"./chunk-QY6R6ZC5.js";import{a as K}from"./chunk-2KTHP7SW.js";import{f as H,u as G}from"./chunk-KHSIFIAT.js";import{a as te}from"./chunk-P7OX43DN.js";import{a as z}from"./chunk-TTUD5ZDE.js";import{Ea as M,Fb as h,Hb as x,Qb as U,Xa as f,Yb as P,Zb as L,_b as j,aa as u,e as ee,fa as g,ga as p,jb as k,kb as N,pb as I,qb as c,qc as O,ra as _,rb as l,rc as R,sa as w,sb as b,uc as F,vc as V,yb as T}from"./chunk-HXGKTDM5.js";var D=ee(te()),Q=class n{static getStartOfToday(e=!0){return e?(0,D.default)().utc().startOf("day"):(0,D.default)().startOf("day")}static fromNgbDateStruct(e,t=!0){return n.getStartOfToday(t).set("year",e.year??0).set("month",(e.month??1)-1).set("date",e.day??1)}static toNgbDateStruct(e){let t=typeof e=="string"?(0,D.default)(e):e;return{year:t.year(),month:t.month()+1,day:t.date()}}};function ie(n,e){if(n&1&&b(0,"img",0),n&2){let t=x();I("src",t.imageDataUrl(),M)}}function re(n,e){n&1&&(c(0,"div",1),b(1,"iconify",2),l())}var X=class n{imageId=R.required();imageStoreService=u(K);imageDataUrl=_(null);diaryLogService=u(G);deleteChange=O();cdr=u(V);constructor(){w(()=>{let e=this.imageId();e?this.imageStoreService.get(e).then(t=>{this.imageDataUrl.set(t),t||(this.deleteChange.emit(e),this.cdr.detectChanges())}):this.imageDataUrl.set(null)})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=f({type:n,selectors:[["meal-thumb"]],inputs:{imageId:[1,"imageId"]},outputs:{deleteChange:"deleteChange"},decls:2,vars:1,consts:[["width","160","height","160","alt","meal thumb",2,"object-fit","cover",3,"src"],[1,"d-flex","justify-content-center","align-items-center",2,"width","160px","height","160px"],["icon","streamline:broken-link-2",1,"opacity-50"]],template:function(t,i){t&1&&k(0,ie,1,1,"img",0)(1,re,2,0,"div",1),t&2&&N(i.imageDataUrl()?0:1)},dependencies:[z],encapsulation:2})};function fe(n,e=320,t=320,i=.25){return new Promise((s,o)=>{let a=URL.createObjectURL(n),r=new Image;r.onload=()=>{let y=Math.max(e/r.naturalWidth,t/r.naturalHeight),v=r.naturalWidth*y,S=r.naturalHeight*y,Z=(e-v)/2,J=(t-S)/2,d=document.createElement("canvas");d.width=e,d.height=t,d.getContext("2d").drawImage(r,Z,J,v,S),d.toBlob(C=>{if(URL.revokeObjectURL(a),!C){o(new Error("Failed to create blob from canvas"));return}let m=new FileReader;m.onloadend=()=>{let $=m.result;s($.split(",")[1])},m.onerror=()=>o(new Error("Failed to read blob as base64")),m.readAsDataURL(C)},"image/jpeg",i)},r.onerror=()=>{URL.revokeObjectURL(a),o(new Error("Failed to load image"))},r.src=a})}var Y=class n{selectedDate=F();onDateSelected(e){}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=f({type:n,selectors:[["date-picker"]],inputs:{selectedDate:[1,"selectedDate"]},outputs:{selectedDate:"selectedDateChange"},decls:3,vars:1,consts:[["d","ngbDatepicker"],["name","dp","ngbDatepicker","","autofocus","false","tabindex","-1",1,"form-control","p-1",2,"position","absolute","opacity","0","pointer-events","none",3,"ngModelChange","dateSelect","ngModel"],["buttonIcon","fluent:calendar-20-regular",1,"btn","p-0","btn-sm","border-0",3,"click"]],template:function(t,i){if(t&1){let s=T();c(0,"input",1,0),j("ngModelChange",function(a){return g(s),L(i.selectedDate,a)||(i.selectedDate=a),p(a)}),h("dateSelect",function(a){return g(s),p(i.onDateSelected(a))}),l(),c(2,"button",2),h("click",function(){g(s);let a=U(1);return p(a.toggle())}),l()}t&2&&P("ngModel",i.selectedDate)},dependencies:[H,q,A,E,W,B],styles:["[_nghost-%COMP%]{position:relative}"]})};export{Y as a,Q as b,X as c,fe as d};

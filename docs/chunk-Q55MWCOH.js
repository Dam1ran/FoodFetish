import{a as G,b}from"./chunk-2NV76B7Q.js";import{a as A}from"./chunk-XKFIHP3N.js";import{Oa as W,Sa as N,Ta as k,X as w,Ya as P,a as p,aa as M,b as E,e as $,qc as S,ra as L,xa as O}from"./chunk-DAZPDLGM.js";var J=class d{foods=L([]);constructor(){this.loadFoods()}loadFoods(){let t=localStorage.getItem("foods");t?this.foods.set(JSON.parse(t)):this.foods.set([])}addEditFood(t){this.foods().find(n=>n.id===t.id)?this.foods.update(n=>n.map(r=>r.id===t.id?t:r)):this.foods.update(n=>[...n,E(p({},t),{id:t.id||b()})]),localStorage.setItem("foods",JSON.stringify(this.foods()))}deleteFood(t){this.foods.update(e=>e.filter(n=>n.id!==t.id)),localStorage.setItem("foods",JSON.stringify(this.foods()))}downloadFoods(){let t=JSON.stringify(this.foods()),e=new Blob([t],{type:"application/json"}),n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download="foods.json",r.click(),URL.revokeObjectURL(n)}setFoods(t){localStorage.setItem("foods",JSON.stringify(t)),this.loadFoods()}getFoodById(t){return this.foods().find(e=>e.id===t)}getFoodByBarcode(t){return this.foods().find(e=>e.barcode===t)}static \u0275fac=function(e){return new(e||d)};static \u0275prov=w({token:d,factory:d.\u0275fac,providedIn:"root"})};var U=(i=>(i[i.None=0]="None",i[i.Carbs=1]="Carbs",i[i.Proteins=2]="Proteins",i[i.Fats=3]="Fats",i[i.Vegetable=4]="Vegetable",i[i.Complex=5]="Complex",i[i.Other=6]="Other",i))(U||{}),ne={0:{bgColor:"#302010"},1:{bgColor:"#706030"},2:{bgColor:"#305090"},3:{bgColor:"#805040"},4:{bgColor:"#208040"},5:{bgColor:"#654070"},6:{bgColor:"#333355"}};var x=class{constructor(t="",e="",n=0,r=0,a=0,s=0,i=0,o=0,l=100,c="",m=""){this.id=t;this.name=e;this.macroCategory=n;this.protein=r;this.carbs=a;this.fats=s;this.fiber=i;this.calories=o;this.weight=l;this.barcode=c;this.note=m}};function B(d){return d&&typeof d=="object"&&typeof d.id=="string"&&typeof d.name=="string"&&typeof d.macroCategory=="number"&&typeof d.protein=="number"&&typeof d.carbs=="number"&&typeof d.fats=="number"&&typeof d.fiber=="number"&&typeof d.calories=="number"&&typeof d.weight=="number"&&(!d.barcode||typeof d.barcode=="string")&&typeof d.note=="string"}var z=class d{vcr=M(k);renderer=M(W);elementRef=M(O);buttonIcon=S.required();minWidthPx=S(120);iconSize=S("32px");ngAfterViewInit(){this.renderer.setAttribute(this.elementRef.nativeElement,"type","button"),this.renderer.addClass(this.elementRef.nativeElement,"d-flex"),this.renderer.addClass(this.elementRef.nativeElement,"justify-content-between"),this.renderer.addClass(this.elementRef.nativeElement,"align-items-center"),this.renderer.addClass(this.elementRef.nativeElement,"align-content-center"),this.renderer.addClass(this.elementRef.nativeElement,"flex-shrink-0"),this.renderer.addClass(this.elementRef.nativeElement,"gap-2"),this.renderer.setStyle(this.elementRef.nativeElement,"white-space","nowrap"),this.renderer.setStyle(this.elementRef.nativeElement,"padding","0.125rem 0.5rem");let t=this.vcr.createComponent(A,{bindings:[N("icon",this.buttonIcon),N("size",this.iconSize)]});this.elementRef.nativeElement.childNodes?.[0]?.textContent?.trim()?(this.renderer.setStyle(this.elementRef.nativeElement,"min-width",`${this.minWidthPx()}px`),this.renderer.setStyle(this.elementRef.nativeElement,"padding","0.125rem 0.5rem")):this.renderer.setStyle(this.elementRef.nativeElement,"padding","0.125rem"),this.renderer.appendChild(this.elementRef.nativeElement,t.location.nativeElement)}static \u0275fac=function(e){return new(e||d)};static \u0275dir=P({type:d,selectors:[["","buttonIcon",""]],inputs:{buttonIcon:[1,"buttonIcon"],minWidthPx:[1,"minWidthPx"],iconSize:[1,"iconSize"]}})};var C=(o=>(o[o.None=0]="None",o[o.MealOne=1]="MealOne",o[o.MealTwo=2]="MealTwo",o[o.MealThree=3]="MealThree",o[o.MealFour=4]="MealFour",o[o.MealFive=5]="MealFive",o[o.MealSix=6]="MealSix",o[o.Snacks=7]="Snacks",o))(C||{}),I={0:"None",1:"Meal I",2:"Meal II",3:"Meal III",4:"Meal IV",5:"Meal V",6:"Meal VI",7:"Snacks"};var h=class{constructor(t=0,e=0,n=0,r=0,a=0,s=0){this.proteins=t;this.carbs=e;this.fats=n;this.fiber=r;this.calories=a;this.weight=s}};var g=class{constructor(t="",e="",n=[],r="",a){this.id=t;this.name=e;this.foods=n;this.note=r;this.time=a}};function H(d){return d?.foods?.length?d.foods.reduce((t,e)=>t+e.protein*e.weight*.01,0):0}function K(d){return d?.foods?.length?d.foods.reduce((t,e)=>t+e.carbs*e.weight*.01,0):0}function Q(d){return d?.foods?.length?d.foods.reduce((t,e)=>t+e.fats*e.weight*.01,0):0}function X(d){return d?.foods?.length?d.foods.reduce((t,e)=>t+e.fiber*e.weight*.01,0):0}function Y(d){return d?.foods?.length?d.foods.reduce((t,e)=>t+e.calories*e.weight*.01,0):0}function Z(d){return d?.foods?.length?d.foods.reduce((t,e)=>t+e.weight,0):0}function me(d){return new h(H(d),K(d),Q(d),X(d),Y(d),Z(d))}var T=class extends g{constructor(e="",n="",r=[],a=1,s=""){super(e,n,r,s);this.portions=a}};function we(d){return d&&typeof d=="object"&&typeof d.id=="string"&&typeof d.name=="string"&&typeof d.portions=="number"&&typeof d.note=="string"&&Array.isArray(d.foods)&&d.foods.every(t=>B(t))}var u=$(G());var R=class{diaryDays=[]};var y=class{entries=[];weight;note;waterMl;activities=[]},D=class{constructor(t=0,e=new g,n=[]){this.position=t;this.meal=e;this.recipes=n}};var f=class{constructor(t,e=new y){this.date=t;this.dayTemplate=e}};var F=class{constructor(t,e=0,n=15,r){this.time=t;this.type=e;this.durationMinutes=n;this.note=r}},j=(i=>(i[i.None=0]="None",i[i.Walk=1]="Walk",i[i.Aerobics=2]="Aerobics",i[i.Cardio=3]="Cardio",i[i.Sports=4]="Sports",i[i.Workout=5]="Workout",i[i.Other=6]="Other",i))(j||{}),Fe={0:{icon:"fluent:border-none-24-filled"},1:{icon:"fa-solid:walking"},2:{icon:"icon-park-solid:sport"},3:{icon:"tabler:run"},4:{icon:"icon-park-solid:sporting"},5:{icon:"streamline-plump:dumbell-solid"},6:{icon:"hugeicons:activity-01"}};var q=class d{diaryLog=L(void 0);constructor(){this.setDiaryLog(),this.loadDiaryLog()}setDiaryLog(){if(!localStorage.getItem("diaryLog")){let e=new R;localStorage.setItem("diaryLog",JSON.stringify(e))}}loadDiaryLog(){this.diaryLog.set(JSON.parse(localStorage.getItem("diaryLog")))}getRespectiveDayTemplate(t){return this.diaryLog()?.diaryDays.find(e=>e.date===t)?.dayTemplate}getRespectiveMeal(t,e){return this.getRespectiveDayTemplate(t)?.entries.find(n=>n.position===e)?.meal}updateMealTime(t,e){e=Number(e),this.diaryLog.update(n=>{let r=p({},n),a=r.diaryDays.find(o=>o.date===t);if(!a)return n;let s=a.dayTemplate.entries.find(o=>o.position===e);if(!s)return n;let i=(0,u.default)();return s.meal.time={hour:i.hour(),minute:i.minute(),second:0},r}),this.saveDiaryLog()}getRespectiveRecipes(t,e){return this.diaryLog()?.diaryDays.find(n=>n.date===t)?.dayTemplate.entries.find(n=>n.position===e)?.recipes}addFood(t,e,n){n=p({},n),e=Number(e),this.diaryLog.update(r=>{let a=p({},r),s=a.diaryDays.find(o=>o.date===t);if(!s){let o=new f(t,new y);a.diaryDays.push(o),s=o}let i=s.dayTemplate.entries.find(o=>o.position===e);return i?i.meal.foods.push(n):(i=new D(e,new g(b(),I[e],[n]),[]),s.dayTemplate.entries.push(i)),a}),this.saveDiaryLog()}saveDiaryLog(){localStorage.setItem("diaryLog",JSON.stringify(this.diaryLog(),(t,e)=>t==="position"&&typeof e=="string"?C[e]:e))}updateMealName(t,e,n){this.diaryLog.update(r=>{let a=p({},r),s=a.diaryDays.find(o=>o.date===t);if(!s)return r;let i=s.dayTemplate.entries.find(o=>o.position===e);return i?(i.meal.name=n,a):r}),this.saveDiaryLog()}removeFood(t,e,n){this.diaryLog.update(r=>{let a=p({},r),s=a.diaryDays.find(o=>o.date===t);if(!s)return r;let i=s.dayTemplate.entries.find(o=>o.position===e);return i?(i.meal.foods=i.meal.foods.filter((o,l)=>l!==n),a):r}),this.saveDiaryLog()}removeRecipeFromPosition(t,e,n){this.diaryLog.update(r=>{let a=p({},r),s=a.diaryDays.find(o=>o.date===t);if(!s)return r;let i=s.dayTemplate.entries.find(o=>o.position===e);return i?(i.recipes=i.recipes.filter((o,l)=>l!==n),a):r}),this.saveDiaryLog()}updateRecipeFoodWeight(t,e,n,r,a){this.diaryLog.update(s=>{let i=p({},s),o=i.diaryDays.find(v=>v.date===t);if(!o)return s;let l=o.dayTemplate.entries.find(v=>v.position===e);if(!l)return s;let c=l.recipes?.[n];if(!c)return s;let m=c.foods?.[r];return m?(m.weight=Number(a),i):s}),this.saveDiaryLog()}removeFoodFromRecipe(t,e,n,r){this.diaryLog.update(a=>{let s=p({},a),i=s.diaryDays.find(m=>m.date===t);if(!i)return a;let o=i.dayTemplate.entries.find(m=>m.position===e);if(!o)return a;let l=o.recipes?.[n];return!l||!l.foods?.[r]?a:(l.foods=l.foods.filter((m,v)=>v!==r),s)}),this.saveDiaryLog()}clearMeal(t,e){this.diaryLog.update(n=>{let r=p({},n),a=r.diaryDays.find(i=>i.date===t);return!a||!a.dayTemplate.entries.find(i=>i.position===e)?n:(a.dayTemplate.entries=a.dayTemplate.entries.filter(i=>i.position!==e),r)}),this.saveDiaryLog()}updateFoodWeight(t,e,n,r){this.diaryLog.update(a=>{let s=p({},a),i=s.diaryDays.find(l=>l.date===t);if(!i)return a;let o=i.dayTemplate.entries.find(l=>l.position===e);return o?(o.meal.foods[n].weight=Number(r),s):a}),this.saveDiaryLog()}getDayStats(t){let e=this.diaryLog()?.diaryDays.find(r=>r.date===t),n=new h;if(!e)return n;for(let r of e.dayTemplate.entries){let a=[...r.meal.foods,...r.recipes.flatMap(s=>s.foods)];n.proteins+=a.reduce((s,i)=>s+i.protein*i.weight*.01,0),n.carbs+=a.reduce((s,i)=>s+i.carbs*i.weight*.01,0),n.fats+=a.reduce((s,i)=>s+i.fats*i.weight*.01,0),n.fiber+=a.reduce((s,i)=>s+i.fiber*i.weight*.01,0),n.calories+=a.reduce((s,i)=>s+i.calories*i.weight*.01,0),n.weight+=a.reduce((s,i)=>s+i.weight,0)}return n}getDayNote(t){return this.diaryLog()?.diaryDays?.find(e=>e.date===t)?.dayTemplate?.note??null}updateDayNote(t,e){this.diaryLog.update(n=>{let r=p({},n),a=r.diaryDays.find(s=>s.date===t);if(!a){let s=new f(t,new y);r.diaryDays.push(s),a=s}return a.dayTemplate.note=e,r}),this.saveDiaryLog()}getDayWater(t){return this.diaryLog()?.diaryDays?.find(e=>e.date===t)?.dayTemplate?.waterMl??null}updateDayWater(t,e){this.diaryLog.update(n=>{let r=p({},n),a=r.diaryDays.find(s=>s.date===t);if(!a){let s=new f(t,new y);r.diaryDays.push(s),a=s}return e?a.dayTemplate.waterMl=Number(e):delete a.dayTemplate.waterMl,r}),this.saveDiaryLog()}addDayWater(t,e){this.updateDayWater(t,(this.getDayWater(t)+e).toString())}subtractDayWater(t,e){let n=this.getDayWater(t);n<=e?this.updateDayWater(t,""):this.updateDayWater(t,(n-e).toString())}getPositionStats(t,e){let n=this.diaryLog()?.diaryDays.find(i=>i.date===t),r=new h;if(!n)return r;let a=n.dayTemplate.entries.find(i=>i.position===e);if(!a)return r;let s=[...a.meal.foods,...a.recipes.flatMap(i=>i.foods)];return{proteins:s.reduce((i,o)=>i+o.protein*o.weight*.01,0),carbs:s.reduce((i,o)=>i+o.carbs*o.weight*.01,0),fats:s.reduce((i,o)=>i+o.fats*o.weight*.01,0),fiber:s.reduce((i,o)=>i+o.fiber*o.weight*.01,0),calories:s.reduce((i,o)=>i+o.calories*o.weight*.01,0),weight:s.reduce((i,o)=>i+o.weight,0)}}updateMealNote(t,e,n){this.diaryLog.update(r=>{let a=p({},r),s=a.diaryDays.find(o=>o.date===t);if(!s)return r;let i=s.dayTemplate.entries.find(o=>o.meal.id===e);return i?(i.meal.note=n,a):r}),this.saveDiaryLog()}getExpandedMeal(){let t=localStorage.getItem("expandedMeal");return t?JSON.parse(t):null}toggleExpandedMeal(t,e){let n=this.getExpandedMeal();localStorage.setItem("expandedMeal",JSON.stringify({isoDate:n?.isoDate===t&&n?.mealPosition===e?"":t,mealPosition:n?.isoDate===t&&n?.mealPosition===e?0:e}))}expandMeal(t,e){localStorage.setItem("expandedMeal",JSON.stringify({isoDate:t,mealPosition:e}))}addRecipe(t,e,n,r){this.diaryLog.update(a=>{let s=p({},a),i=s.diaryDays.find(c=>c.date===t);if(!i){let c=new f(t,new y);s.diaryDays.push(c),i=c}let o=i.dayTemplate.entries.find(c=>c.position===e),l=new T(b(),r.name,r.foods.map(c=>new x(c.id,c.name,c.macroCategory,c.protein,c.carbs,c.fats,c.fiber,c.calories,c.weight*(n/r.portions),c.note)),n,r.note);return o?o.recipes.push(l):(o=new D(e,new g(b(),I[e],[]),[l]),i.dayTemplate.entries.push(o)),s}),this.saveDiaryLog()}hasFoodOnDate(t){let e=this.diaryLog()?.diaryDays.find(n=>n.date===t);if(!e)return!1;for(let n of e.dayTemplate.entries)if(n.meal.foods.length>0||n.recipes.length>0)return!0;return!1}hasWeightInOnDate(t){return!!this.diaryLog()?.diaryDays.find(e=>e.date===t)?.dayTemplate?.weight}hasWaterOnDate(t){return!!this.diaryLog()?.diaryDays.find(e=>e.date===t)?.dayTemplate?.waterMl}hasActivitiesOnDate(t){return!!this.diaryLog()?.diaryDays.find(e=>e.date===t)?.dayTemplate?.activities?.some(e=>!!e.durationMinutes&&e.type!==0)}getCurrentWeight(t){let e=this.diaryLog()?.diaryDays.find(n=>n.date===t);return e?e.dayTemplate.weight??null:null}updateCurrentWeight(t,e){this.diaryLog.update(n=>{let r=p({},n),a=r.diaryDays.find(s=>s.date===t);if(!a){let s=new f(t,new y);r.diaryDays.push(s),a=s}return e?a.dayTemplate.weight=Number(e):delete a.dayTemplate.weight,r}),this.saveDiaryLog()}getWeightByFormula(t,e){let n=(0,u.default)(t).utc().startOf("day"),r=[];for(let s=0;s<e;s++){let i=n.subtract(s,"day").toISOString(),o=this.getCurrentWeight(i);o&&r.push(o)}if(!r.length)return 0;if(r.sort(),r.length<=3)return r.reduce((s,i)=>s+i,0)/r.length;let a=Math.floor(r.length/2);return r.length%2===0?(r[a-1]+r[a])/2:(r[a-1]+r[a]+r[a+1])/3}getWeights(t,e){let n=u.default.min((0,u.default)(t).utc().startOf("day"),(0,u.default)().utc().startOf("day")),r=[],a=0;for(let s=0;s<e;s++){let i=n.subtract(s,"day").toISOString();a=this.getCurrentWeight(i),a&&r.push(a)}return r.reverse(),r}getCalorie(t){return this.getDayStats(t).calories}getCalories(t,e){let n=u.default.min((0,u.default)(t).utc().startOf("day"),(0,u.default)().utc().startOf("day")),r=[],a=0;for(let s=0;s<e;s++){let i=n.subtract(s,"day").toISOString();a=this.getCalorie(i),a&&r.push(a)}return r.reverse(),r}getActivities(t){return this.diaryLog()?.diaryDays.find(e=>e.date===t)?.dayTemplate.activities??[]}addActivity(t){this.diaryLog.update(e=>{let n=p({},e),r=n.diaryDays.find(o=>o.date===t);if(!r){let o=new f(t,new y);n.diaryDays.push(o),r=o}let a=r.dayTemplate.activities,s=(0,u.default)(),i=new F({hour:s.hour(),minute:s.minute(),second:0});return a?.length?a.push(i):r.dayTemplate.activities=[i],n}),this.saveDiaryLog()}removeActivity(t,e){this.diaryLog.update(n=>{let r=p({},n),a=r.diaryDays.find(s=>s.date===t);return a?(a.dayTemplate.activities=a.dayTemplate.activities.filter((s,i)=>i!==e),r):n}),this.saveDiaryLog()}setActivityType(t,e,n){this.diaryLog.update(r=>{let a=p({},r),s=a.diaryDays.find(i=>i.date===t);return s?(s.dayTemplate.activities[e].type=n,a):r}),this.saveDiaryLog()}downloadDiary(){let t=JSON.stringify(this.diaryLog()),e=new Blob([t],{type:"application/json"}),n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download="diary.json",r.click(),URL.revokeObjectURL(n)}setDiary(t){localStorage.setItem("diaryLog",JSON.stringify(t)),this.loadDiaryLog()}static \u0275fac=function(e){return new(e||d)};static \u0275prov=w({token:d,factory:d.\u0275fac,providedIn:"root"})};export{J as a,U as b,ne as c,x as d,B as e,z as f,C as g,I as h,g as i,H as j,K as k,Q as l,X as m,Y as n,Z as o,me as p,y as q,T as r,we as s,j as t,Fe as u,q as v};

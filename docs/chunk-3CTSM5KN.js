import{d as q,g as z,i as H,l as G,o as K}from"./chunk-MNQVDAGX.js";import{a as Z}from"./chunk-2KTHP7SW.js";import{f as X,u as Y}from"./chunk-KHSIFIAT.js";import{a as ie}from"./chunk-P7OX43DN.js";import{a as Q}from"./chunk-TTUD5ZDE.js";import{Ea as N,Fb as b,Ga as k,Hb as P,Qb as j,Tb as L,Xa as f,Yb as F,Zb as O,_b as R,aa as u,e as ae,fa as g,fc as E,ga as p,jb as x,kb as I,pb as T,qb as s,qc as V,ra as M,rb as c,rc as y,sa as w,sb as D,uc as W,vc as A,xc as B,yb as U}from"./chunk-HXGKTDM5.js";var h=ae(ie()),J=class n{static getStartOfToday(t=!0){return t?(0,h.default)().utc().startOf("day"):(0,h.default)().startOf("day")}static fromNgbDateStruct(t,e=!0){return n.getStartOfToday(e).set("year",t.year??0).set("month",(t.month??1)-1).set("date",t.day??1)}static toNgbDateStruct(t){let e=typeof t=="string"?(0,h.default)(t):t;return{year:e.year(),month:e.month()+1,day:e.date()}}};var ce=(n,t)=>({filter:n,opacity:t});function le(n,t){if(n&1&&(s(0,"div",0),D(1,"img",2),c()),n&2){let e=P();k(),L(E(5,ce,e.stretched()?"blur(4px) grayscale(25%)":"unset",e.stretched()?.2:1)),T("width",e.stretched()?320:160)("height",(e.stretched(),160))("src",e.imageDataUrl(),N)}}function de(n,t){n&1&&(s(0,"div",1),D(1,"iconify",3),c())}var $=class n{imageId=y.required();stretched=y(!1,{transform:B});imageStoreService=u(Z);imageDataUrl=M(null);diaryLogService=u(Y);deleteChange=V();cdr=u(A);constructor(){w(()=>{let t=this.imageId();t?this.imageStoreService.get(t).then(e=>{this.imageDataUrl.set(e),e||(this.deleteChange.emit(t),this.cdr.detectChanges())}):this.imageDataUrl.set(null)})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=f({type:n,selectors:[["meal-thumb"]],inputs:{imageId:[1,"imageId"],stretched:[1,"stretched"]},outputs:{deleteChange:"deleteChange"},decls:2,vars:1,consts:[[1,"d-flex","justify-content-center"],[1,"d-flex","justify-content-center","align-items-center",2,"width","160px","height","160px"],["alt","meal thumb",2,"object-fit","cover",3,"width","height","src"],["icon","streamline:broken-link-2",1,"opacity-50"]],template:function(e,a){e&1&&x(0,le,2,8,"div",0)(1,de,2,0,"div",1),e&2&&I(a.imageDataUrl()?0:1)},dependencies:[Q],encapsulation:2})};function ve(n,t=320,e=320,a=.25){return new Promise((l,o)=>{let r=URL.createObjectURL(n),i=new Image;i.onload=()=>{let v=Math.max(t/i.naturalWidth,e/i.naturalHeight),S=i.naturalWidth*v,_=i.naturalHeight*v,te=(t-S)/2,ne=(e-_)/2,d=document.createElement("canvas");d.width=t,d.height=e,d.getContext("2d").drawImage(i,te,ne,S,_),d.toBlob(C=>{if(URL.revokeObjectURL(r),!C){o(new Error("Failed to create blob from canvas"));return}let m=new FileReader;m.onloadend=()=>{let re=m.result;l(re.split(",")[1])},m.onerror=()=>o(new Error("Failed to read blob as base64")),m.readAsDataURL(C)},"image/jpeg",a)},i.onerror=()=>{URL.revokeObjectURL(r),o(new Error("Failed to load image"))},i.src=r})}var ee=class n{selectedDate=W();onDateSelected(t){}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=f({type:n,selectors:[["date-picker"]],inputs:{selectedDate:[1,"selectedDate"]},outputs:{selectedDate:"selectedDateChange"},decls:3,vars:1,consts:[["d","ngbDatepicker"],["name","dp","ngbDatepicker","","autofocus","false","tabindex","-1",1,"form-control","p-1",2,"position","absolute","opacity","0","pointer-events","none",3,"ngModelChange","dateSelect","ngModel"],["buttonIcon","fluent:calendar-20-regular",1,"btn","p-0","btn-sm","border-0",3,"click"]],template:function(e,a){if(e&1){let l=U();s(0,"input",1,0),R("ngModelChange",function(r){return g(l),O(a.selectedDate,r)||(a.selectedDate=r),p(r)}),b("dateSelect",function(r){return g(l),p(a.onDateSelected(r))}),c(),s(2,"button",2),b("click",function(){g(l);let r=j(1);return p(r.toggle())}),c()}e&2&&F("ngModel",a.selectedDate)},dependencies:[X,K,G,q,z,H],styles:["[_nghost-%COMP%]{position:relative}"]})};export{ee as a,J as b,$ as c,ve as d};

import{c as p}from"./chunk-PXXMBKHJ.js";import{X as m,e as u}from"./chunk-HXGKTDM5.js";var c=u(p()),b=class n{static getStartOfToday(t=!0){return t?(0,c.default)().utc().startOf("day"):(0,c.default)().startOf("day")}static fromNgbDateStruct(t,e=!0){return n.getStartOfToday(e).set("year",t.year??0).set("month",(t.month??1)-1).set("date",t.day??1)}static toNgbDateStruct(t){let e=typeof t=="string"?(0,c.default)(t):t;return{year:e.year(),month:e.month()+1,day:e.date()}}};var h=class n{dbName="food-fetish-images-db";storeName="images";dbVersion=1;cache=new Map;openDb(){return new Promise((t,e)=>{let r=indexedDB.open(this.dbName,this.dbVersion);r.onupgradeneeded=()=>{let s=r.result;s.objectStoreNames.contains(this.storeName)||s.createObjectStore(this.storeName,{keyPath:"imageId"})},r.onsuccess=()=>t(r.result),r.onerror=()=>e(r.error)})}async put(t,e){let r=await this.openDb();return new Promise((s,o)=>{let i=r.transaction(this.storeName,"readwrite"),a=`data:image/jpeg;base64,${e}`;i.objectStore(this.storeName).put({imageId:t,base64:a}),i.oncomplete=()=>{this.cache.set(t,a),s(a)},i.onerror=()=>o(i.error)})}async get(t){let e=this.cache.get(t);if(e!==void 0)return e;let r=await this.openDb();return new Promise((s,o)=>{let a=r.transaction(this.storeName,"readonly").objectStore(this.storeName).get(t);a.onsuccess=()=>{let d=a.result;d?(this.cache.set(t,d.base64),s(d.base64)):s(null)},a.onerror=()=>o(a.error)})}async deleteDatabase(){this.cache.clear();let e=(await this.openDb()).transaction(this.storeName,"readwrite");e.objectStore(this.storeName).clear(),await new Promise(r=>{e.oncomplete=()=>r(void 0)})}async delete(t){let e=await this.openDb();return new Promise((r,s)=>{let o=e.transaction(this.storeName,"readwrite");o.objectStore(this.storeName).delete(t),o.oncomplete=()=>{this.cache.delete(t),r()},o.onerror=()=>s(o.error)})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})};export{b as a,h as b};

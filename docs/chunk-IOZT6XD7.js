import{b as g,q as l}from"./chunk-ULHKVDUS.js";import{a as h}from"./chunk-7QS2YA2B.js";import{X as c,a,aa as f,b as r,ra as m}from"./chunk-IEPN4JXQ.js";var R=class n{foodsService=f(g);recipes=m([]);constructor(){this.loadRecipes()}loadRecipes(){let s=localStorage.getItem("recipes");s?this.recipes.set(JSON.parse(s)):this.recipes.set([])}saveRecipes(){localStorage.setItem("recipes",JSON.stringify(this.recipes()))}setRecipes(s){localStorage.setItem("recipes",JSON.stringify(s)),this.loadRecipes()}downloadRecipes(){let s=JSON.stringify(this.recipes()),i=new Blob([s],{type:"application/json"}),t=URL.createObjectURL(i),e=document.createElement("a");e.href=t,e.download="recipes.json",e.click(),URL.revokeObjectURL(t)}addRecipe(){this.recipes.update(s=>[new l(h(),"Empty recipe"),...s]),this.saveRecipes()}updateRecipeName(s,i){this.recipes.update(t=>t.map(e=>e.id===s?r(a({},e),{name:i}):e)),this.saveRecipes()}updateRecipeNote(s,i){this.recipes.update(t=>t.map(e=>e.id===s?r(a({},e),{note:i}):e)),this.saveRecipes()}addFood(s,i){this.recipes.update(t=>t.map(e=>{if(e.id===s){let o=this.foodsService.getFoodById(i);if(o)return r(a({},e),{foods:[...e.foods,a({},o)]})}return e})),this.saveRecipes()}updateFoodWeight(s,i,t){this.recipes.update(e=>e.map(o=>o.id===s?r(a({},o),{foods:o.foods.map((d,p)=>p===i?r(a({},d),{weight:+t}):d)}):o)),this.saveRecipes()}updateRecipePortions(s,i){this.recipes.update(t=>t.map(e=>e.id===s?r(a({},e),{portions:+i}):e)),this.saveRecipes()}removeFood(s,i){this.recipes.update(t=>t.map(e=>e.id===s?r(a({},e),{foods:e.foods.filter((o,d)=>d!==i)}):e)),this.recipes().find(t=>t.id===s&&t.foods.length===0)&&this.recipes.update(t=>t.filter(e=>e.id!==s)),this.saveRecipes()}changeFoodOrder(s,i,t){this.recipes.update(e=>e.map(o=>o.id===s?r(a({},o),{foods:o.foods.map((d,p)=>p===i?o.foods[t]:p===t?o.foods[i]:o.foods[p])}):o)),this.saveRecipes()}getRecipeById(s){return this.recipes().find(i=>i.id===s)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=c({token:n,factory:n.\u0275fac,providedIn:"root"})};export{R as a};

<div
  class="content-wrapper d-flex justify-content-between gap-2 p-1 bg-body-tertiary border-bottom"
>
  <button
    type="button"
    class="btn btn-secondary dropdown-toggle bmw align-self-center p-1"
    [style.background-color]="foodMacroCategoryMap[selectedMacroCategory().value].bgColor"
    data-bs-toggle="dropdown"
  >
    {{ selectedMacroCategory().label }}
  </button>
  <ul class="dropdown-menu p-0 overflow-hidden shadow-sm" style="min-width: 120px">
    @for (macroCategory of macroCategories; track $index) {
      <li [style.background-color]="foodMacroCategoryMap[macroCategory.value].bgColor">
        @let sameCategory = macroCategory.label === selectedMacroCategory().label;
        <span
          class="dropdown-item cursor-pointer px-2"
          (click)="selectedMacroCategory.set(macroCategory)"
          [class]="{
            'fst-italic': sameCategory,
          }"
          [style]="{
            'text-decoration': sameCategory ? 'underline' : 'unset',
            'letter-spacing': sameCategory ? '1px' : '0.25px',
            'text-underline-offset': '2px',
          }"
        >
          {{ macroCategory.label }}
        </span>
      </li>
    }
  </ul>
  <div class="position-relative">
    <input
      type="text"
      placeholder="Filter by name"
      class="form-control p-1"
      [(ngModel)]="nameFilter"
    />
    <button
      class="btn btn-sm btn-secondary p-0 position-absolute end-0 top-50 translate-middle-y me-2 z-1"
      buttonIcon="mdi:close"
      [iconSize]="'16px'"
      (click)="nameFilter.set('')"
    ></button>
  </div>
</div>
<div class="content-wrapper overflow-y-auto" style="height: calc(100dvh - 141px)">
  <table
    class="table table-sm table-striped table-hover mb-0"
    style="font-size: 12px; table-layout: fixed"
  >
    <thead class="position-sticky z-1" style="top: 0px">
      <tr>
        <th scope="col" class="bg-gradient" style="width: 10%"></th>
        <th
          scope="col"
          class="text-center bg-gradient"
          style="color: rgb(80, 100, 240); width: 16%"
        >
          Prot
        </th>
        <th
          scope="col"
          class="text-center bg-gradient"
          style="color: rgb(220, 220, 90); width: 16%"
        >
          Carbs
        </th>
        <th
          scope="col"
          class="text-center bg-gradient"
          style="color: rgb(200, 160, 30); width: 16%"
        >
          Fats
        </th>
        <th
          scope="col"
          class="text-center bg-gradient"
          style="color: rgb(100, 130, 20); width: 16%"
        >
          Fiber
        </th>
        <th
          scope="col"
          class="text-center bg-gradient"
          style="color: rgb(150, 140, 180); width: 16%"
        >
          KCal
        </th>
        <th scope="col" class="bg-gradient" style="width: 10%"></th>
      </tr>
    </thead>
    <tbody>
      @for (food of foods(); track $index) {
        <tr scope="row">
          <td rowspan="2">
            <button
              class="btn p-0 btn-warning opacity-25 m-auto"
              iconSize="16px"
              buttonIcon="iconoir:trash"
              (click)="deleteFood(food)"
            ></button>
          </td>
          <td
            colspan="5"
            class="py-1 text-center rounded-top"
            [style.background-color]="foodMacroCategoryMap[food.macroCategory].bgColor"
            [class.text-decoration-underline]="!!diaryDate() || !!recipeId()"
            (click)="addFoodToDiaryOrRecipe(food)"
            style="font-size: 16px; text-underline-offset: 2px"
          >
            <div class="d-flex justify-content-center align-items-center">
              <div>{{ food.name }}</div>
              @if (food.barcode) {
                <iconify class="ms-1 opacity-25" icon="si:barcode-fill" />
              }
            </div>
          </td>
          <td rowspan="2">
            <button
              class="btn p-0 rounded btn-secondary m-auto opacity-75"
              iconSize="24px"
              buttonIcon="iconoir:edit"
              (click)="editFood(food)"
            ></button>
          </td>
        </tr>
        <tr scope="row">
          <td
            class="text-truncate text-center p-0"
            [style.background-color]="`rgb(from ${foodMacroCategoryMap[food.macroCategory].bgColor} r g b / 0.25)`"
            style="
              font-size: 12px;
              text-shadow: 0 0 2px rgba(0, 0, 0, 0.5);
              color: rgb(80, 100, 240);
              border-bottom-left-radius: 4px;
            "
          >
            {{ food.protein }}
          </td>
          <td
            class="text-truncate text-center p-0"
            [style.background-color]="`rgb(from ${foodMacroCategoryMap[food.macroCategory].bgColor} r g b / 0.25)`"
            style="
              font-size: 12px;
              text-shadow: 0 0 2px rgba(0, 0, 0, 0.5);
              color: rgb(220, 220, 90);
            "
          >
            {{ food.carbs }}
          </td>
          <td
            class="text-truncate text-center p-0"
            [style.background-color]="`rgb(from ${foodMacroCategoryMap[food.macroCategory].bgColor} r g b / 0.25)`"
            style="
              font-size: 12px;
              text-shadow: 0 0 2px rgba(0, 0, 0, 0.5);
              color: rgb(200, 160, 30);
            "
          >
            {{ food.fats }}
          </td>
          <td
            class="text-truncate text-center p-0"
            [style.background-color]="`rgb(from ${foodMacroCategoryMap[food.macroCategory].bgColor} r g b / 0.25)`"
            style="
              font-size: 12px;
              text-shadow: 0 0 2px rgba(0, 0, 0, 0.5);
              color: rgb(100, 130, 20);
            "
          >
            {{ food.fiber }}
          </td>
          <td
            class="text-truncate text-center p-0"
            [style.background-color]="`rgb(from ${foodMacroCategoryMap[food.macroCategory].bgColor} r g b / 0.25)`"
            style="
              font-size: 12px;
              text-shadow: 0 0 2px rgba(0, 0, 0, 0.5);
              color: rgb(150, 140, 180);
              border-bottom-right-radius: 4px;
            "
          >
            {{ food.calories }}
          </td>
        </tr>
      } @empty {
        <tr>
          <td colspan="8" class="fst-italic text-center bg-body-tertiary text-muted">
            No foods found in selected category...
          </td>
        </tr>
      }
    </tbody>
  </table>
</div>
<button
  class="btn btn-outline-success p-2 rounded-top-0 w-100 d-flex justify-content-between mt-auto opacity-85"
  (click)="addFood()"
>
  <iconify icon="iconoir:lens-plus" />
  Add a food
  <iconify icon="mdi:plus" />
</button>
